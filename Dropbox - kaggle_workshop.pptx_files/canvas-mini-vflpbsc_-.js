/* Copyright Mozilla Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var CustomStyle=function(){function a(){}var b=["ms","Moz","Webkit","O"],c={};a.getProp=function(d,a){if(1===arguments.length&&"string"===typeof c[d])return c[d];var a=a||document.documentElement,g=a.style,f,k;if("string"===typeof g[d])return c[d]=d;k=d.charAt(0).toUpperCase()+d.slice(1);for(var h=0,i=b.length;h<i;h++)if(f=b[h]+k,"string"===typeof g[f])return c[d]=f;return c[d]="undefined"};a.setProp=function(b,c,a){b=this.getProp(b);"undefined"!==b&&(c.style[b]=a)};return a}();
function getFileName(a){var b=a.indexOf("#"),c=a.indexOf("?"),b=Math.min(0<b?b:a.length,0<c?c:a.length);return a.substring(a.lastIndexOf("/",b)+1,b)}function getOutputScale(a){a=(window.devicePixelRatio||1)/(a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1);return{sx:a,sy:a,scaled:1!==a}}
function scrollIntoView(a,b){var c=a.offsetParent,d=a.offsetTop+a.clientTop,e=a.offsetLeft+a.clientLeft;if(c){for(;c.clientHeight===c.scrollHeight;)if(c.dataset._scaleY&&(d/=c.dataset._scaleY,e/=c.dataset._scaleX),d+=c.offsetTop,e+=c.offsetLeft,c=c.offsetParent,!c)return;b&&(void 0!==b.top&&(d+=b.top),void 0!==b.left&&(e+=b.left,c.scrollLeft=e));c.scrollTop=d}else console.error("offsetParent is not set -- cannot scroll")}function noContextMenuHandler(a){a.preventDefault()}
function getPDFFileNameFromURL(a){var b=/[^\/?#=]+\.pdf\b(?!.*\.pdf\b)/i,a=/^(?:([^:]+:)?\/\/[^\/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(a);if(a=b.exec(a[1])||b.exec(a[2])||b.exec(a[3]))if(a=a[0],-1!==a.indexOf("%"))try{a=b.exec(decodeURIComponent(a))[0]}catch(c){}return a||"document.pdf"}
var ProgressBar=function(){function a(b,c){this.div=document.querySelector(b+" .progress");this.bar=this.div.parentNode;this.height=c.height||100;this.width=c.width||100;this.units=c.units||"%";this.div.style.height=this.height+this.units;this.percent=0}a.prototype={updateBar:function(){this._indeterminate?(this.div.classList.add("indeterminate"),this.div.style.width=this.width+this.units):(this.div.classList.remove("indeterminate"),this.div.style.width=this.width*this._percent/100+this.units)},get percent(){return this._percent},
set percent(b){this._indeterminate=isNaN(b);this._percent=Math.min(Math.max(b,0),100);this.updateBar()},setWidth:function(b){b&&(b=b.parentNode.offsetWidth-b.offsetWidth,0<b&&this.bar.setAttribute("style","width: calc(100% - "+b+"px);"))},hide:function(){this.bar.classList.add("hidden");this.bar.removeAttribute("style")}};return a}(),Cache=function(a){var b=[];this.push=function(c){var d=b.indexOf(c);0<=d&&b.splice(d,1);b.push(c);b.length>a&&b.shift().destroy()};this.resize=function(c){for(a=c;b.length>
a;)b.shift().destroy()}};var FIND_SCROLL_OFFSET_TOP=-50,FIND_SCROLL_OFFSET_LEFT=-400,MAX_TEXT_DIVS_TO_RENDER=1E5,RENDER_DELAY=200,TextLayerBuilder=function(){function a(b){this.textLayerDiv=b.textLayerDiv;this.divContentDone=this.layoutDone=!1;this.pageIdx=b.pageIndex;this.matches=[];this.lastScrollSource=b.lastScrollSource||null;this.viewport=b.viewport;this.isViewerInPresentationMode=b.isViewerInPresentationMode;this.textDivs=[];this.findController=b.findController||null}a.prototype={renderLayer:function(){var b=document.createDocumentFragment(),
c=this.textDivs,a=c.length,e=document.createElement("canvas").getContext("2d");if(!(a>MAX_TEXT_DIVS_TO_RENDER)){for(var g,f,k=0;k<a;k++){var h=c[k];if(void 0===h.dataset.isWhitespace){var i=h.style.fontSize,j=h.style.fontFamily;if(i!==g||j!==f)e.font=i+" "+j,g=i,f=j;j=e.measureText(h.textContent).width;0<j&&(b.appendChild(h),i=h.dataset.angle,j="scale("+h.dataset.canvasWidth/j+", 1)",i&&(j="rotate("+i+"deg) "+j),CustomStyle.setProp("transform",h,j),CustomStyle.setProp("transformOrigin",h,"0% 0%"))}}this.textLayerDiv.appendChild(b);
this.renderingDone=!0;this.updateMatches()}},setupRenderLayoutTimer:function(){var b=this,c=null===this.lastScrollSource?0:this.lastScrollSource.lastScroll;Date.now()-c>RENDER_DELAY?this.renderLayer():(this.renderTimer&&clearTimeout(this.renderTimer),this.renderTimer=setTimeout(function(){b.setupRenderLayoutTimer()},RENDER_DELAY))},appendText:function(b,c){var a=c[b.fontName],e=document.createElement("div");this.textDivs.push(e);if(/\S/.test(b.str)){var g=PDFJS.Util.transform(this.viewport.transform,
b.transform),f=Math.atan2(g[1],g[0]);a.vertical&&(f+=Math.PI/2);var k=Math.sqrt(g[2]*g[2]+g[3]*g[3]),h=k;a.ascent?h*=a.ascent:a.descent&&(h*=1+a.descent);var i;0===f?(i=g[4],g=g[5]-h):(i=g[4]+h*Math.sin(f),g=g[5]-h*Math.cos(f));e.style.position="absolute";e.style.left=i+"px";e.style.top=g+"px";e.style.fontSize=k+"px";e.style.fontFamily=a.fontFamily;e.textContent=b.str;e.dataset.fontName=b.fontName;0!==f&&(e.dataset.angle=f*(180/Math.PI));e.dataset.canvasWidth=a.vertical?b.height*this.viewport.scale:
b.width*this.viewport.scale}else e.dataset.isWhitespace=!0},setTextContent:function(b){this.textContent=b;for(var a=b.items,d=0,e=a.length;d<e;d++)this.appendText(a[d],b.styles);this.divContentDone=!0;this.setupRenderLayoutTimer()},convertMatches:function(b){for(var a=0,d=0,e=this.textContent.items,g=e.length-1,f=null===this.findController?0:this.findController.state.query.length,k=[],h=0,i=b.length;h<i;h++){for(var j=b[h];a!==g&&j>=d+e[a].str.length;)d+=e[a].str.length,a++;a===e.length&&console.error("Could not find a matching mapping");
for(var m={begin:{divIdx:a,offset:j-d}},j=j+f;a!==g&&j>d+e[a].str.length;)d+=e[a].str.length,a++;m.end={divIdx:a,offset:j-d};k.push(m)}return k},renderMatches:function(a){function c(a,b){var c=a.divIdx;g[c].textContent="";d(c,0,a.offset,b)}function d(a,b,c,d){var f=g[a],a=e[a].str.substring(b,c),a=document.createTextNode(a);d?(b=document.createElement("span"),b.className=d,b.appendChild(a),f.appendChild(b)):f.appendChild(a)}if(0!==a.length){var e=this.textContent.items,g=this.textDivs,f=null,k=null===
this.findController?!1:this.pageIdx===this.findController.selected.pageIdx,h=null===this.findController?-1:this.findController.selected.matchIdx,i=h,j=i+1;if(null===this.findController?0:this.findController.state.highlightAll)i=0,j=a.length;else if(!k)return;for(;i<j;i++){var m=a[i],l=m.begin,m=m.end,o=k&&i===h,n=o?" selected":"";o&&!this.isViewerInPresentationMode&&scrollIntoView(g[l.divIdx],{top:FIND_SCROLL_OFFSET_TOP,left:FIND_SCROLL_OFFSET_LEFT});!f||l.divIdx!==f.divIdx?(null!==f&&d(f.divIdx,
f.offset,void 0),c(l)):d(f.divIdx,f.offset,l.offset);if(l.divIdx===m.divIdx)d(l.divIdx,l.offset,m.offset,"highlight"+n);else{d(l.divIdx,l.offset,void 0,"highlight begin"+n);f=l.divIdx+1;for(l=m.divIdx;f<l;f++)g[f].className="highlight middle"+n;c(m,"highlight end"+n)}f=m}f&&d(f.divIdx,f.offset,void 0)}},updateMatches:function(){if(this.renderingDone){for(var a=this.matches,c=this.textDivs,d=this.textContent.items,e=-1,g=0,f=a.length;g<f;g++){for(var k=a[g],e=Math.max(e,k.begin.divIdx),h=k.end.divIdx;e<=
h;e++){var i=c[e];i.textContent=d[e].str;i.className=""}e=k.end.divIdx+1}null!==this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}}};return a}();
