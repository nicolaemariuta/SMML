define("modules/clean/account/change_email_modals",["jquery","external/react","modules/core/notify","modules/core/i18n","modules/clean/form","modules/clean/react/input","modules/clean/react/modal","modules/clean/viewer"],function(t,e,n,o,r,i,s,a){var _,u,c,l,d,h,p;return p=o._,d=o.render_sentences,h=o.ungettext,c=s.Modal,l=e.DOM,u=e.createClass({propTypes:{user:e.PropTypes.object,inboxCount:e.PropTypes.number,onContinue:e.PropTypes.func},render:function(){return c({title:p("Warning!"),acceptButtonText:p("Continue anyway"),dismissButtonText:p("Cancel"),onAccept:this.showChange,ref:"modal"},this.getSSOWarning(),this.getInboxWarning())},getSSOWarning:function(){var t,e,n;return t=a.get_viewer().is_paired,n=t&&this.props.user.role===Constants.ROLE_WORK,e=this.props.user.sso_required,n&&e?l.div({},p("Your %(team)s Dropbox uses single sign-on. If you change your email address you may not be able to sign in.").format({team:a.get_viewer().team_name})):null},getInboxWarning:function(){var t;return t=a.get_viewer().is_paired,0===this.props.inboxCount?null:t&&this.props.user.role===Constants.ROLE_PERSONAL?h("Your %(num)d existing shared folder invitation in your personal Dropbox will be removed if you change your email address.","Your %(num)d existing shared folder invitations in your personal Dropbox will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount}):t&&this.props.user.role===Constants.ROLE_WORK?h("Your %(num)d existing shared folder invitation in your %(team)s Dropbox will be removed if you change your email address.","Your %(num)d existing shared folder invitations in your %(team)s Dropbox will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount,team:a.get_viewer().team_name}):h("Your %(num)d existing shared folder invitation will be removed if you change your email address.","Your %(num)d existing shared folder invitations will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount})},showChange:function(t){var e,n;return t.preventDefault(),e=this.refs.modal,e.close(),"function"==typeof(n=this.props).onContinue?n.onContinue():void 0}}),_=e.createClass({propTypes:{user:e.PropTypes.object,onChange:e.PropTypes.func,onVerificationCheck:e.PropTypes.func},getInitialState:function(){return{submitting:!1,errors:{}}},render:function(){return c({title:p("Update '%(email)s'").format({email:this.props.user.email}),className:"change-email-modal",acceptButtonText:p("Update email"),dismissButtonText:p("Cancel"),onAccept:this.handleSubmit,submitting:this.state.submitting,ref:"modal"},l.form({action:"/account/change_email",className:"change-email-form",onSubmit:this.handleSubmit,onKeyDown:this.handleKey,ref:"form"},l.div({},this.getPrompt()),l.div({className:"change-email-inputs"},i.text({name:"email",label:p("New email"),error:this.state.errors.email,autoComplete:"off"}),i.text({name:"confirm_email",label:p("Confirm email"),error:this.state.errors.confirm_email,autoComplete:"off"}),i.password({name:"password",label:p("Dropbox password"),error:this.state.errors.password,autoComplete:"off"}),l.input({type:"hidden",name:Constants.UID_PARAM_NAME,value:this.props.user.id}))))},handleKey:function(t){var e;return 13===t.keyCode&&"INPUT"===(null!=(e=t.target)?e.tagName:void 0)?this.handleSubmit(t):void 0},handleSubmit:function(t){return t.preventDefault(),this.state.submitting?void 0:this.submit()},submit:function(){var e;return this.setState({submitting:!0,errors:{}}),e=t(this.refs.form.getDOMNode()),r.submit(e,this._success,this._error,this._complete)},_success:function(e){var n,o,r,i,s,a;return r=this.refs.modal,o=this.refs.form,n=t(o.getDOMNode()).find('input[name="email"]').val(),i="NEEDS_VERIFICATION"===e,r.close(),i?"function"==typeof(s=this.props).onVerificationCheck?s.onVerificationCheck(n):void 0:"function"==typeof(a=this.props).onChange?a.onChange(n):void 0},_error:function(t){return"string"==typeof t?n.error(t):t?this.setState({errors:t}):n.error()},_complete:function(){return this.isMounted()?this.setState({submitting:!1}):void 0},getPrompt:function(){var t,e,n;return t=a.get_viewer().is_paired,n=this.props.user.email_verified,e=[],t&&this.props.role===Constants.ROLE_PERSONAL?(e.push(p("Enter a new email address for your personal Dropbox.")),n&&e.push(p("You'll need to verify your new email address in order to finish updating your personal email."))):t&&this.props.user.role===Constants.ROLE_WORK?(e.push(p("Enter a new email address for your %(team)s Dropbox.").format({team:a.get_viewer().team_name})),n&&e.push(p("You'll need to verify your new email address in order to finish updating your %(team)s email.").format({team:a.get_viewer().team_name}))):n&&e.push(p("You'll need to verify your new email address in order to finish updating your email.")),e.length?d(e):""}}),{ChangeEmailWarningModal:u,ChangeEmailModal:_}}),define("modules/clean/account/email",["jquery","modules/core/browser","modules/core/notify","modules/core/i18n","modules/core/uri","modules/clean/account/change_email_modals","modules/clean/account/email_verify","modules/clean/account/verify_email_modals","modules/clean/react/modal","modules/clean/viewer"],function(t,e,n,o,r,i,s,a,_,u){var c,l,d,h,p,f,m,g,v,b,y;return y=o._,l=i.ChangeEmailModal,d=i.ChangeEmailWarningModal,v=a.VerifyEmailModal,g=a.ResendVerifyEmailModal,b=a.VerifyEmailSentModal,f=a.EmailVerifiedModal,h=a.ChangedEmailVerifiedModal,m=_.Modal,p=function(){function t(t){var e;this.role=t,this.user=this.role?u.get_viewer().get_user_by_role(this.role,!0):u.get_viewer().deprecated_first_user_in_the_cookie,this.email_to_verify=null!=(e=this.user)?e.email:void 0,this.verify_for_change=!1}return t.prototype.polling=!1,t.prototype.show_resend=!1,t.getForRole=function(e){return this.initalized||(this.legacy=new t(null),this.personal=new t("personal"),this.work=new t("work"),this.initalized=!0),"personal"===e?this.personal:"work"===e?this.work:this.legacy},t.get_for_user=function(t){return this.getForRole(t.role)},t.reset=function(){return this.initalized=!1},t.prototype.set_email_to_verify=function(t){return this.email_to_verify=t,this.verify_for_change=this.email_to_verify!==this.user.email},t.prototype.send_email=function(t,e){return s.send_verification_email(this.user,this.email_to_verify,t,e)},t.prototype.flash_email_sent_notification=function(){return n.success(y("Verification email sent to %(email)s").format({email:this.email_to_verify}))},t.prototype.ensure_polling=function(t){return s.listen_for_verification(this.user,this.email_to_verify,function(n){return function(){return null!=t?(n.user.is_email_verified=!0,t()):e.reload()}}(this))},t.prototype.email_sent=function(t){return this.show_resend=!0,this.show(),this.flash_email_sent_notification(),this.ensure_polling(t)},t.prototype.show=function(t,e){return this.show_resend?this.show_resend_verify_modal(e):this.show_verify_modal(t,e)},t.prototype.show_verify_modal=function(e,n){return null==n&&(n=this.verify_for_change?"change_email":t.REASON),m.showInstance(new v({user:this.user,reason:n,email:this.email_to_verify,onShowChange:function(t){return function(){return c.show(t.user)}}(this),onEmailSent:function(n){return function(){var o;return o=t.get_for_user(n.user),o.email_sent(e)}}(this)}))},t.prototype.show_resend_verify_modal=function(e){return null==e&&(e=this.verify_for_change?"change_email":t.REASON),m.showInstance(new g({user:this.user,email:this.email_to_verify,reason:e,onShowChange:function(t){return function(){return c.show(t.user)}}(this),onEmailSent:function(e){return function(){var n;return n=t.get_for_user(e.user),n.email_sent()}}(this)}))},t.prototype.verified_or_show=function(t){return this.user.is_email_verified?!0:(this.show(null,t),!1)},t.prototype.show_sent_modal=function(){return m.showInstance(new b({email:this.email_to_verify}))},t.prototype.show_verified_modal=function(){return m.showInstance(new f({reason:t.REASON,email:this.email_to_verify}))},t.prototype.show_verified_and_changed_modal=function(){return m.showInstance(new h({user:this.user,email:this.email_to_verify}))},t}(),c={inbox_counts:{},set_inbox_counts:function(e){return t.extend(this.inbox_counts,e)},show:function(t){var e;return e=u.get_viewer().get_user_by_id(t),this._should_show_warning(e)?this._show_warning_modal(e):this._show_change_modal(e)},_should_show_warning:function(t){var e,n,o,r;return n=u.get_viewer().is_paired,r=n&&t.role===Constants.ROLE_WORK,o=r&&t.sso_required,e=this.inbox_counts[t.id]>0,o||e},_show_change_modal:function(){return function(t){return m.showInstance(new l({user:t,onChange:function(n){return c.trigger_change(t,n),"/account"!==r.parse(e.get_href()).path?e.redirect("/home?send_verification_email=1"):n!==t.email?e.reload():void 0},onVerificationCheck:function(e){var n;return c.trigger_change(t,e,!0),n=p.get_for_user(t),n.set_email_to_verify(e),n.email_sent()}}))}}(this),_show_warning_modal:function(t){return m.showInstance(new d({user:t,inboxCount:this.inbox_counts[t.id],onContinue:function(e){return function(){return e._show_change_modal(t)}}(this)}))},listen_for_change:function(e,n){var o;return o=this._email_change_event_for_user(e),t(document).on(o,n)},trigger_change:function(e,n,o){var r;return r=this._email_change_event_for_user(e),t(document).trigger(r,[n,o])},_email_change_event_for_user:function(t){return"db:email_changed:"+t.id}},INLINE_JS.ChangeEmail=c,{EmailVerification:p,ChangeEmail:c}}),define("modules/clean/account/email_verify",["jquery","modules/clean/ajax"],function(t,e){var n;return n={_POLLING:{},send_verification_email:function(t,n,o,r){return e.WebRequest({url:"/sendverifyemail",data:{email:n,reason:o},success:function(){return r()},subject_user:t})},check_verification:function(t,n,o,r){return e.AuthenticatedRequest({url:"/isemailverified",data:{email:n},success:function(t){return"ok"===t?o():r()},subject_user:t})},listen_for_verification:function(t,e,n){var o;return o=""+t.id+":"+e,this._POLLING[o]?void 0:(this._POLLING[o]=!0,this._poll_for_verification(t,e,n))},_poll_for_verification:function(t,e,n){var o;return o=4e3,this.check_verification(t,e,n,function(r){return function(){return setTimeout(function(){return r._poll_for_verification(t,e,n)},o)}}(this))}}}),define("modules/clean/account/email_verify_reasons",[],function(){var t;return t={SHARE_FOLDER:"share_folder",CREATE_API_APP:"create_api_app",PUBLIC_FOLDER:"public_folder",GENERIC:"generic",SHMODAL:"shmodal",MOBILE_SHARE_FOLDER:"mobile_share_folder",EMAIL_ALIAS:"email_alias",CAROUSEL:"carousel",CHANGE_EMAIL:"change_email",CAROUSEL_EMAIL_ALIAS:"carousel_email_alias",PROMPT_CAMPAIGN:"prompt_campaign"}}),define("modules/clean/account/verify_email_modals",["external/react","modules/core/i18n","modules/clean/account/email_verify","modules/clean/account/email_verify_reasons","modules/clean/analytics","modules/clean/react/button","modules/clean/react/modal","modules/clean/viewer","modules/clean/react/react_i18n"],function(t,e,n,o,r,i,s,a,_){var u,c,l,d,h,p,f,m,g,v;return v=e._,p=r.UserActivityLogger,l=s.Modal,g=t.DOM,d=_.R_,f=t.createClass({propTypes:{user:t.PropTypes.object,reason:t.PropTypes.string,email:t.PropTypes.string,onEmailSent:t.PropTypes.func,onShowChange:t.PropTypes.func},render:function(){var t;return t={reason:this.props.reason},p.log("web","email_verify_shown",t),l({title:v("Verify your email address"),className:"verify-email",acceptButtonText:v("Send email"),dismissButtonText:v("Cancel"),onAccept:this.sendEmail,ref:"modal"},g.div({},g.div({},this.getPrompt()),g.a({href:"#",className:"change-email-before-verify",onClick:this.showChangeEmail},v("Update email address"))))},sendEmail:function(t){return t.preventDefault(),n.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)},close:function(){return this.refs.modal.close()},emailSent:function(){var t;return this.close(),"function"==typeof(t=this.props).onEmailSent?t.onEmailSent():void 0},showChangeEmail:function(t){var e,n;return e={reason:this.props.reason},p.log("web","email_verify_change_first",e),t.preventDefault(),this.close(),"function"==typeof(n=this.props).onShowChange?n.onShowChange():void 0},getPrompt:function(){var t;switch(this.props.reason){case o.SHARE_FOLDER:return d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to share folders. It's as simple as clicking the link in the verification email we send to you.");case o.SHMODAL:return d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to share links. It's as simple as clicking the link in the verification email we send to you.");case o.CREATE_API_APP:return d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> before you can register an API app. It's as simple as clicking the link in the verification email we send to you.");case o.PUBLIC_FOLDER:return d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to enable your Public folder. It's as simple as clicking the link in the verification email we send to you.");case o.CHANGE_EMAIL:return t=a.get_viewer().is_paired,t&&this.props.user.role===Constants.ROLE_PERSONAL?d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your personal email. It's as simple as clicking the link in the verification email we send to you."):t&&this.props.user.role===Constants.ROLE_WORK?d({email:this.props.email,team:a.get_viewer().team_name},"Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your %(team)s email. It's as simple as clicking the link in the verification email we send to you."):d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your email. It's as simple as clicking the link in the verification email we send to you.");default:return d({email:this.props.email},"Verify your email address at <strong>%(email)s</strong> to share folders and ensure your account can be recovered.")}}}),h=t.createClass({propTypes:{user:t.PropTypes.object,email:t.PropTypes.string,reason:t.PropTypes.string,onEmailSent:t.PropTypes.func,onShowChange:t.PropTypes.func},render:function(){var t;return t={reason:this.props.reason},p.log("web","email_verify_resend_shown",t),l({title:v("Verify your email address"),buttonComponent:this.renderButtons(),ref:"modal"},g.div({},g.div({},this.getPrompt()),g.a({href:"#",className:"change-email-before-verify",onClick:this.showChangeEmail},v("Update email address"))))},renderButtons:function(){return g.div({className:"db-modal-buttons"},i.link_button({className:"dbmodal-button",importance:"primary",onClick:this.close},v("Done")),i.link_button({className:"dbmodal-button",importance:"tertiary",onClick:this.sendEmail},v("Resend email")))},close:function(){return this.refs.modal.close()},showChangeEmail:function(t){var e,n;return e={reason:this.props.reason},p.log("web","email_verify_resend_change_first",e),t.preventDefault(),this.close(),"function"==typeof(n=this.props).onShowChange?n.onShowChange():void 0},sendEmail:function(t){return t.preventDefault(),n.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)},emailSent:function(){var t;return this.close(),"function"==typeof(t=this.props).onEmailSent?t.onEmailSent():void 0},getPrompt:function(){var t;return t=a.get_viewer().is_paired,this.props.reason!==o.CHANGE_EMAIL?d({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."):t&&this.props.user.role===Constants.ROLE_PERSONAL?d({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your personal email. If you can't find it, check your spam folder or click the button to resend the email."):t&&this.props.user.role===Constants.ROLE_WORK?d({email:this.props.email,team:a.get_viewer().team_name},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your %(team)s email. If you can't find it, check your spam folder or click the button to resend the email."):d({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your email. If you can't find it, check your spam folder or click the button to resend the email.")}}),m=t.createClass({propTypes:{email:t.PropTypes.string},render:function(){var t;return t=d({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."),l({title:v("Verification email sent!"),acceptButtonText:v("Done")},g.div({},t))}}),c=t.createClass({propTypes:{reason:t.PropTypes.string,email:t.PropTypes.string},render:function(){return l({title:v("Your email address has been verified"),acceptButtonText:v("Done")},g.div({},this.getPrompt()))},getPrompt:function(){switch(this.props.reason){case o.SHARE_FOLDER:return d({email:this.props.email},"Thanks for verifying your email address <strong>%(email)s</strong>. Now you can share folders with friends, family, or coworkers.");case o.CREATE_API_APP:return d({email:this.props.email},"Thanks for verifying your email address <strong>%(email)s</strong>. You can now register API apps.");case o.PUBLIC_FOLDER:return d({email:this.props.email},"Thanks for verifying your email address. You can now enable the Public folder for your <strong>%(email)s</strong> Dropbox.")}return""}}),u=t.createClass({propTypes:{email:t.PropTypes.string,user:t.PropTypes.object},render:function(){return l({title:v("Your email address has been verified"),acceptButtonText:v("Done")},g.div({},this.getPrompt()))},getPrompt:function(){var t;return t=a.get_viewer().is_paired,t&&this.props.user.role===Constants.ROLE_PERSONAL?d({email:this.props.email},"Thanks for verifying your email address <strong>%(email)s</strong>. Your personal account has successfully been changed."):t&&this.props.user.role===Constants.ROLE_WORK?d({email:this.props.email,team:a.get_viewer().team_name},"Thanks for verifying your email address <strong>%(email)s</strong>. Your %(team)s account has successfully been changed."):d({email:this.props.email},"Thanks for verifying your email address <strong>%(email)s</strong>. Your account has successfully been changed.")}}),{VerifyEmailModal:f,ResendVerifyEmailModal:h,VerifyEmailSentModal:m,EmailVerifiedModal:c,ChangedEmailVerifiedModal:u}});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},__bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/ajax",["jquery","external/underscore","modules/core/cookies","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/job_progress","modules/clean/storage","modules/clean/undo"],function(t,e,n,o,r,i,s,a,_,u,c){var l,d,h,p,f,m,g,v,b,y,w,E,x,S,A,k,C,O,T,L,R,N,P,I,D,U,M,j,$,B,q,H,W,G,F,V;return V=i._,N="err:",R="async_task_started:",L="async_task_err:",T="done:",P=function(e,n){var o,r,i,s;return null==e&&(e={}),null==n&&(n=[]),null==e.type&&(null!=e.method?(("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)||console.log('Expected "type" attribute; received "method"'),i=e.method):i="POST",e.type=i),o=new f(e),r=G(o,n),s=t.ajax({url:r.url(),type:e.type,noDropboxDefaults:!0,data:r.data(),dataType:e.dataType||"text",traditional:!0,xhrFields:r.xhrFields(),success:function(t,e,n){return r.success(t,e,n)},error:function(t,e,n){return r.error(t,e,n)},complete:function(t,e){return r.complete(t,e)}}),r.request(s)},G=function(t,n){var o,r,i,s,a,_,u,c;for(r=[t],c=e(n.slice(0)).reverse(),s=0,_=c.length;_>s;s++)o=c[s],r.push(new o);for(i=null,a=0,u=r.length;u>a;a++)o=r[a],i&&(o.next=i),i=o;return i},f=function(){function t(t){null==t&&(t={}),this.options=function(){return t},this.url=function(){return String(t.url||"")},this.data=function(){return t.data||{}},this.xhrFields=function(){return t.xhrFields||{}},this.success=t.success||this.identity,this.error=t.error||this.identity,this.complete=t.complete||this.identity,this.request=this.identity}return t.prototype.identity=function(t){return t},t}(),v=function(){function t(){}return t.prototype.options=function(){return this.next.options()},t.prototype.url=function(){return this.next.url()},t.prototype.data=function(){return this.next.data()},t.prototype.xhrFields=function(){return this.next.xhrFields()},t.prototype.success=function(t,e,n){return this.next.success(t,e,n)},t.prototype.error=function(t,e,n){return this.next.error(t,e,n)},t.prototype.complete=function(t,e){return this.next.complete(t,e)},t.prototype.request=function(t){return this.next.request(t)},t}(),g=function(r){function i(){return i.__super__.constructor.apply(this,arguments)}return __extends(i,r),i.prototype.SUPPORTED_TLDS=["dropbox.com","carousel.com"],i.prototype.data=function(){var e;return o.assert(this._is_db_domain(),"injecting CSRF token into request to non-dropbox domain"),e={is_xhr:!0,t:n.read(Constants.JS_CSRF_COOKIE)||""},t.extend(e,this.next.data())},i.prototype._is_db_domain=function(){var t,n;return(t=a.parse(String(this.url())).authority)?(n=t.split("."),e.reduce(this.SUPPORTED_TLDS,function(t,e){var o,r;return r=e.split("."),o=n.slice(-1*r.length).join("."),t||e===o},!1)):!0},i}(v),U=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.data=function(){var t,e;return t=this.next.data(),e=this.options(),e.subject_user&&!t[Constants.UID_PARAM_NAME]&&(t[Constants.UID_PARAM_NAME]=String(e.subject_user)),t},e}(v),m=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.error=function(t,e,n){var o,r;return 403===t.status&&(o=u.SessionStorage.get("reload-timestamp"),r=(new Date).getTime(),(!o||r-o>3e4)&&(u.SessionStorage.set("reload-timestamp",r),window.location.reload(!0))),this.next.error(t,e,n)},e}(v),D=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.data=function(){var e;return e=this.next.data(),null!=t.ajaxSettings.restrict&&(e.restrict=t.ajaxSettings.restrict),e},n}(v),I=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.data=function(){var e,n;return e=this.next.data(),Constants.REQUEST_TRACING_ENABLED&&"post"===this.options().type.toLowerCase()?(n={parent_request_id:Constants.REQUEST_ID},t.extend(n,e)):e},n}(v),w=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.data=function(){var e,n;return e=this.next.data(),Constants.CPROFILE_ENABLED?(n={parent_request_id:Constants.REQUEST_ID,cProfile:Constants.CPROFILE_PARAMETER},t.extend(n,e)):e},n.prototype.success=function(t,e,n){return this._report_cprofile(t,e,n),this.next.success(t,e,n)},n.prototype._report_cprofile=function(e,n,o){var r,i,s;return r=t("#cprofile"),r.length?(i=this._build_cprofile_link(o),s=r.find(".ajax"),s.length>=10&&s.last().remove(),r.prepend(i)):void 0},n.prototype._build_cprofile_link=function(e){var n,o,r,i,s,_,u,c,l;if(o=e.getResponseHeader("X-Dropbox-Request-Id"),s=e.getResponseHeader("X-Server-Response-Time")||"-1",i={request_id:""+Constants.REQUEST_ID+"-"+o},_=this.url(),-1!==_.indexOf(Constants.BLOCK_CLUSTER))i.block=1;else for(l=Constants.BATCH_THUMB_ENDPOINTS,u=0,c=l.length;c>u;u++)if(n=l[u],-1!==_.indexOf(n)){i.block=1;break}return _=_.replace(/[^/]*\/\/[^/]+/,"").replace(/\?.*$/,""),r=t('<a class="ajax" target="_new" />').attr("href",String(a({path:"/profile/cprofile",query:i}))).text("Ajax: "+_+" ("+s+"ms)")},n}(v),E=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.data=function(){var e;return e=this.next.data(),Constants.GANDALF_PANEL?t.extend({gandalf_panel:1},e):e},n.prototype.success=function(t,e,n){return this._report_gandalf(t,e,n),this.next.success(t,e,n)},n.prototype._report_gandalf=function(e,n,o){var r;return t("#gandalf_panel").length&&"/gandalf_panel"!==this.url().substring(0,14)&&null!=(r=window.gandalf_panel)?r.add(this.url(),o.getResponseHeader("X-Dropbox-Request-Id")):void 0},n}(v),k=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.error=function(t,e,n){return this._log_error(t,e,n),this.next.error(t,e,n)},e.prototype._log_error=function(t,e){var n,o;if(!(0!==e&&400>e))return n={url:this.url(),response_code:t.status,source_type:"web",request_id:t.getResponseHeader("X-Dropbox-Request-Id")},o=a({path:"/web_response_code_log"}),h({url:o,data:n})},e}(v),y=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.error=function(t,e,n){return this._notify_dev(t,e,n),this.next.error(t,e,n)},n.prototype._notify_dev=function(e){var n,o,i;return!("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)&&500===e.status&&e.getResponseHeader("X-Debug-Url")?(i=e.getResponseHeader("X-Debug-Url"),n=t("<span />"),n.text(s.DEFAULT_ERROR),o=t("<a/>",{href:i,target:"_blank"}).text(V("View debug")),n.append("&nbsp;").append(o),s.error(new r(n.html()))):void 0},n}(v),M=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.success=function(t,e,n){var o;return n.responseText.length?0===n.responseText.indexOf(N)?(o=n.responseText.substr(N.length),s.error(o),this.next.error(n,e,"server error response")):this.next.success(t,e,n):this.next.error(n,e,"empty response")},e}(v),j=function(t){function e(){return this._clear_working_msg=__bind(this._clear_working_msg,this),e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.request=function(t){return this.xhr=t,setTimeout(function(t){return function(){return t._request_finished()?void 0:t._should_show_working_msg()?(t._show_working_msg(),t.xhr.done(t._clear_working_msg)):void 0}}(this),4e3),this.next.request(this.xhr)},e.prototype._request_finished=function(){return 4===this.xhr.readyState},e.prototype._should_show_working_msg=function(){return s.isShown()&&s.current()!==c.undo_notification},e.prototype._show_working_msg=function(){return this.notification=s.success(V("Still working..."))},e.prototype._clear_working_msg=function(){return s.isShown()&&this.notification===s.current()?s.clear():void 0},e}(v),O=function(e){function n(){return this._watch=__bind(this._watch,this),n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.data=function(){var e,o;return this.job_id=n.generate_job_id(),e=this.next.data(),this.uid=e[Constants.UID_PARAM_NAME],o=this.options().subject_user,!this.uid&&o&&(this.uid=String(o)),t.extend({job_id:this.job_id},e)},n.prototype.request=function(t){return this._interval=1e3,this._failures=0,this._watch_count=0,this._watch_id=setInterval(this._watch,this._interval),this.next.request(t)},n.prototype.success=function(t,e,n){return this.next.success(t,e,n)},n.prototype.error=function(t,e,n){return this.next.error(t,e,n)},n.prototype.complete=function(t,e){return this._stop(),_.Job.handled(this.job_id),this.next.complete(t,e)},n.prototype._watch=function(){return _.Job.peek(this.job_id)?this._stop():(this._watch_count++,this._watch_count%10===0&&(clearInterval(this._watch_id),this._interval=Math.min(Math.floor(1.5*this._interval),3e4),this._watch_id=setInterval(this._watch,this._interval)),this._show_progress_modal(),this._fetch_progress())},n.prototype._stop=function(){return clearInterval(this._watch_id),_.ModalProgress.hide()},n.prototype._show_progress_modal=function(){return this._modal_shown?void 0:(this._modal_shown=!0,_.ModalProgress.show(this.options().progress_text))},n.prototype._fetch_progress=function(){var t;return t={},this.uid&&(t[Constants.UID_PARAM_NAME]=this.uid),p({url:"/job_status/"+this.job_id,data:t,success:function(){return function(t,e,n){var o;return o=0===n.responseText.indexOf("done")?"1/1":n.responseText,_.ModalProgress.update(o)}}(this),error:function(t){return function(e,n,o){return t._failures++,t._failures<3?void 0:(t._stop(),t.next.error(e,n,o))}}(this)})},n.generate_job_id=function(){var t,e,n;return t=new Date,n=t.getTime().toString(),e=Math.floor(1e6*Math.random()).toString().lpad(6),n+e},n}(v),d=function(t){function e(){return this._watch=__bind(this._watch,this),e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.data=function(){var t,e;return t=this.next.data(),this.uid=t[Constants.UID_PARAM_NAME],e=this.options().subject_user,!this.uid&&e&&(this.uid=String(e)),t},e.prototype.success=function(t,e,n){return this._is_async_job_response(n)?(this.job_id=n.responseText.split(":")[1],this._interval=1e3,this._failures=0,this._watch_count=0,this._watch_id=setInterval(this._watch,this._interval)):this.next.success(t,e,n)},e.prototype.complete=function(t,e){return this._is_async_job_response(t)?void 0:this.next.complete(t,e)},e.prototype._is_async_job_response=function(t){var e,n;return 0!==(null!=(n=t.responseText)?n.indexOf(R):void 0)?!1:(e=t.responseText.split(":")[1],e.match(/^[A-Za-z0-9_\-=]*$/))},e.prototype._watch=function(){return _.Job.peek(this.job_id)?this._stop():(this._watch_count++,this._watch_count%10===0&&(clearInterval(this._watch_id),this._interval=Math.min(Math.floor(1.5*this._interval),3e4),this._watch_id=setInterval(this._watch,this._interval)),this._show_progress_modal(),this._fetch_progress())},e.prototype._stop=function(){return clearInterval(this._watch_id),_.ModalProgress.hide()},e.prototype._show_progress_modal=function(){return this._modal_shown?void 0:(this._modal_shown=!0,_.ModalProgress.show(this.options().progress_text))},e.prototype._fetch_progress=function(){var t;return t={},this.uid&&(t[Constants.UID_PARAM_NAME]=this.uid),p({url:"/async_task_status/"+this.job_id,data:t,success:function(t){return function(e,n,o){var i,a,u;return u=o.responseText,0===u.indexOf(T)?(_.Job.handled(t.job_id),t._stop(),u=u.substr(T.length),o.responseText=u,t.next.success(u,n,o),t.next.complete(o,n)):0===u.indexOf(N)?(_.Job.handled(t.job_id),t._stop(),i=u.substr(N.length),s.error(i),t.next.error(o,n,"server error response"),t.next.complete(o,n)):0===u.indexOf(L)?(_.Job.handled(t.job_id),t._stop(),a=u.substr(L.length),s.error(new r(a)),t.next.complete(o,n)):_.ModalProgress.update(u)}}(this),error:function(t){return function(e,n,o){return t._failures++,t._failures<3?void 0:(t._stop(),t.next.error(e,n,o),t.next.complete(e,n))}}(this)})},e}(v),l=[U,g,m,D],h=function(t){return null==t&&(t={}),P(t,l)},C=[j],b=[k,y,E,w,I],A=[d],B=[].concat(C,[M],b,l,A),W=function(t){return null==t&&(t={}),P(t,B)},x=[].concat(C,b,l,A),S=function(t){return null==t&&(t={}),P(t,x)},q=[].concat(C,[M],b,l,[O],A),H=function(t){return null==t&&(t={}),P(t,q)},p=function(t){return null==t&&(t={}),P(t,[].concat(b,l))},$=function(e){var n,o,r;return null==e&&(e={}),n=new f(e),o=G(n,l),r=t.ajax({url:o.url(),type:"OPTIONS",noDropboxDefaults:!0,data:o.data(),success:function(t,e,n){return o.success(t,e,n)},error:function(t,e,n){return o.error(t,e,n)},complete:function(t,e){return o.complete(t,e)}}),o.request(r)},F={Request:P,AuthenticatedRequest:h,BackgroundRequest:p,WebRequest:W,FormWebRequest:S,
WebProgressRequest:H,ValidationSchemaRequest:$}}),define("modules/clean/analytics",["jquery","modules/clean/viewer","modules/clean/ajax"],function(t,e,n){var o,r,i,s,a,_,u,c,l,d,h;return h=function(t){var n,o,r;return r=new e(Constants._viewer_properties),n=t?[t]:function(){var t,e,n,i;for(n=r.get_users(),i=[],t=0,e=n.length;e>t;t++)o=n[t],i.push(o.id);return i}()},o={log:function(t,e){var o,r,i,s,a;for(i=0,s=0,a=t.length;a>s;s++)o=t[s],o.dir&&i++;return r=t.length-i,n.AuthenticatedRequest({url:"/browse_actions_context_menu_logger",data:{file_count:r,folder_count:i,action:e}})}},r={log:function(t,e,o,r,i,s){return n.AuthenticatedRequest({url:"/preview_quality_popup_logger",subject_user:e,data:{event_name:t,file_nsid:o,file_sjid:r,extension:i,doc_preview_status:s}})}},i={log:function(t,e,o){return null==o&&(o={}),n.AuthenticatedRequest({url:"/searchclientlogger",subject_user:e,data:{event_name:t,action_type:o.action_type,displayed:o.displayed,failure_type:o.failure_type,file_nsid:o.file_nsid,file_sjid:o.file_sjid,firefly:o.firefly,infinite_scroll:o.infinite_scroll,latency:o.latency,match_type:o.match_type,path_scoped:o.path_scoped,position:o.position,query_string:o.query_string,request_id:o.request_id,result_count:o.result_count,search_type:o.search_type,viewport:o.viewport}})}},s={flow_id:null,log:function(t,e,o,r,i){var s;return null==o&&(o=null),null==r&&(r={}),null==i&&(i=!1),(i||null===this.flow_id)&&(s=new Date,this.flow_id=s.getTime().toString()+Math.random().toString(),this.flow_id=this.flow_id.replace(".","")),n.AuthenticatedRequest({url:"/sflogger",data:{platform:t,event_name:e,extra:JSON.stringify(r),active_uid:null!=o?o.id:null,flow_id:this.flow_id}})}},a={log:function(t,e,o){return new n.AuthenticatedRequest({url:"/shmuilog",data:{evt:t,origin:e,target_item:o}})},log_with_target_file:function(t,e,n){return this.log(t,e,this.get_target_item(n))},get_target_item:function(t){return t.dir?t.is_shared_folder()?"folder-is-sf":t.could_be_shared_folder()?"folder-can-sf":"folder-no-sf":"file"}},_={log:function(t,e,o,r){var i;return null==r&&(r=null),i=h(r),n.AuthenticatedRequest({url:"/teamswalogger",data:{event_name:t,extra:JSON.stringify(e),for_uids:JSON.stringify(i)},success:o?o:void 0,error:o?o:void 0})}},u={log:function(t,e,o,r){var i;return null==r&&(r=null),i=h(r),n.AuthenticatedRequest({url:"/ualogger",data:{platform:t,event_name:e,extra:JSON.stringify(o),for_uids:JSON.stringify(i)}})}},c={log:function(t,e,o,r){return n.AuthenticatedRequest({url:"/virallogger",data:{user_ids:JSON.stringify(t),viral_type:e,action:o,extra:JSON.stringify(r||{})}})}},l={log:function(t,e,o){var r;return null==o&&(o=null),r=h(o),n.AuthenticatedRequest({url:"/misclogger",data:{event_name:t,extra:JSON.stringify(e),for_uids:JSON.stringify(r)}})}},d={BrowseActionsContextMenuLogger:o,PreviewQualityPopupLogger:r,SearchClientActivityLogger:i,SharedFolderActivityLogger:s,ShmodelUILogger:a,TeamsWebActionsLogger:_,UserActivityLogger:u,ViralLogger:c,WebMiscActivityLogger:l},INLINE_JS.TeamsWebActionsLogger=_,INLINE_JS.ShmodelUILogger=a,d}),define("modules/clean/base64",[],function(){var t,e,n,o,r;return r=function(t){var e,n,o,r,i,s,a,_,u;if(null===t||"undefined"==typeof t)return"";for(a=t+"",u="",s=void 0,r=void 0,_=0,s=r=0,_=a.length,i=0;_>i;){if(e=a.charCodeAt(i),o=null,128>e)r++;else if(e>127&&2048>e)o=String.fromCharCode(e>>6|192,63&e|128);else if(e&!0)o=String.fromCharCode(e>>12|224,e>>6&63|128,63&e|128);else{if(e&!0)throw new RangeError("Unmatched trail surrogate at "+i);if(n=a.charCodeAt(++i),n&!0)throw new RangeError("Unmatched lead surrogate at "+(i-1));e=((1023&e)<<10)+(1023&n)+65536,o=String.fromCharCode(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}null!==o&&(r>s&&(u+=a.slice(s,r)),u+=o,s=r=i+1),i++}return r>s&&(u+=a.slice(s,_)),u},o=function(t){var e,n,o,r,i,s;for(s=[],i=0,e=0,n=0,o=0,r=0,t+="";i<t.length;)n=t.charCodeAt(i),128>n?(s[e++]=String.fromCharCode(n),i++):n>191&&224>n?(o=t.charCodeAt(i+1),s[e++]=String.fromCharCode((31&n)<<6|63&o),i+=2):(o=t.charCodeAt(i+1),r=t.charCodeAt(i+2),s[e++]=String.fromCharCode((15&n)<<12|(63&o)<<6|63&r),i+=3);return s.join("")},e=function(t){var e,n,o,r,i,s,a,_,u,c,l,d,h,p;if(n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=void 0,l=void 0,d=void 0,i=void 0,s=void 0,a=void 0,_=void 0,o=void 0,u=0,e=0,r="",p=[],!t)return t;for(;;)if(c=t.charCodeAt(u++),l=t.charCodeAt(u++),d=t.charCodeAt(u++),o=c<<16|l<<8|d,i=o>>18&63,s=o>>12&63,a=o>>6&63,_=63&o,p[e++]=n.charAt(i)+n.charAt(s)+n.charAt(a)+n.charAt(_),!(u<t.length))break;return r=p.join(""),h=t.length%3,(h?r.slice(0,h-3):r)+"===".slice(h||3)},t=function(t,e){var n,r,i,s,a,_,u,c,l,d,h,p,f,m,g;if(h=function(t){return t},a=e?h:o,"function"==typeof window.atob)return a(window.atob(t));if(r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,n=0,g=[],!t)return t;for(t+="";;)if(_=r.indexOf(t.charAt(d++)),u=r.indexOf(t.charAt(d++)),c=r.indexOf(t.charAt(d++)),l=r.indexOf(t.charAt(d++)),i=_<<18|u<<12|c<<6|l,p=i>>16&255,f=i>>8&255,m=255&i,g[n++]=64===c?String.fromCharCode(p):64===l?String.fromCharCode(p,f):String.fromCharCode(p,f,m),!(d<t.length))break;return s=g.join(""),s=a(s)},n={encode:e,decode:t}});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("modules/clean/browse_interface",["modules/clean/viewer","modules/core/uri"],function(t,e){var n;return n=function(n){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,n),o.get_browse_root=function(e){return t.get_viewer().is_paired?e.role===Constants.ROLE_PERSONAL?"/personal":"/work":"/home"},o.browse_uri_for_fq_path=function(t,n){return e({scheme:"https",authority:Constants.WEBSERVER,path:""+o.get_browse_root(t)+n})},o}(Object)}),define("modules/clean/clipboard",["jquery","modules/core/dom","external/swfobject"],function(t,e){var n,o,r,i,s;return r=function(){var t,e;return t=(new Date).getTime(),e=Math.floor(1e6*Math.random()).toString().lpad(6),"swf_"+t+"_"+e},i=function(t,e){return t.on("mouseover",function(){return e.addClass("hovered")}),t.on("mousedown",function(){return e.addClass("pressed")}),t.on("mouseout",function(){return e.removeClass("hovered pressed")}),t.on("mouseup",function(){return e.removeClass("pressed")})},s=function(t,e){return window.ClipboardSWFRegister=window.ClipboardSWFRegister||{},window.ClipboardSWFRegister[t]=function(){return e()},"ClipboardSWFRegister."+t},n=function(n,o,a,_){var u,c,l;return null==a&&(a=null),null==_&&(_=null),_=_||t(document.body),l=r(),u=t("<div />",{id:"flash_copy_container"}).append(t("<div />",{id:l})).css({position:"absolute",zIndex:1}),i(u,o),_.append(u),e.clone_position(u,o,{}),c=s(l,a),window.copyLoaded=function(){return function(){var e;return e=t("#"+l)[0],e.setCopyText(n),e.setCallbackFunction(c)}}(this),window.swfobject.embedSWF(Constants.static_url_copy_clipboard_swf,l,"100%","100%","6.0.65",!1,!1,{wmode:"transparent",scale:"exactfit",allowScriptAccess:"always"}),u},o={clipboard_overlay:n}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/components/ajax_form",["jquery","modules/core/dom","modules/core/exception","modules/core/html","modules/core/notify","modules/clean/ajax","modules/clean/validators/validators"],function(t,e,n,o,r,i,s){var a,_;return _=n.assert,a=function(){function n(t,n,o){this.$container=t,this.do_before_submitting=n,this._clear_pending=__bind(this._clear_pending,this),this._clear_errors=__bind(this._clear_errors,this),this._handle_errors=__bind(this._handle_errors,this),this._on_error=__bind(this._on_error,this),this._on_success=__bind(this._on_success,this),this._submit_form=__bind(this._submit_form,this),this._install_schema=__bind(this._install_schema,this),o=o||{},this.$form="FORM"===this.$container.prop("tagName")?this.$container:this.$container.find("form"),this.$form.submit(this._submit_form),this.$submit_button=this.$form.find("[type='submit']"),e.set_controller(this.$form,this),this.schema={},this.should_validate=o.client_side_validation,this.should_submit_once=o.should_submit_once,this.should_validate&&this._fetch_schema()}return n.SUCCESS_EVENT="db:ajaxform:success",n.ERROR_EVENT="db:ajaxform:error",n.extract_errors=function(t){var e,n;if(0!==t.indexOf("err:"))return!1;t=t.substr(4);try{return e=JSON.parse(t)}catch(o){return n=o,"string"==typeof t?t:r.DEFAULT_ERROR}},n.clear_errors=function(t){return t.find(".input-error").removeClass("input-error"),t.find(".error-message").remove()},n.fill_errors=function(e,n){var o,r,i,s;s=[];for(r in n)i=n[r],o=t("<span>",{"class":"error-message"}),i.message_html?o.html(i.message_html):o.text(i.message_text),o.insertBefore(e.find("[data-error-field-name='"+r+"']")),s.push(e.find("input[name='"+r+"'], input[data-encrypted-name='"+r+"']").addClass("input-error"));return s},n.prototype._install_schema=function(e){var n,o;try{n=JSON.parse(e)}catch(r){o=r}return t.each(n,function(t){return function(e,n){return n?t.schema[e]=s.create(n):void 0}}(this))},n.prototype._fetch_schema=function(){return i.ValidationSchemaRequest({url:this.$form.attr("action"),success:function(t){return function(e){return t._install_schema(e)}}(this)})},n.prototype.reset=function(){var e,n,o,r,i;for(r=this.$form.find("input"),i=[],n=0,o=r.length;o>n;n++)e=r[n],i.push(t(e).closest(".text-input").val(e.defaultValue));return i},n.prototype.set_input_value=function(t,e){return this.$form.find("input[name='"+t+"']").closest(".text-input").val(e)},n.prototype._get_form_data=function(){var e,n,o,r,i,s,a;for(e={},a=this.$form.find("input, select, textarea"),i=0,s=a.length;s>i;i++)n=a[i],o=t(n).attr("name"),o&&(r="checkbox"===t(n).attr("type")?t(n).prop("checked")?"True":"":t(n).val(),_(!(o in e),"found multiple inputs with the same name"),e[o]=r);return e},n.prototype._validate=function(e){var n,o;return this.should_validate?(n={},o=!0,t.each(e,function(t){return function(r,i){var s;if(t.schema[r])try{return t.schema[r].validate(i,{field:r,data:e,errors:n})}catch(a){return s=a,o=!1,n[r]={message_text:s.message}}}}(this)),o?null:n):null},n.prototype._submit_form=function(t){var e;return t.preventDefault(),"function"==typeof this.do_before_submitting&&this.do_before_submitting(),this._clear_errors(),this.$form.prop("disabled",!0),this.$form.addClass("ajax-loading"),this.$submit_button.prop("disabled",!0),e=this._validate(this._get_form_data()),e?this._handle_errors(e):this.send_request()},n.prototype.send_request=function(){return i.FormWebRequest({url:this.$form.attr("action"),data:this._get_form_data(),success:this._on_success,error:this._on_error,complete:this._on_complete})},n.prototype._on_success=function(t,e,o){var i,s,a,_;if(a=o.responseText,i=n.extract_errors(a),i!==!1)return void this._handle_errors(i);try{s=JSON.parse(a)}catch(u){return _=u,this.$form.trigger(n.ERROR_EVENT),r.error(),void this._clear_pending(!0)}return this.$form.trigger(n.SUCCESS_EVENT,s),this._clear_pending(!this.should_submit_once)},n.prototype._on_error=function(){return r.error(),this._clear_pending(!0)},n.prototype._handle_errors=function(t){return"string"==typeof t?(r.error(new o(t)),void this._clear_pending(!0)):(n.fill_errors(this.$form,t),this._clear_pending(!0),this.$form.trigger(n.ERROR_EVENT))},n.prototype._clear_errors=function(){return this.$form.find(".error-message").remove(),this.$form.find("input").removeClass("input-error")},n.prototype._clear_pending=function(t){return this.$form.removeClass("ajax-loading"),t?(this.$form.prop("disabled",!1),this.$submit_button.prop("disabled",!1)):void 0},n}()});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/components/bubble_dropdown",["jquery"],function(t){var e;return e=function(){function e(n,o,r,i){this.$root=n,this.arrow_direction=o,this.top_adjustment=null!=i?i:0,this._hide_bubble=__bind(this._hide_bubble,this),this._show_bubble=__bind(this._show_bubble,this),this._toggle_bubble=__bind(this._toggle_bubble,this),this._on_global_hover=__bind(this._on_global_hover,this),this._on_mouseout=__bind(this._on_mouseout,this),this._on_mouseover=__bind(this._on_mouseover,this),this.openDropdown=__bind(this.openDropdown,this),this.closeDropdown=__bind(this.closeDropdown,this),this.$target=this.$root.find(".bubble-dropdown-target"),this.$dropdown=this.$root.find(".bubble-dropdown"),this.$arrow_anchor=this.$root.find(".bubble-dropdown-arrow-anchor"),this.$arrow=this.$dropdown.find(".bubble-arrow"),this.target_position={top:"bottom",left:"right",bottom:"top",right:"left"}[this.arrow_direction],r?(this.$target.on("mouseover",this._on_mouseover),this.$dropdown.on("mouseover",this._on_mouseover),this.$target.on("mouseout",this._on_mouseout),this.$dropdown.on("mouseout",this._on_mouseout),t(document).on(e.HOVER_SHOWN,this._on_global_hover)):(this.$target.click(this._toggle_bubble),t("body").on("click",function(e){return function(n){var o;return t(n.target).is("select")?!0:(o=t(n.target).closest(e.$target).length||t(n.target).closest(e.$dropdown).length,o||e._hide_bubble(),!0)}}(this)))}return e.HOVER_SHOWN="bubble:hover:shown",e.prototype._dropdown_shown=!1,e.prototype.closeDropdown=function(){return this._dropdown_shown?this._hide_bubble():void 0},e.prototype.openDropdown=function(){return this._dropdown_shown?void 0:this._show_bubble()},e.prototype._on_mouseover=function(){return t(document).trigger(e.HOVER_SHOWN,this.$target),this._show_bubble(),clearTimeout(this.$dropdown.data("timeout_id"))},e.prototype._on_mouseout=function(){var t;return t=setTimeout(this._hide_bubble,200),this.$dropdown.data("timeout_id",t)},e.prototype._on_global_hover=function(t,e){return this._dropdown_shown&&e!==this.$target?(this._hide_bubble(),clearTimeout(this.$dropdown.data("timeout_id"))):void 0},e.prototype._toggle_bubble=function(){return this._dropdown_shown?this._hide_bubble():this._show_bubble(),!0},e.prototype._show_bubble=function(){var t,e,n,o,r,i;if(!this.$target.hasClass("disabled")){switch("right"===this.arrow_direction?this.$dropdown.css("display","block"):this.$dropdown.css("display","inline-block"),i=this.$arrow.outerWidth(),e=this.$arrow.outerHeight()-this.top_adjustment,r=this.$arrow.position().top,n=this.$arrow.position().left,this.arrow_direction){case"left":t="left+"+i+"px top-"+r+"px";break;case"right":t="right-"+i+"px top-"+r+"px";break;case"top":t="left-"+n+"px top+"+e+"px";break;case"bottom":t="left-"+n+"px bottom-"+e+"px"}return o={my:t,at:this.target_position,of:this.$arrow_anchor.length?this.$arrow_anchor:this.$target,collision:"none"},this.$dropdown.position(o),this.$dropdown.position(o),this._dropdown_shown=!0}},e.prototype._hide_bubble=function(){return this.$dropdown.hide(),this._dropdown_shown=!1},e}()});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/components/bubble_picker",["jquery"],function(t){var e;return e=function(){function e(t){this.$bubble_picker=t,this.enable_option=__bind(this.enable_option,this),this.disable_option=__bind(this.disable_option,this),this.show_dropdown=__bind(this.show_dropdown,this),this.hide_dropdown=__bind(this.hide_dropdown,this),this.set_value=__bind(this.set_value,this),this._listen=__bind(this._listen,this),this.$label_wrapper=this.$bubble_picker.find(".bubble-picker-label-wrapper"),this.$label=this.$bubble_picker.find(".bubble-picker-label"),this.$dropdown=this.$bubble_picker.find(".bubble-picker-dropdown"),this._dropdown_shown=!1,this._listen()}return e.CHANGED="db:bubblepicker:changed",e.prototype._listen=function(){return t(document).click(function(e){return function(n){var o,r;return r=t(n.target).closest(e.$label_wrapper).length>0,o=t(n.target).closest(e.$dropdown).length>0,e._dropdown_shown&&!o?e.hide_dropdown():r?e.show_dropdown():void 0}}(this)),this.$dropdown.find(".bubble-picker-option:not('.disabled')").click(function(n){return function(o){var r,i;return r=t(o.currentTarget),r.hasClass("disabled")?void 0:(i=n.get_value(),n.set_value(r.data("value")),n.$bubble_picker.trigger(e.CHANGED,{clicked_val:r.data("value"),old_val:i}),n.hide_dropdown())}}(this))},e.prototype.get_value=function(){return this.$bubble_picker.attr("data-selected-value")},e.prototype.set_value=function(t){var e;return this.$bubble_picker.attr("data-selected-value",t),this.$label.empty(),e=this.$bubble_picker.find("[data-value='"+t+"']"),this.$label.html(e.clone().html())},e.prototype.hide_dropdown=function(){return this.$dropdown.hide(),this._dropdown_shown=!1},e.prototype.show_dropdown=function(){return this.$dropdown.show(),this._dropdown_shown=!0},e.prototype.disable_option=function(e,n){var o,r;return r=this.$bubble_picker.find(".bubble-picker-option[data-value="+e+"]:not('.disabled')"),r.length>0&&(o=t(r.find(".role-option")),o.attr("saved-title",o.attr("title")),o.attr("title",n)),r.addClass("disabled")},e.prototype.enable_option=function(e){var n,o;return o=this.$bubble_picker.find(".bubble-picker-option.disabled[data-value="+e+"]"),n=t(o.find(".role-option")),n.attr("saved-title")&&(n.attr("title",n.attr("saved-title")),n.removeAttr("saved-title")),o.removeClass("disabled")},e}()});var __bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("modules/clean/components/input",["jquery","modules/clean/components/tabbable","modules/core/i18n"],function(t,e,n){var o,r,i;return i=n._,r=function(e){function n(e){this.$text_input=e,this._on_change=__bind(this._on_change,this),this.persistent_label=this.$text_input.is(".label-above"),this.$input=this.$text_input.find(".text-input-input"),this.$text_input.data("input-element",this.$input),this.$label=this.$text_input.find("label"),this.$text_input.find(".error-message").length&&this.$input.addClass("input-error"),this.$text_input.each(function(){return this.type="textinput"}),t.valHooks.textinput={get:function(){return function(e){return t(e).data("input-element").val()}}(this),set:function(){return function(e,n){return t(e).data("input-element").val(n),t(e).data("input-element").trigger("input")}}(this)},this.$text_input.focus(function(t){return function(){return setTimeout(function(){return t.$input.focus()},0)}}(this)),t(".autofocus").first().focus(),this._listen(),this._on_change(),n.__super__.constructor.call(this)}return __extends(n,e),n.prototype._listen=function(){return this.$input.on("keydown keyup paste input blur",function(t){return function(){return t._on_change()}}(this)),this.$input.on("blur",function(t){return function(e){return t.$text_input.trigger(e)}}(this)),this.$input.on("focus",function(t){return function(){return t.$input.removeClass("input-error")}}(this))},n.prototype._on_change=function(){return this.persistent_label?void 0:this.$label.toggle(!this.$input.val())},n}(e),o=function(e){function n(t){this.$text_input=t,this._on_change=__bind(this._on_change,this),this.$bubble_title=this.$text_input.find(".password-bubble-title"),this.$bubble_desc=this.$text_input.find(".password-bubble-desc"),this.$meter=this.$text_input.find(".password-input-meter"),this.$default_bubble_text=this.$bubble_desc.text(),this.$last_pwd="",require(["external/zxcvbn"]),n.__super__.constructor.call(this,this.$text_input)}return __extends(n,e),n.prototype._on_change=function(){var t,e,o,r,s;return e=this.$input.val(),this.$last_pwd!==e?(this.$last_pwd=e,"correcthorsebatterystaple"===e||"Tr0ub4dour&3"===e||"Tr0ub4dor&3"===e?(o=0,r=i("lol",{comment:"'lol'='laugh out loud'"}),this.$bubble_title.text(r),"correcthorsebatterystaple"===e?(t=i("Whoa there, don't take advice from a webcomic too literally ;)",{comment:"This text is displayed rarely, whenever a user selects a password that is from this comic: http://imgs.xkcd.com/comics/password_strength.png"}),this.$bubble_desc.text(t)):(t=i("Guess again",{comment:"this text is displayed rarely, whenever a user selects a password that is from this comic: http://imgs.xkcd.com/comics/password_strength.png"}),this.$bubble_desc.text(t))):(s=["",i("Weak"),i("So-so"),i("Good"),i("Great!")],o=this._score(e),r=s[o],this.$bubble_title.text(r),this.$bubble_desc.text(this.$default_bubble_text)),this.$meter.find(".password-input-dot").removeClass("password-input-dot-selected"),this.$meter.find(".password-input-dot").slice(4-o,4).addClass("password-input-dot-selected"),n.__super__._on_change.apply(this,arguments)):void 0},n.prototype._get_user_inputs=function(){var e,n,o,r,i;for(n=["dropbox"],i=this.$text_input.closest("form").find("input[type=text], input[type=email]"),o=0,r=i.length;r>o;o++)e=i[o],n.push(t(e).val());return n},n.prototype._score=function(t){return window.zxcvbn&&t?Math.max(1,zxcvbn(t,this._get_user_inputs()).score):0},n}(r),{TextInput:r,PasswordWatchInput:o}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/components/login_form",["jquery","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/ajax","modules/clean/components/ajax_form","modules/clean/sso_login_checks","modules/core/browser"],function(t,e,n,o,r,i,s,a){var _,u;return u=n._,_=function(){function n(t,e){if(this.multi_login=e,this._finish_login=__bind(this._finish_login,this),this._fill_two_factor_error=__bind(this._fill_two_factor_error,this),this._fill_login_error=__bind(this._fill_login_error,this),this._resend_code=__bind(this._resend_code,this),this._resend_code_success=__bind(this._resend_code_success,this),this._two_factor_success=__bind(this._two_factor_success,this),this._login_success=__bind(this._login_success,this),this._check_if_needs_captcha=__bind(this._check_if_needs_captcha,this),this._hide_captcha=__bind(this._hide_captcha,this),this._show_captcha=__bind(this._show_captcha,this),this._show_two_factor=__bind(this._show_two_factor,this),this._show_login=__bind(this._show_login,this),this._hide_sso=__bind(this._hide_sso,this),this._show_sso=__bind(this._show_sso,this),this.$login_form=t.find(".login-form"),this.$two_factor_form=t.find(".two-factor-form"),this.login_controller=new i(this.$login_form),this.$login_form.on(i.SUCCESS_EVENT,this._login_success),this.$login_form.on(i.ERROR_EVENT,this._check_if_needs_captcha),this._check_if_needs_captcha(),this.cont=this.$login_form.find("input[name='cont']").val(),this.two_factor_controller=new i(this.$two_factor_form),this.$two_factor_form.on(i.SUCCESS_EVENT,this._two_factor_success),this.$two_factor_form.find(".resend-two-factor-code").click(this._resend_code),this.$login_form.find(".sso-optout a").click(function(t){return function(){return t._hide_sso(!0)}}(this)),this.$login_form.find(".login-button").attr("disabled",!1),this.$login_form.find("input[name='login_email']")[0].value)try{this.$login_form.find("input[name='login_password']")[0].focus()}catch(n){}new s(this.$login_form.find("input[name='login_email']"),this._show_sso,this._hide_sso)}return n.LOGIN_SUCCESS="db:login:success",n.MULTI_LOGIN_SUCCESS="db:multilogin:success",n.prototype._show_sso=function(t){return this.$login_form.find("input[name='login_password']").val(""),this.$login_form.addClass("sso-required"),t?this.$login_form.addClass("sso-optional"):void 0},n.prototype._hide_sso=function(t){if(null==t&&(t=!1),this.$login_form.removeClass("sso-required sso-optional"),t)try{return this.$login_form.find("input[name='login_password']").focus()}catch(e){}},n.prototype._show_login=function(){return this.$two_factor_form.hide(),t(".login-register-header, .login-register-switch").show(),this.$login_form.show(),this.$login_form.find("input[name='login_password']").val("")},n.prototype._show_two_factor=function(){t(".login-register-header, .login-register-switch").hide(),this.$login_form.hide(),this.$two_factor_form.show();try{return this.$two_factor_form.find("input[name='code']").val("").focus()}catch(e){}},n.prototype._show_captcha=function(){var e,n;return e=this.$login_form.find(".recaptcha-container"),e.is(":visible")?Recaptcha.reload():(n=this.$login_form.find("input[name='recaptcha_public_key']").val(),t.getScript("https://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){return Recaptcha.create(n,"divRecaptcha",{theme:"custom"})})),null!=e?e.show():void 0},n.prototype._hide_captcha=function(){var t;return null!=(t=this.$login_form.find(".recaptcha-container"))?t.hide():void 0},n.prototype._check_if_needs_captcha=function(t,e){return this.$login_form.find(".recaptcha-container").length?r.WebRequest({url:"/needs_captcha",data:{email:this.$login_form.find("input[name='login_email']").val()},success:function(n){return function(r){try{return e=JSON.parse(r),e.needs_login_captcha?n._show_captcha():n._hide_captcha()}catch(i){return t=i,o.error(o.DEFAULT_ERROR)}}}(this)}):void 0},n.prototype._login_success=function(t,n){var r;switch(n.status){case"OK":return this._finish_login(n);case"TWOFACTOR":return n.last_four_digits?(this.$two_factor_form.addClass("hide-authenticator"),this.$two_factor_form.find(".last-four-digits").text(n.last_four_digits)):this.$two_factor_form.addClass("hide-sms"),this.$two_factor_form.find("input[name='remember_me']").val(n.remember_me),this._show_two_factor();case"SSO":return a.unsafeRedirect(n.sso_url);case"RATELIMIT":return this._fill_login_error(u("You've tried to log in too many times. Please try again in a few minutes."));case"ERROR":return r=n.html_response?new e(n.message):n.message,o.error(r);case"EXPIRED":return a.redirect(n.cont);default:return o.error()}},n.prototype._two_factor_success=function(t,e){switch(e.status){case"OK":return this._finish_login(e);case"REQUIRES_ROLE":return this._show_login(),this._fill_login_error(e.message);case"EXPIRED":return this._fill_two_factor_error(u("This code has expired"));case"RATELIMIT":return this._fill_two_factor_error(u("You've tried to log in too many times. Please try again in a few minutes."));case"INVALID":return this._fill_two_factor_error(u("Invalid code"));case"ERROR":return o.error(e.message);default:return o.error()}},n.prototype._resend_code_success=function(t){switch(t){case"OK":return o.success(u("We sent you another code. It may take a few minutes to arrive."));case"RATELIMIT":return this._fill_two_factor_error(u("You've tried to log in too many times. Please try again in a few minutes."));case"UNREACHABLE":return this._fill_two_factor_error(u("We couldn't reach your phone number. Are you sure it's correct?"));case"EXPIRED":return this._fill_two_factor_error(u("Sorry, your phone code has expired. Please log in again."));case"BADCARRIER":return this._fill_two_factor_error(u("Unfortunately, your carrier is not supported at this time."));case"INVALIDNUMBER":return this._fill_two_factor_error(u("That is not a valid phone number."));case"NOTAMOBILE":return this._fill_two_factor_error(u("That phone number does not appear to be a valid mobile number."));default:return o.error()}},n.prototype._resend_code=function(){return r.WebRequest({url:"/twofactor_resend",success:this._resend_code_success,error:function(){return o.error()}}),!1},n.prototype._fill_login_error=function(t){return i.fill_errors(this.$login_form,{login_email:{message_text:t}})},n.prototype._fill_two_factor_error=function(t){return i.fill_errors(this.$two_factor_form,{code:{message_text:t}})},n.prototype._finish_login=function(t){var e;return e=this.multi_login?n.MULTI_LOGIN_SUCCESS:n.LOGIN_SUCCESS,this.$login_form.trigger(e,t),this.cont?a.redirect(this.cont):void 0},n}(),__CONDITIONAL_JS__.LoginForm=_,_}),define("modules/clean/components/login_or_register",["jquery"],function(){var t;return t=function(){function t(t){var e,n;e=t.find(".login-register-login-part"),n=t.find(".login-register-register-part"),t.click(function(){return function(t){return t.target.hasClassName("login-register-switch-link")?(t.preventDefault(),e.toggle(),n.toggle()):void 0}}(this))}return t}()}),define("modules/clean/components/tabbable",["jquery"],function(t){var e;return e=function(){function e(){e.initialized||this.listen()}return e.initialized=!1,e.prototype.listen=function(){return e.initialized=!0,t(document).on("keydown",function(){return function(e){return 9===e.keyCode?t(document.body).addClass("tabbing"):void 0}}(this)),t(document).on("mousedown",function(){return function(){return t(document.body).removeClass("tabbing")}}(this))},e}()});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("modules/clean/components/tooltip",["jquery","modules/core/dom"],function(t,e){var n,o,r;return r=[],n=function(){function t(t,n){var o;this.$wrapper=t,this.prompt=this.$wrapper.find(".tooltip-prompt"),this.tooltip=this.$wrapper.find(".tooltip-tooltip"),this.hover_target=this.find_hover_target(),this.position_global=n,this.listen(),o=e.clone(this.tooltip).appendTo("body"),o.css({position:"static",display:"inline-block"}),this.tooltip.css({width:o.width(),position:"absolute",display:"none"}),o.remove(),this.position_global&&this.tooltip.remove().appendTo("body")}return t.prototype.tooltip_shown=!1,t.prototype.position_global=!1,t.prototype.listen=function(){var t,e,n,o,r;for(o=[this.hover_target,this.tooltip],r=[],e=0,n=o.length;n>e;e++)t=o[e],t.mouseenter(function(t){return function(){return clearTimeout(t.tooltip.data("timeout_id")),t.show_tooltip()}}(this)),r.push(t.mouseleave(function(t){return function(){var e;return e=setTimeout(function(){return t.hide_tooltip()},200),t.tooltip.data("timeout_id",e)}}(this)));return r},t.prototype.find_hover_target=function(){return this.prompt},t.prototype.show_tooltip=function(){var t,e,n,o;if(!this.tooltip_shown){for(t=this.position_global?this.hover_target.offset():this.hover_target.position(),n=0,o=r.length;o>n;n++)e=r[n],e.hide_tooltip();return r.push(this),this.tooltip.css("top",t.top-this.tooltip.outerHeight()/2+this.hover_target.outerHeight()/2),this.tooltip.css("left",t.left+this.hover_target.width()+2),this.tooltip.show(),this.tooltip.animate({left:"+=7"},50),this.tooltip_shown=!0}},t.prototype.hide_tooltip=function(){var t;if(this.tooltip_shown)return clearTimeout(this.tooltip.data("timeout_id")),this.tooltip.hide(),this.tooltip_shown=!1,t=r.indexOf(this),-1!==t?r.splice(t,1):void 0},t}(),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.find_hover_target=function(){return this.prompt.find(".sprite")},e}(n),{DBTooltip:n,InfoTooltip:o}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}},__indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};define("modules/clean/contacts/cache",["modules/core/exception","modules/clean/ajax","modules/clean/contacts/list"],function(t,e,n){var o,r,i;return i=t.assert,o=function(){function t(){this._update_loading_state=__bind(this._update_loading_state,this),this._invoke_callbacks=__bind(this._invoke_callbacks,this),this._invoke_all_callbacks=__bind(this._invoke_all_callbacks,this),this.unregister_for_updates=__bind(this.unregister_for_updates,this),this.register_for_updates=__bind(this.register_for_updates,this),this.loading_state=t.HAVENT_LOADED,this.callbacks={},this.one_time_callbacks=[]}return t.HAVENT_LOADED=0,t.LOADING_NONE_AVAILABLE=1,t.LOADING_STALE_AVAILABLE=2,t.LOADED=3,t.prototype.load_contacts=function(o,r,i){var s;if(null!=i&&__indexOf.call(this.one_time_callbacks,i)<0&&this.one_time_callbacks.push(i),o){if(this.loading_state===t.LOADING_STALE_AVAILABLE)return}else{if(this.loading_state===t.LOADING_NONE_AVAILABLE)return;if(this.loading_state!==t.HAVENT_LOADED)return void this._invoke_all_callbacks()}return this._update_loading_state(this.loading_state===t.LOADED?t.LOADING_STALE_AVAILABLE:t.LOADING_NONE_AVAILABLE),
s=function(t){return function(e,o){var r;return t._update_loading_state(o),r=n.create_contacts_list(e),t.precached_contacts=r.contacts,t.cached_contacts=r,t._invoke_all_callbacks()}}(this),this.loading_state===t.LOADING_NONE_AVAILABLE&&e.BackgroundRequest({url:"/get_cached_contacts",data:{include_rooms:r},success:function(e){return function(n){var o;return e.loading_state===t.LOADING_NONE_AVAILABLE&&(o=JSON.parse(n),o.length)?s(o,t.LOADING_STALE_AVAILABLE):void 0}}(this)}),e.BackgroundRequest({url:"/get_refreshed_contacts?long_running=1",data:{include_rooms:r},success:function(){return function(e){var n;return n=JSON.parse(e),s(n,t.LOADED)}}(this)})},t.prototype.register_for_updates=function(t,e){return this.callbacks[t]=e},t.prototype.unregister_for_updates=function(t){return __indexOf.call(Object.keys(this.callbacks),t)>=0?delete this.callbacks[t]:void 0},t.prototype._invoke_all_callbacks=function(){return this._invoke_callbacks(this.one_time_callbacks,!0),this._invoke_callbacks(this.callbacks,!1)},t.prototype._invoke_callbacks=function(t,e){var n,o,r,i,s;for(i=Object.keys(t),s=[],o=0,r=i.length;r>o;o++)n=i[o],t[n](this.cached_contacts),s.push(e?delete t[n]:void 0);return s},t.prototype._update_loading_state=function(e){return i(e===t.LOADING_NONE_AVAILABLE||e===t.LOADING_STALE_AVAILABLE||e===t.LOADED),this.loading_state=e},t}(),r=new o,{ContactsCache:o,DefaultContactsCache:r}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("modules/clean/contacts/facebook_modal",["modules/clean/dbmodal"],function(t){var e,n;return e=t.DBUserModal,n=function(t){function e(t,n,o){this.show_hidden_modal=n,this.link_with_facebook=o,this.on_confirm_button_click=__bind(this.on_confirm_button_click,this),this.on_hide=__bind(this.on_hide,this),e.__super__.constructor.call(this,t,{element_id:"facebook-confirm-modal-user-"+t.id})}return __extends(e,t),e.prototype.on_hide=function(){return"function"==typeof this.show_hidden_modal?this.show_hidden_modal():void 0},e.prototype.on_confirm_button_click=function(){return this.hide(),this.link_with_facebook()},e}(e)}),define("modules/clean/contacts/facebook_oauth",["jquery","modules/core/exception","modules/core/uri","modules/clean/ajax","modules/clean/viewer"],function(t,e,n,o,r){var i,s;return s=e.assert,i={do_auth:function(t,e){var o;return s(null!=e,"user_id must be specified"),o=window.open(n({path:"/fb/access_token"}).updateQuery(Constants.UID_PARAM_NAME,e).toString(),"fb_auth","width=600,height=450"),t?i.onLoginSuccessCallback=t:void 0},post:function(t,e,a,_,u,c,l){return s(null!=l,"user_id must be specified!"),r.get_viewer().is_signed_in?("function"==typeof i.custom_show_posting&&i.custom_show_posting(),new o.WebRequest({url:"/fb/post",data:{message:t,link:e,link_name:a,description:_,from_referrals:i.from_referrals,from_getspace:i.from_getspace,picture:u?u:""},success:function(n,o,r){var s;return s=r.responseText,0===s.indexOf("ok")?"function"==typeof i.custom_show_complete?i.custom_show_complete():void 0:0===s.indexOf("auth")?i.do_auth(function(){return i.post(t,e,a,_,u,c,l)},l):void 0},error:function(){return"function"==typeof c?c():void 0},subject_user:l})):void window.open(n.parse("http://www.facebook.com/sharer.php").setQuery({u:e,t:a}).toString())}}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/contacts/importer",["jquery","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/analytics","modules/clean/contacts/cache","modules/clean/contacts/facebook_modal","modules/clean/contacts/facebook_oauth","modules/clean/profile_services/profile_services_constants","modules/clean/history","modules/clean/viewer"],function(t,e,n,o,r,i,s,a,_,u,c,l,d){var h,p,f,m,g;return m=e.assert,g=n._,f=s.SharedFolderActivityLogger,p=a.DefaultContactsCache,h=function(){function e(t,n,o,r){var s;return this.user=t,this.on_update_services=n,this.hide_containing_modal=o,this.show_containing_modal=r,this.update_contacts_to_import_from_email_address=__bind(this.update_contacts_to_import_from_email_address,this),this._get_content_tab_selector=__bind(this._get_content_tab_selector,this),this._finish_auth_failure=__bind(this._finish_auth_failure,this),this._finish_auth_success=__bind(this._finish_auth_success,this),this.yahoo_auth_complete=__bind(this.yahoo_auth_complete,this),this.facebook_auth_complete=__bind(this.facebook_auth_complete,this),this.google_auth_complete=__bind(this.google_auth_complete,this),this.auth_complete=__bind(this.auth_complete,this),this.deauth_import=__bind(this.deauth_import,this),this.auth_import=__bind(this.auth_import,this),this.import_profile_photo=__bind(this.import_profile_photo,this),this.has_connected_services=__bind(this.has_connected_services,this),this.has_unconnected_services=__bind(this.has_unconnected_services,this),this.paired_account_has_facebook=__bind(this.paired_account_has_facebook,this),m(null!=this.user,"invalid user"),s=function(){var t,e,n,o,r;for(t={},r=c.services(),n=0,o=r.length;o>n;n++)e=r[n],t[""+e]=!0;return t},this.contacts_to_import=c.NONE,this.connected_services=s(),this.suggestions_enabled=!1,this.photo_loaded_callback=null,this.photo_load_error=null,e.ever_updated||e.update_connection_state_from_server(),d.get_viewer().is_user_signed_in(this.user)&&i.WebRequest({url:"/contacts/get_importer_suggestions_pref",subject_user:this.user.id,success:function(t){return function(e,n,o){return t.suggestions_enabled=JSON.parse(o.responseText)}}(this)}),this}return e._USER_CACHE={},e.get_contacts_importer=function(t){var n,o,r;return null!=(null!=t?t.user:void 0)?r=t.user:null!=(null!=t?t.user_id:void 0)?r=d.get_viewer().get_user_by_id(t.user_id,n=!0):m(!1,"must pass a user= or user_id= in options"),null!=this._USER_CACHE[r.id]?(o=this._USER_CACHE[r.id],null!=(null!=t?t.on_update_services:void 0)&&(o.on_update_services=t.on_update_services),null!=(null!=t?t.hide_containing_modal:void 0)&&(o.hide_containing_modal=t.hide_containing_modal),null!=(null!=t?t.show_containing_modal:void 0)&&(o.show_containing_modal=t.show_containing_modal)):o=this._USER_CACHE[r.id]=new e(r,null!=t?t.on_update_services:void 0,null!=t?t.hide_containing_modal:void 0,null!=t?t.show_containing_modal:void 0),o},e.update_connection_state_from_server=function(){return this.ever_updated=!0,i.WebRequest({url:"/contacts/connected_services",success:function(t,n,o){var r,i,s,a,_;a=JSON.parse(o.responseText),_=[];for(s in a)r=a[s],i=e.get_contacts_importer({user_id:s}),i.connected_services=r,i.update_contacts_to_import_from_email_address(),_.push("function"==typeof i.on_update_services?i.on_update_services():void 0);return _}})},e.prototype.paired_account_has_facebook=function(){var t,n,o,r,i,s;for(s=d.get_viewer().get_users(t=!0),r=0,i=s.length;i>r;r++)if(o=s[r],o!==this.user&&(n=e.get_contacts_importer({user:o}),n.connected_services[c.FACEBOOK]))return!0;return!1},e.prototype.has_unconnected_services=function(){var t,e,n,o;t=!0,o=this.connected_services;for(e in o)n=o[e],t=t&&n;return!t},e.prototype.has_connected_services=function(){var t,e,n,o;t=!1,o=this.connected_services;for(e in o)n=o[e],t=t||n;return t},e.prototype.import_profile_photo=function(t,e,n){var o;switch(null==e&&(e=null),null==n&&(n=null),null!=e&&e!==this.photo_loaded_callback&&(this.photo_loaded_callback=e),null!=n&&n!==this.photo_load_error&&(this.photo_load_error=n),t){case c.GOOGLE:o="/google/get_photo";break;case c.YAHOO:o="/yahoo/get_photo";break;default:m(!1,"Profiles are only availible for Google and Yahoo")}return i.WebRequest({url:o,subject_user:this.user.id,success:function(t){return function(e){return null!=t.photo_loaded_callback?t.photo_loaded_callback(e):void 0}}(this),error:function(e){return function(n,o,r){return 403===n.status?e.auth_import(t,"import_photo"):null!=e.photo_load_error?e.photo_load_error(r):void 0}}(this)})},e.prototype.auth_import=function(t,e,n){var o,i;return null==e&&(e=""),null==n&&(n="none"),o=function(n){return function(){var o,i;switch(i=function(t,o){var i;return i={},i[Constants.UID_PARAM_NAME]=n.user.id,i.cont=e,window.open(String(r.parse(t).setQuery(i)),o,"width=600,height=450")},t){case c.GOOGLE:i("/google/authentry","google_auth");break;case c.YAHOO:i("/yahoo/authentry","yahoo_auth");break;case c.FACEBOOK:i("/fb/access_token","fb_auth");break;default:m(!1,"Should never get here.  Input should be an ProfileServicesConstants.")}return o={service:c.logging_identifiers(t)},f.log("web","import_contacts_from_service",n.user,o),"function"==typeof n.on_open_auth_popup?n.on_open_auth_popup():void 0}}(this),this.paired_account_has_facebook()&&t===c.FACEBOOK?("function"==typeof this.hide_containing_modal&&this.hide_containing_modal(),i=new _(this.user,this.show_containing_modal,o),i.show()):o()},e.prototype.deauth_import=function(e,n){var r;switch(r=this._get_content_tab_selector(),e){case c.GOOGLE:return i.WebRequest({url:"/google/remove_contacts",subject_user:this.user.id,data:{source_id:n},success:function(){return t(""+r+" .auth-gmail").show(),t(""+r+" .deauth-gmail").hide(),o.success(g("Successfully removed Gmail contacts"))},error:function(){return o.error(g("We were unable to remove your Gmail contacts"))}});case c.YAHOO:return i.WebRequest({url:"/yahoo/remove_contacts",subject_user:this.user.id,success:function(){return t(""+r+" .auth-yahoo-mail").show(),t(""+r+" .deauth-yahoo-mail").hide(),o.success(g("Successfully removed Yahoo! Mail contacts."))},error:function(){return o.error(g("We were unable to remove your Yahoo! Mail contacts."))}});default:return m(!1,"Should never get here.  Input should be an ProfileServicesConstants.")}},e.prototype.auth_complete=function(t,e,n,o,r){var i;return null==n&&(n=""),null==r&&(r=null),i={},i[c.GOOGLE]=this.google_auth_complete,i[c.YAHOO]=this.yahoo_auth_complete,"function"==typeof i[t]?i[t](e,n,o,r):void 0},e.prototype.google_auth_complete=function(t,e,n,o){var r;return null==e&&(e=""),null==o&&(o=null),r={service:c.logging_identifiers(c.GOOGLE),success:t,error:n},f.log("web","import_contacts_auth_completed",this.user,r),t?this._finish_auth_success(c.GOOGLE,e,g("Imported Gmail contacts.")):this._finish_auth_failure(c.GOOGLE,e,n||g("We need your permission to import your Gmail contacts."))},e.prototype.facebook_auth_complete=function(t,e,n){var o;return null==e&&(e=""),o={service:c.logging_identifiers(c.FACEBOOK),success:t,error:n},f.log("web","import_contacts_auth_completed",this.user,o),t?(u.authed_user_id=this.user.id,null!=u.onLoginSuccessCallback&&(u.onLoginSuccessCallback(),u.onLoginSuccessCallback=null),this._finish_auth_success(c.FACEBOOK,g("Successfully connected to Facebook."))):this._finish_auth_failure(c.FACEBOOK,e,n||g("We need your permission to import your Facebook friends."))},e.prototype.yahoo_auth_complete=function(t,e,n){var o;return null==e&&(e=""),o={service:c.logging_identifiers(c.YAHOO),success:t,error:n},f.log("web","import_contacts_auth_completed",this.user,o),t?this._finish_auth_success(c.YAHOO,e,g("Imported Yahoo! Mail contacts.")):this._finish_auth_failure(c.YAHOO,e,n||g("We need your permission to import your Yahoo! Mail contacts."))},e.prototype._finish_auth_success=function(n,r,s){var a,_;switch(null==r&&(r=""),r){case"import_photo":this.import_profile_photo(n,this.photo_loaded_callback,this.photo_load_error)}switch(n){case c.GOOGLE:l.get_url().startsWith("/account")&&(_=this._get_content_tab_selector(),i.WebRequest({url:"/google/display_email",subject_user:this.user.id,dataType:"json",success:function(){return function(e){var n;return n=e.gmail_address,t(""+_+" .gmail-address").text(n)}}(this),error:function(){return function(){return t(""+_+" .gmail-address").text(g("Connected"))}}(this),complete:function(){return function(){return t(""+_+" .auth-gmail").hide(),t(""+_+" .deauth-gmail").show()}}(this)}));break;case c.FACEBOOK:0===l.get_url().indexOf("/account")&&(_=this._get_content_tab_selector(),i.WebRequest({url:"/fb/get_fb_profile",subject_user:this.user.id,dataType:"json",success:function(){return function(e){var n,o;return n=e,o=n.username?n.username:'"'+n.name+'"',t(""+_+" .facebook-username").text(o)}}(this),error:function(){return function(){return t(""+_+" .facebook-username").text(g("Connected"))}}(this),complete:function(){return function(){return t(".auth-facebook").show(),t(""+_+" .auth-facebook").hide(),t(".deauth-facebook").hide(),t(""+_+" .deauth-facebook").show()}}(this)}));break;case c.YAHOO:_=this._get_content_tab_selector(),t(""+_+" .auth-yahoo-mail").hide(),t(""+_+" .deauth-yahoo-mail").show()}return n===this.contacts_to_import&&(this.contacts_to_import=c.VARIOUS),this.connected_services[n]=!0,e.update_connection_state_from_server(),p.load_contacts(a=!0),o.success(s),"function"==typeof this.on_update_services&&this.on_update_services(),"function"==typeof this.on_auth_success?this.on_auth_success(n):void 0},e.prototype._finish_auth_failure=function(t,e,n){switch(null==e&&(e=""),e){case"import_photo":null!=this.photo_load_error&&this.photo_load_error(n)}return o.error(n),"function"==typeof this.on_auth_failure?this.on_auth_failure(t):void 0},e.prototype._get_content_tab_selector=function(){return d.get_viewer().is_paired?"#"+this.user.role+"-content":""},e.prototype.update_contacts_to_import_from_email_address=function(){var t,e,n;return t=/@(.+?)\./g,e=t.exec(this.user.email),e&&e.length>1?this.contacts_to_import="gmail"!==e[1]||this.connected_services[c.GOOGLE]?"yahoo"!==(n=e[1])&&"ymail"!==n&&"rocketmail"!==n||this.connected_services[c.YAHOO]?c.VARIOUS:c.YAHOO:c.GOOGLE:void 0},e}(),INLINE_JS.ContactsImporter=h,h});var __bind=function(t,e){return function(){return t.apply(e,arguments)}},__indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};define("modules/clean/contacts/list",["jquery","modules/clean/em_string","modules/clean/contacts/types"],function(t,e,n){var o;return o=function(){function t(t){var e;this.contacts=t,this._lowercaseContact=__bind(this._lowercaseContact,this),this._excludeType=__bind(this._excludeType,this),this.sortByTeamFirst=__bind(this.sortByTeamFirst,this),this.excludeNonTeam=__bind(this.excludeNonTeam,this),this.excludeTeamMembers=__bind(this.excludeTeamMembers,this),this.excludeRooms=__bind(this.excludeRooms,this),this.excludeFacebook=__bind(this.excludeFacebook,this),this.excludeNewStyleGroups=__bind(this.excludeNewStyleGroups,this),this.excludeGroups=__bind(this.excludeGroups,this),this.excludeMe=__bind(this.excludeMe,this),this.excludeByEmail=__bind(this.excludeByEmail,this),this.includeForUser=__bind(this.includeForUser,this),this.slice=__bind(this.slice,this),this.length=__bind(this.length,this),this.filterContacts=__bind(this.filterContacts,this),this.lcontacts=function(){var t,n,o,r;for(o=this.contacts,r=[],t=0,n=o.length;n>t;t++)e=o[t],r.push(this._lowercaseContact(e));return r}.call(this)}return t._format_contact_array=function(t){var n,o,r,i;for(n=22,r=0,i=t.length;i>r;r++)o=t[r],null!=o.email&&(o.email_snippet=e.em_snippet(o.email,n)),null!=o.name&&(o.name=e.em_snippet(o.name,n));return t},t.create_contacts_list=function(e){return e=t._format_contact_array(e),new t(e)},t.prototype.filterContacts=function(e){var n;return n=this.contacts.filter(e),new t(n)},t.prototype.length=function(){return this.contacts.length},t.prototype.slice=function(e,n){return new t(this.contacts.slice(e,n))},t.prototype.includeForUser=function(t){return this.filterContacts(function(e){return e.owning_user_id===t})},t.prototype.excludeByEmail=function(t){var e,n;return n=[function(){var n,o,r;for(r=[],n=0,o=t.length;o>n;n++)e=t[n],r.push(e.toLowerCase());return r}()],this.filterContacts(function(){return function(t){var e;return e=t.email.toLowerCase(),!(__indexOf.call(n,e)>=0)}}(this))},t.prototype.excludeMe=function(){return this.filterContacts(function(t){return!t.is_owner})},t.prototype.excludeGroups=function(){return this._excludeType(n.USER_GROUP)},t.prototype.excludeNewStyleGroups=function(){return this._excludeType(n.NEW_STYLE_GROUP)},t.prototype.excludeFacebook=function(){return this._excludeType(n.FB)},t.prototype.excludeRooms=function(){return this._excludeType(n.CAROUSEL_ROOM)},t.prototype.excludeTeamMembers=function(){return this.filterContacts(function(t){return!t.team})},t.prototype.excludeNonTeam=function(){return this.filterContacts(function(t){return t.team})},t.prototype.sortByTeamFirst=function(){var e,o,r,i,s,a;for(r=[],o=[],a=this.contacts,i=0,s=a.length;s>i;i++)e=a[i],e.team||e.type===n.USER_GROUP?r.push(e):o.push(e);return new t(r.concat(o))},t.prototype._excludeType=function(t){return this.filterContacts(function(e){return e.type!==t})},t.prototype._lowercaseContact=function(t){var e,n,o;n={};for(e in t)o=t[e],("string"==typeof o||o instanceof String)&&(o=o.toLowerCase()),n[e]=o;return n},t}()}),define("modules/clean/contacts/types",[],function(){var t;return t={EMAIL:0,FB:1,INVALID:2,USER_GROUP:3,NEW_STYLE_GROUP:4,CAROUSEL_ROOM:5}}),define("modules/clean/datetime",["modules/core/exception","modules/core/i18n"],function(t,e){var n,o,r,i,s,a,_,u,c,l,d,h,p,f;return r=t.assert,f=e._,p=e.ungettext,l=[f("January"),f("February"),f("March"),f("April"),f("May"),f("June"),f("July"),f("August"),f("September"),f("October"),f("November"),f("December")],n=[f("Jan"),f("Feb"),f("Mar"),f("Apr"),f("May"),f("Jun"),f("Jul"),f("Aug"),f("Sep"),f("Oct"),f("Nov"),f("Dec")],c=function(t,e){return e?n[t]:l[t]},s=function(t,e){var n;return n=[f("AM"),f("PM")],e.replace(/'[^']*'|y+|M+|d+|h+|k+|K+|H+|m+|s+|S+|a+/g,function(e){var o;switch(e[0]){case"'":return 2===e.length?"'":e.slice(1,-1);case"y":if("yy"===e)return t.getYear()%100;o=t.getFullYear();break;case"M":if(e.length>=3)return c(t.getMonth(),3===e.length);o=t.getMonth()+1;break;case"d":o=t.getDate();break;case"h":o=t.getHours()%12||12;break;case"k":o=t.getHours()%12+1;break;case"K":o=t.getHours()%12;break;case"H":o=t.getHours();break;case"m":o=t.getMinutes();break;case"s":o=t.getSeconds();break;case"S":o=t.getMilliseconds();break;case"a":return n[1*(t.getHours()>=12)]}return o=""+o,o.length<e.length&&(o=("00000000"+o).slice(-1*e.length)),o})},a=function(t){var e,n,o,i,s,a,_;for(i=[86400,3600,60,1],t=isNaN(t)?0:t,e=a=0,_=i.length;_>a;e=++a)if(o=i[e],t>=o){s=parseInt(t/o,10)||0;break}return 1>t&&(s=0),e>=3?n=p("%d sec","%d secs",s).format(s):2===e?n=p("%d min","%d mins",s).format(s):1===e?n=p("%d hour","%d hours",s).format(s):0===e?n=p("%d day","%d days",s).format(s):r(!1,"Invalid time"),n},u=function(t,e){return f("%(month)s %(year)s",{comment:"Like Jun 2012"}).format({month:c(t,!0),year:e})},d=function(t,e,n,o){var r,i,s,a;return null==n&&(n=!1),null==o&&(o=!1),n?(r=t.getUTCDate(),i=t.getUTCMonth(),a=t.getUTCFullYear()):(r=t.getDate(),i=t.getMonth(),a=t.getFullYear()),s=c(i,!o),e?f("%(month)s %(date)s, %(year)s",{comment:"Like Jan 15, 2014"}).format({month:s,date:r,year:a}):f("%(month)s %(date)s",{comment:"Like Jan 15"}).format({month:s,date:r})},o=function(t){var e,n,o,r,i,s,a,_;return i=new Date(Date.now()),s=(i.getTime()-t.getTime())/1e3,60>s?p("%d sec ago","%d secs ago",s).format(s):3600>s?(o=parseInt(s/60,10),p("%d min ago","%d mins ago",o).format(o)):86400>s?(n=parseInt(s/3600,10),p("%d hour ago","%d hours ago",n).format(n)):2592e3>s?(e=parseInt(s/86400,10),p("%d day ago","%d days ago",e).format(e)):4838400>s?(a=parseInt(s/604800,10),p("%d week ago","%d weeks ago",a).format(a)):31536e3>s?(r=parseInt(s/2592e3,10),p("%d month ago","%d months ago",r).format(r)):(_=parseInt(s/31536e3,10),p("%d year ago","%d years ago",_).format(_))},_=function(t,e,n,o,r,i){return null==e&&(e=0),null==n&&(n=0),null==o&&(o=0),null==r&&(r=0),null==i&&(i=0),t.setFullYear(t.getFullYear()+e),t.setMonth(t.getMonth()+n),t.setDate(t.getDate()+o),t.setHours(t.getHours()+r),t.setMinutes(t.getMinutes()+i),t},h=function(){return(new Date).getTime()},i={abbr_month_names:n,ago:o,format_date:s,format_time:a,increment_date:_,month_abbr_with_year:u,month_name:c,month_names:l,nice_date_with_month_name:d,time:h}}),define("modules/clean/db_bubble",["jquery","modules/core/exception"],function(t,e){var n,o;return o=e.assert,n={position:function(e,n,r){var i,s,a,_,u,c,l;for(e=t(e).css({bottom:"auto",left:"auto",position:"absolute",right:"auto",top:"auto"}),o(e.find(".db-arrow").length,"db-arrow not found"),i=e.find(".db-arrow-border"),o(i.length,"db-arrow-border not found"),_=null,l=["top","right","bottom","left"],u=0,c=l.length;c>u;u++)if(a=l[u],e.hasClass("db-"+a+"-arrow")){_=a;break}return o(_,"No db-#{direction}-arrow class set"),"left"===_?s="left+"+i.outerWidth()+"px top-"+i.position().top+"px":"right"===_?s="right-"+i.outerWidth()+"px top-"+i.position().top+"px":"top"===_?s="left-"+i.position().left+"px top+"+i.outerHeight()+"px":"bottom"===_&&(s="left-"+i.position().left+"px bottom-"+i.outerHeight()+"px"),r||(r={top:"bottom",left:"right",bottom:"top",right:"left"}[_]),e.position({my:s,at:r,of:n,collision:"none"})}}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("modules/clean/dbmodal",["jquery","external/keymaster","modules/core/browser","modules/core/dom","modules/core/exception","modules/clean/viewer"],function(t,e,n,o,r){var i,s,a,_;return _=r.assert,s=function(){function e(){}return e.__stack=[],e.CLEAR="dbmodal:clear",e.pop=function(n){var o;return null==n&&(n=null),null!=n?e.remove(n):n=e.__stack.pop(),null!=n&&n._hide(),o=e.top(),null!=o?o._show():t(document).trigger(e.CLEAR)},e.push=function(t){var n;return _(t instanceof i,"must pass in valid DBModal"),e.remove(t),n=e.top(),(null!=n?n.visible:void 0)&&n._hide(),e.__stack.push(t),t._show()},e.top=function(){var t;return t=e.__stack.length,t?e.__stack[t-1]:null},e.remove=function(t){var n,o,r,i,s;for(o=[],s=e.__stack,r=0,i=s.length;i>r;r++)n=s[r],n!==t&&o.push(n);e.__stack=o},e.clear=function(){var n,o,r,i;for(n=r=i=e.__stack.length-1;r>=0;n=r+=-1)o=e.__stack[n],o.visible&&o._hide();return t(document).trigger(e.CLEAR),e.__stack=[]},e.register=function(n,o){return t(document).on(n,o),t(document).on(e.CLEAR,function(){return t(document).off(n,o)})},e.unregister=function(e,n){return t(document).off(e,n)},e.trigger=function(e,n){return t(document).trigger(e,n)},e}(),i=function(){function e(t){var n;this.options=t,this.set_title=__bind(this.set_title,this),this._hide=__bind(this._hide,this),this.resize=__bind(this.resize,this),this._show=__bind(this._show,this),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.__focus=__bind(this.__focus,this),this.__unlisten=__bind(this.__unlisten,this),this.__listen_buttons=__bind(this.__listen_buttons,this),this.__listen=__bind(this.__listen,this),this.__overlay_click_handler=__bind(this.__overlay_click_handler,this),this.__fix_position=__bind(this.__fix_position,this),this.__keydown_handler=__bind(this.__keydown_handler,this),this.__tabbable_elements=__bind(this.__tabbable_elements,this),this.__x_click_handler=__bind(this.__x_click_handler,this),this.__show_modal=__bind(this.__show_modal,this),this.__clone_modal=__bind(this.__clone_modal,this),this.format=__bind(this.format,this),this.on_cancel_button_click=__bind(this.on_cancel_button_click,this),this.on_confirm_button_click=__bind(this.on_confirm_button_click,this),this.before_show=__bind(this.before_show,this),this.element_id=e.add_role_to_id(this.options.element_id,this.options.role),this.$template=e.get_template(this.options.element_id),n=this.$template.find(".db-modal"),_(this.$template.length,"Missing DBModal pyxl element for '"+this.element_id+"'"),this.options.focus&&("confirm"===this.options.focus?_(n.find(".confirm-button").length,"DBModal pyxl element is missing a confirm button to focus"):"cancel"===this.options.focus?_(n.find(".cancel-button").length,"DBModal pyxl element is missing a cancel button to focus"):_(n.find(this.options.focus).length,"DBModal pyxl element is missing focus element with selector '"+this.options.focus+"'")),null!=this.on_show&&_("function"==typeof this.on_show,"'on_show' must be a function"),null!=this.before_show&&_("function"==typeof this.before_show,"'before_show' must be a function"),null!=this.on_hide&&_("function"==typeof this.on_hide,"'on_hide' must be a function"),null!=this.on_confirm_button_click&&_("function"==typeof this.on_confirm_button_click,"'on_confirm_button_click' must be a function"),null!=this.on_cancel_button_click&&_("function"==typeof this.on_cancel_button_click,"'on_cancel_button_click' must be a function"),this.options.vars&&(this.vars=this.options.vars),this.click_out_to_close=!0,this.options.click_out_to_close===!1&&(this.click_out_to_close=!1),this.prev_key_scope=null,this.vertical_offset=90}return e.KEY_SCOPE="dbmodal",e.__stack=[],e.get_containing_modal=function(t){var n,r;return r=t.closest(".db-modal-wrapper"),n=o.controller(r),n&&_(n instanceof e,"controller of .db-modal-wrapper must be a DBModal object"),n},e.prototype.before_show=function(){return null!=this.options.title?this.set_title(this.options.title):void 0},e.prototype.on_confirm_button_click=function(t){return t.preventDefault(),s.pop()},e.prototype.on_cancel_button_click=function(t){return t.preventDefault(),s.pop()},e.prototype.on_show=null,e.prototype.on_hide=null,e.prototype.format=function(t){var e,n;for(e in t)__hasProp.call(t,e)&&(n=t[e],this.$modal_window.find(e).text(n));return this},e.prototype.__clone_modal=function(){return this.$modal_window||(this.$modal_window=o.clone(this.$template).attr("id",this.element_id),this.$overlay=this.$modal_window.find(".db-modal-overlay")),o.set_controller(this.$modal_window,this),o.bind_controllers(this.$modal_window),t("body").prepend(this.$modal_window)},e.prototype.__show_modal=function(){return this.$modal_window.show(),this.__fix_position()},e.prototype.__x_click_handler=function(t){return t.preventDefault(),s.clear()},e.prototype.__tabbable_elements=function(){var e,n,o,r,i,s,a,u,c,l;if(a=this.$modal_window.find(".db-modal").find(":tabbable"),_(a.length,'"dbmodal-x" should be in tabbable_elms'),u=function(){var e,n,r;for(r=[],e=0,n=a.length;n>e;e++)o=a[e],parseInt(t(o).attr("tabindex"))>-1&&r.push(o);return r}(),u.length){for(s=function(e,n){var o,r;return o=parseInt(t(e).attr("tabindex"),10),r=parseInt(t(n).attr("tabindex"),10),r>o?-1:o>r?1:0},u.sort(s),r=-1,c=0,l=u.length;l>c;c++)o=u[c],i=a.index(o),-1===r&&(r=i),a.splice(i,1);_(r>-1,"First index should be set"),n=a.slice(0,r),e=a.slice(r),a=t.merge(n,u),a=t.merge(a,e)}return a},e.prototype.__keydown_handler=function(e){var n,r,i,a;if((27===e.keyCode||8===e.keyCode&&!o.focus_in_input())&&(e.preventDefault(),s.clear()),9===e.keyCode){if(e.preventDefault(),n=this.__tabbable_elements(),r=n.index(t(e.target)),0>r)return this.focus_element?t(this.focus_element).focus():(a=e.shiftKey?n.last():n.first(),a.focus());if(r>-1)return i=e.shiftKey?-1:1,a=(r+i)%n.length,n.get(a).focus()}},e.prototype.__fix_position=function(){var t,e;return t=this.$modal_window.find(".db-modal"),e=t.width(),t.css({margin:"0 0 0 "+Math.floor(-e/2).toString()+"px",position:"fixed",top:this.vertical_offset})},e.prototype.__overlay_click_handler=function(t){return t.preventDefault(),s.clear()},e.prototype.__listen=function(){return this.click_out_to_close!==!1&&this.$overlay.on("click",this.__overlay_click_handler),this.$db_modal_x=this.$modal_window.find(".db-modal-x"),this.$db_modal_x.on("click",this.__x_click_handler),t(document).on("keydown",this.__keydown_handler),this.__listen_buttons()},e.prototype.__listen_buttons=function(){return null!=this.on_confirm_button_click&&(this.$confirm_button=this.$modal_window.find(".confirm-button"),this.$confirm_button.on("click",this.on_confirm_button_click)),null!=this.on_cancel_button_click?(this.$cancel_button=this.$modal_window.find(".cancel-button"),this.$cancel_button.on("click",this.on_cancel_button_click)):void 0},e.prototype.__unlisten=function(){return this.click_out_to_close!==!1&&this.$overlay.off("click"),this.$db_modal_x.off("click"),t(document).off("keydown",this.__keydown_handler),null!=this.on_confirm_button_click&&this.$confirm_button.off("click"),null!=this.on_cancel_button_click?this.$cancel_button.off("click"):void 0},e.prototype.__focus=function(){var t,e,o,r;return e=this.$modal_window.find(".db-modal"),"confirm"===this.options.focus?this.focus_element=e.find(".confirm-button").first():"cancel"===this.options.focus?this.focus_element=e.find(".cancel-button").first():this.options.focus?this.focus_element=e.find(this.options.focus).first():(this.focus_element=e,t=e.find("input[type=text], input[type=email]").first(),t.length?this.focus_element=t:n.msie||(o=e.find("input[type=button]").first(),o.length&&(this.focus_element=o),r=e.find("input[type=submit]").first(),r.length&&(this.focus_element=r))),this.focus_element.focus()},e.add_role_to_id=function(t,e){return e?""+t+"-"+e:t},e.get_template=function(n,o){var r;return r=e.add_role_to_id(n,o),t("#db-modal-"+r)},e.prototype.show=function(){return s.push(this)},e.prototype.hide=function(){return this!==s.top()?(s.remove(this),this._hide()):s.pop()},e.prototype._show=function(){return this.visible?void 0:(this.__clone_modal(),"function"==typeof this.before_show&&this.before_show(this.$modal_window),this.__show_modal(),this.resize(),this.__listen(),this.visible=!0,window.key.getScope()!==this.constructor.KEY_SCOPE&&(this.prev_key_scope=window.key.getScope()),window.key.setScope(this.constructor.KEY_SCOPE),t(document).trigger("modalOpened",[1]),o.scroll_lock_document(),"function"==typeof this.on_show&&this.on_show(),this.__focus(),this)},e.prototype.resize=function(){var e;return e=t(window).height()-220,this.$modal_window.find(".db-modal-content").css(this.$modal_window.find(".db-modal").height()>e?{"max-height":e+"px","overflow-y":"auto"}:{"max-height":"","overflow-y":""})},e.prototype._hide=function(){return this.visible?(this.__unlisten(),window.key.setScope(this.prev_key_scope),this.$modal_window.remove(),this.visible=!1,this.prev_key_scope=null,t(document).trigger("modalClosed",[1]),o.scroll_unlock_document(),"function"==typeof this.on_hide&&this.on_hide(),this):void 0},e.prototype.set_title=function(t){return this.$modal_window.find(".db-modal-title-text").text(t),this},e}(),a=function(e){function n(t,e){this.user=t,this.__inject_basic_user_properties=__bind(this.__inject_basic_user_properties,this),this.before_show=__bind(this.before_show,this),n.__super__.constructor.call(this,e)}return __extends(n,e),n.prototype.before_show=function(t){return n.__super__.before_show.call(this,t),this.__inject_basic_user_properties(t)},n.prototype.__inject_basic_user_properties=function(e){var n,o;return n=e.find("form"),n.find("input[name='"+Constants.UID_PARAM_NAME+"']").remove(),o=t('<input type="hidden">').attr({name:Constants.UID_PARAM_NAME,value:this.user.id}),n.append(o),e.find(".dbmodal-email-placeholder").text(this.user.email)},n}(i),__CONDITIONAL_JS__.DBModalStack=INLINE_JS.DBModalStack=s,INLINE_JS.DBModal=i,{DBModalStack:s,DBModal:i,DBUserModal:a}});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("modules/clean/dbmodal_loading",["modules/clean/dbmodal","modules/clean/uirequest"],function(t,e){var n;return n=function(t){function n(t){n.__super__.constructor.call(this,t)}return __extends(n,t),n.prototype.on_show=function(){return this.fetch()},n.prototype.fetch=function(){return new e(this.$modal_window,this.options.endpoint_url,{data:this.options.parameters||{},
subject_user:this.options.subject_user,html_in_error_msg:this.options.html_in_error_msg,success:function(t){return function(){return t.resize()}}(this),error:function(t){return function(){return t.hide()}}(this)})},n.prototype.on_confirm_button_click=null,n.prototype.on_cancel_button_click=null,n}(t.DBModal)}),define("modules/clean/display_format",["modules/core/i18n"],function(t){var e,n,o;return o=t._,n=function(e,n){var r,i,s;return null==n&&(n=2),e=parseFloat(e),r=Math.abs(e),1024>r?(n=0,i=e,s=t.ungettext("byte","bytes",e)):921600>r?(i=e/1024,s=o("KB")):943718400>r?(i=e/1048576,s=o("MB")):966367641600>r||0===n&&1099511627776>e?(i=e/1073741824,s=o("GB")):(i=e/1099511627776,s=o("TB")),i=Math.round(i*Math.pow(10,n))/parseFloat(Math.pow(10,n)),i=i.toFixed(n),""+i+" "+s},e={format_bytes:n}}),define("modules/clean/dropbox_nav",["jquery","modules/clean/analytics","modules/clean/photos/photos_engagement_logger"],function(t,e,n){var o;return o=function(){function o(){t(".carousel-nav-item").click(function(t){return function(){return t.log_click("carousel_nav_link_click")}}(this)),t(".composer-nav-item").click(function(t){return function(){return t.log_click("composer_nav_link_click")}}(this)),t(".mailbox-nav-item").click(function(t){return function(){return t.log_click("mailbox_nav_link_click")}}(this)),t(".carousel-nav-item").click(function(){return n.log_and_send(n.CAROUSEL_NAV_LINK_CLICK)}),t(".photos-nav-item").click(function(){return n.log_and_send(n.PHOTOS_NAV_LINK_CLICK)})}return o.prototype.log_click=function(t){return e.WebMiscActivityLogger.log(t)},o}()}),define("modules/clean/em_string",[],function(){var t;return t=function(){function t(e){return this instanceof t?(this.s=e,this.info=this.widthInfo(),void(this.length=e.length?this.info[this.s.length-1]:0)):new t(e)}return t.em_snippet=function(e,n,o){return null==n&&(n=50),null==o&&(o=.75),new t(e.toString()).snippet(n,o).toString()},t.prototype.widthInfo=function(){var t,e,n,o;for(e={},e[-1]=0,t=n=0,o=this.s.length;o>=0?o>n:n>o;t=o>=0?++n:--n)e[t]=e[t-1]+this.ems(this.s.charAt(t));return e},t.prototype.findSpot=function(t){var e,n,o,r;if(!t)return 0;for(r=0,n=this.s.length;n>=r;)if(o=Math.floor(r/2+n/2),e=this.info[o-1],e>t)n=o-1;else{if(!(t>e))return o;r=o+1}return r>o?r:o},t.prototype.ems=function(e){var n,o,r,i,s;return o=.65,n=1.08,r=.58,i=e.charCodeAt(0),s=t.CODEPOINT_TO_WIDTH[i],s?s/Math.pow(10,t.ACCURACY):i>=768&&879>=i?0:i>=65377&&65500>=i?r:i>=11904&&40911>=i||i>=44032&&55215>=i||i>=4352&&4607>=i||i>=63744&&64255>=i||i>=65280&&65535>=i||i>=131072&&196607>=i?n:o},t.prototype.substr=function(e,n){var o,r;return r=this.findSpot(e),null!=n?(o=this.findSpot(e+n),new t(this.s.substr(r,o-r))):new t(this.s.substr(r))},t.prototype.toString=function(){return this.s},t.prototype.snippet=function(e,n){var o,r,i,s,a;return null==e&&(e=50),null==n&&(n=.75),this.length<=e?this:(e-=t._ELLIPSIS_LENGTH,o=e*n,s=e-o,a=this.length-s,i=this.substr(0,o),r=this.substr(a),new t(i.toString()+"…"+r.toString()))},t.ACCURACY=2,t.CODEPOINT_TO_WIDTH={32:38,33:25,34:42,35:67,36:58,37:92,38:75,39:25,40:33,41:33,42:58,43:58,44:25,45:33,46:25,47:42,48:58,49:58,50:58,51:58,52:58,53:58,54:58,55:58,56:58,57:58,58:25,59:25,60:58,61:58,62:58,63:50,64:100,65:67,66:67,67:67,68:75,69:58,70:58,71:75,72:83,73:33,74:25,75:67,76:58,77:100,78:83,79:83,80:67,81:83,82:67,83:58,84:58,85:75,86:67,87:100,88:67,89:58,90:58,91:33,92:42,93:33,94:58,95:50,96:67,97:58,98:67,99:50,100:67,101:58,102:33,103:58,104:67,105:25,106:25,107:58,108:25,109:100,110:67,111:67,112:67,113:67,114:42,115:50,116:42,117:67,118:58,119:83,120:58,121:58,122:50,123:42,124:58,125:42,126:58,161:25,162:58,163:58,164:58,165:58,166:58,167:58,168:67,169:92,170:42,171:50,172:58,174:92,175:58,176:50,177:58,178:42,179:42,180:67,181:67,182:75,183:25,184:25,185:42,186:42,187:50,188:83,189:83,190:83,191:50,192:67,193:67,194:67,195:67,196:67,197:67,198:92,199:67,200:58,201:58,202:58,203:58,204:33,205:33,206:33,207:33,208:75,209:83,210:83,211:83,212:83,213:83,214:83,215:58,216:83,217:75,218:75,219:75,220:75,221:58,222:67,223:67,224:58,225:58,226:58,227:58,228:58,229:58,230:92,231:50,232:58,233:58,234:58,235:58,236:25,237:25,238:25,239:25,240:67,241:67,242:67,243:67,244:67,245:67,246:67,247:58,248:67,249:67,250:67,251:67,252:67,253:58,254:67,255:58,256:75,257:67,258:75,259:67,260:75,261:67,262:75,263:58,264:75,265:58,266:75,267:58,268:75,269:58,270:83,271:83,272:83,273:75,274:67,275:67,276:67,277:67,278:67,279:67,280:67,281:67,282:67,283:67,284:83,285:75,286:83,287:75,288:83,289:75,290:83,291:75,292:83,293:75,294:92,295:75,296:33,297:33,298:33,299:33,300:33,301:33,302:33,303:33,304:33,305:25,306:67,307:67,308:42,309:33,310:75,311:67,312:67,313:58,314:33,315:58,316:33,317:58,318:42,319:58,320:50,321:67,322:42,323:83,324:75,325:83,326:75,327:83,328:75,329:83,330:83,331:75,332:92,333:67,334:92,335:67,336:92,337:67,338:100,339:100,340:75,341:50,342:75,343:50,344:75,345:50,346:67,347:58,348:67,349:58,350:67,351:58,352:67,353:58,354:75,355:42,356:75,357:42,358:75,359:42,360:83,361:75,362:83,363:75,364:83,365:75,366:83,367:75,368:83,369:75,370:83,371:75,372:100,373:92,374:75,375:58,376:75,377:67,378:67,379:67,380:67,381:67,382:67,383:42,384:75,385:83,386:67,387:75,388:75,389:67,390:75,391:83,392:58,393:83,394:100,395:67,396:75,397:67,398:67,399:75,400:58,401:58,402:75,403:83,404:75,405:100,406:50,407:50,408:75,409:67,410:50,411:67,412:117,413:83,414:75,415:92,416:92,417:75,418:117,419:100,420:75,421:75,422:75,423:67,424:58,425:67,426:58,427:42,428:75,429:42,430:75,431:83,432:75,433:92,434:83,435:75,436:75,437:67,438:67,439:67,440:67,441:58,442:58,443:75,444:75,445:58,446:50,447:67,448:33,449:50,450:50,451:33,452:142,453:142,454:133,455:100,456:92,457:67,458:117,459:117,460:100,461:75,462:67,463:33,464:33,465:92,466:67,467:83,468:75,469:83,470:75,471:83,472:75,473:83,474:75,475:83,476:75,477:67,478:75,479:67,480:75,481:67,482:100,483:100,484:92,485:75,486:83,487:75,488:75,489:67,490:92,491:67,492:92,493:67,494:67,495:58,496:33,497:142,498:142,499:133,500:83,501:75,502:117,503:67,504:83,505:75,506:75,507:67,508:100,509:100,510:92,511:67,512:75,513:67,514:75,515:67,516:67,517:67,518:67,519:67,520:33,521:33,522:33,523:33,524:92,525:67,526:92,527:67,528:75,529:50,530:75,531:50,532:83,533:75,534:83,535:75,536:67,537:58,538:75,539:42,540:58,541:58,542:83,543:75,544:83,545:100,546:92,547:67,548:67,549:67,550:75,551:67,552:67,553:67,554:92,555:67,556:92,557:67,558:92,559:67,560:92,561:67,562:75,563:58,564:67,565:100,566:67,567:33,568:100,569:100,570:75,571:75,572:58,573:58,574:67,575:58,576:58,577:67,578:50,579:75,580:75,581:75,582:75,583:58,584:58,585:25,586:83,587:58,588:75,589:33,590:75,591:58,880:67,881:50,882:67,883:50,884:33,885:33,886:75,887:67,888:108,889:108,890:67,891:58,892:58,893:58,894:42,895:108,896:108,897:108,898:108,899:108,900:67,901:67,902:75,903:42,904:83,905:100,906:58,907:108,908:100,909:108,910:100,911:100,912:42,913:75,914:67,915:58,916:83,917:67,918:67,919:83,920:92,921:33,922:75,923:75,924:100,925:83,926:75,927:92,928:83,929:67,930:108,931:67,932:75,933:75,934:83,935:75,936:83,937:92,938:33,939:75,940:83,941:58,942:75,943:42,944:67,945:83,946:67,947:67,948:67,949:58,950:75,951:75,952:67,953:42,954:67,955:67,956:75,957:67,958:67,959:67,960:92,961:67,962:67,963:75,964:67,965:67,966:92,967:67,968:92,969:100,970:42,971:67,972:67,973:67,974:100,975:108,976:58,977:75,978:75,979:100,980:75,981:92,982:100,983:67,984:92,985:67,986:75,987:58,988:58,989:58,990:67,991:58,992:75,993:92,994:100,995:92,996:75,997:58,998:75,999:58,1e3:75,1001:75,1002:67,1003:67,1004:83,1005:58,1006:50,1007:42,1008:67,1009:67,1010:58,1011:33,1012:92,1013:58,1014:58,1015:67,1016:67,1017:75,1018:100,1019:83,1020:58,1021:75,1022:75,1023:75,1024:67,1025:67,1026:92,1027:58,1028:75,1029:67,1030:33,1031:33,1032:42,1033:108,1034:108,1035:83,1036:75,1037:83,1038:75,1039:83,1040:75,1041:67,1042:67,1043:58,1044:83,1045:67,1046:92,1047:67,1048:83,1049:83,1050:75,1051:83,1052:100,1053:83,1054:92,1055:83,1056:67,1057:75,1058:75,1059:75,1060:83,1061:75,1062:83,1063:75,1064:108,1065:108,1066:75,1067:92,1068:67,1069:75,1070:108,1071:75,1072:67,1073:67,1074:58,1075:58,1076:75,1077:67,1078:83,1079:58,1080:75,1081:75,1082:67,1083:67,1084:83,1085:75,1086:67,1087:75,1088:75,1089:58,1090:58,1091:58,1092:92,1093:67,1094:75,1095:58,1096:92,1097:100,1098:67,1099:83,1100:58,1101:58,1102:92,1103:58,1104:67,1105:67,1106:75,1107:58,1108:58,1109:58,1110:33,1111:33,1112:42,1113:92,1114:92,1115:75,1116:67,1117:75,1118:58,1119:75,1120:100,1121:75,1122:75,1123:67,1124:83,1125:83,1126:75,1127:67,1128:100,1129:92,1130:92,1131:83,1132:117,1133:108,1134:67,1135:67,1136:83,1137:83,1138:92,1139:67,1140:83,1141:67,1142:83,1143:67,1144:133,1145:125,1146:92,1147:67,1148:100,1149:75,1150:100,1151:75,1152:75,1153:58,1154:75,1155:0,1156:0,1157:0,1158:0,1159:108,1160:0,1161:0,1162:83,1163:75,1164:67,1165:58,1166:67,1167:75,1168:58,1169:58,1170:67,1171:58,1172:75,1173:67,1174:100,1175:92,1176:67,1177:58,1178:75,1179:67,1180:83,1181:75,1182:75,1183:67,1184:83,1185:75,1186:83,1187:75,1188:100,1189:83,1190:117,1191:100,1192:92,1193:75,1194:75,1195:58,1196:75,1197:58,1198:75,1199:58,1200:75,1201:58,1202:75,1203:75,1204:100,1205:83,1206:75,1207:67,1208:75,1209:67,1210:75,1211:58,1212:92,1213:75,1214:92,1215:75,1216:33,1217:92,1218:83,1219:75,1220:67,1221:83,1222:67,1223:83,1224:75,1225:83,1226:75,1227:75,1228:58,1229:100,1230:83,1231:25,1232:75,1233:67,1234:75,1235:67,1236:100,1237:100,1238:67,1239:67,1240:75,1241:67,1242:75,1243:67,1244:92,1245:83,1246:67,1247:58,1248:67,1249:58,1250:83,1251:75,1252:83,1253:75,1254:92,1255:67,1256:92,1257:67,1258:92,1259:67,1260:75,1261:58,1262:75,1263:58,1264:75,1265:58,1266:75,1267:58,1268:75,1269:58,1270:58,1271:42,1272:92,1273:83,1274:58,1275:42,1276:75,1277:58,1278:75,1279:58,2026:67,19977:108,65403:58},t._ELLIPSIS_LENGTH=new t("…").length,t}()}),define("modules/clean/event_load",["jquery"],function(){var t,e,n;return t=function(t){return window.setTimeout(function(){return t.apply(t)},0)},n=function(e){return"complete"===document.readyState?t(e):null!=window.attachEvent?window.attachEvent("onload",e):null!=window.addEventListener?window.addEventListener("load",e,!1):void 0},e={window_load:n}}),define("modules/clean/filepath",["modules/core/i18n"],function(t){var e,n,o,r,i,s,a,_,u,c,l;return l=t._,u=function(t){return t?("/"!==t.charAt(0)&&(t="/"+t),"/"===t.charAt(t.length-1)?t.substr(0,t.length-1):t):""},a=function(t,e){return t=u(t),t=t.split("/"),a=t.pop(),""===a?e||l("Dropbox"):a},_=function(t){return-1===t.indexOf(".")?t:t.split(".").slice(0,-1).join(".")},r=function(t){return t.split(".").pop()},i=function(t){return-1===t.indexOf(".")?"":r(t).toLowerCase()},e={_other:"page_white",log:"page_white",msg:"page_white",sln:"page_white",vcproj:"page_white",txt:"page_white_text",wps:"page_white_text",doc:"page_white_word",docx:"page_white_word",docm:"page_white_word",rtf:"page_white_word",pages:"page_white_word",wpd:"page_white_word",odt:"page_white_word",pdf:"page_white_acrobat",xls:"page_white_excel",xlsm:"page_white_excel",xlsx:"page_white_excel",xlsb:"page_white_excel",ods:"page_white_excel",ppt:"page_white_powerpoint",pptx:"page_white_powerpoint",pptm:"page_white_powerpoint",pps:"page_white_powerpoint",ppsx:"page_white_powerpoint",ppsm:"page_white_powerpoint",odp:"page_white_powerpoint",css:"page_white_code",html:"page_white_code",htm:"page_white_code",xml:"page_white_code",php:"page_white_code",c:"page_white_code",h:"page_white_code",rb:"page_white_code",cpp:"page_white_code",java:"page_white_code",js:"page_white_code",json:"page_white_code",cs:"page_white_code",py:"page_white_code",exe:"page_white_gear",dll:"page_white_gear",app:"page_white_gear",mp3:"page_white_sound",m3u:"page_white_sound",wav:"page_white_sound",m4a:"page_white_sound",wma:"page_white_sound",aif:"page_white_sound",iff:"page_white_sound",mid:"page_white_sound",mpa:"page_white_sound",ra:"page_white_sound",aiff:"page_white_sound",amr:"page_white_sound",ogg:"page_white_sound",gif:"page_white_picture",png:"page_white_picture",jpg:"page_white_picture",jpeg:"page_white_picture",tiff:"page_white_picture",tif:"page_white_picture",bmp:"page_white_picture",odg:"page_white_picture",ari:"page_white_picture",arw:"page_white_picture",srf:"page_white_picture",sr2:"page_white_picture",bay:"page_white_picture",crw:"page_white_picture",cr2:"page_white_picture",cap:"page_white_picture",eip:"page_white_picture",dcs:"page_white_picture",dcr:"page_white_picture",drf:"page_white_picture",k25:"page_white_picture",kdc:"page_white_picture",dng:"page_white_picture",erf:"page_white_picture",fff:"page_white_picture",iiq:"page_white_picture",mef:"page_white_picture",mos:"page_white_picture",mrw:"page_white_picture",nef:"page_white_picture",nrw:"page_white_picture",orf:"page_white_picture",pef:"page_white_picture",ptx:"page_white_picture",pxn:"page_white_picture",r3d:"page_white_picture",raf:"page_white_picture",rw2:"page_white_picture",raw:"page_white_picture",rwl:"page_white_picture",rwz:"page_white_picture",obm:"page_white_picture",srw:"page_white_picture",x3f:"page_white_picture",avi:"page_white_film",mov:"page_white_film",mp4:"page_white_film",mkv:"page_white_film",wmv:"page_white_film",mpg:"page_white_film",m4v:"page_white_film",vob:"page_white_film",ogv:"page_white_film",gz:"page_white_compressed",tar:"page_white_compressed",rar:"page_white_compressed",zip:"page_white_compressed",tgz:"page_white_compressed",bz2:"page_white_compressed",iso:"page_white_dvd",dmg:"page_white_dvd",ai:"ai",psd:"page_white_paint",au:"page_white_sound",fla:"fla",swf:"fla"},o=function(t){return e[t]||"page_white"},s=function(t){var e;return e=r(t).toLowerCase(),o(e)},c=function(t){var e;return e=t.split("/").slice(0,-1).join("/"),e||"/"},n={filename:a,file_extension:r,filename_without_extension:_,file_extension_for_logging:i,file_icon:s,extension_icon:o,normalize:u,parent_dir:c}}),define("modules/clean/form",["jquery","modules/core/exception","modules/core/notify","modules/clean/ajax"],function(t,e,n,o){var r,i;return i=e.assert,r={submit:function(t,e,i,s){return o.FormWebRequest({url:t.attr("action"),data:this.collect_data(t),success:function(t,n,o){var s,a,_;return _=r.parse_response(o.responseText),a=_[0],s=_[1],a?e(s):i(s)},error:function(){return i(n.DEFAULT_ERROR)},complete:s})},collect_data:function(e){var n,o,r,i,s,a,_;for(n={},_=e.find("input, select, textarea"),s=0,a=_.length;a>s;s++)if(o=_[s],r=t(o).attr("name")){if("checkbox"===t(o).attr("type"))i=t(o).prop("checked")?"True":"";else if("radio"===t(o).attr("type")){if(!t(o).prop("checked"))continue;i=t(o).val()}else i=t(o).val();r in n?("string"==typeof n[r]&&(n[r]=[n[r]]),n[r].push(i)):n[r]=i}return n},parse_response:function(t){var e,o,r;if(0!==t.indexOf("err:"))return[!0,t];e=t.substr(4);try{return o=JSON.parse(e),[!1,o]}catch(i){return r=i,[!1,e||n.DEFAULT_ERROR]}}}}),define("modules/clean/hi_res",["jquery"],function(t){var e;return e=function(){function e(t){var e;this.constructor._show_hi_res()&&(e=t.attr("data-hi-res-no-resize"),this.constructor.set_src(t,t.attr("data-hi-res"),e),this.constructor.set_bg(t,t.attr("data-hi-res-background"),e))}return e.set_src=function(t,e,n){return this._show_hi_res()&&e&&e!==t.attr("src")?this._replace(t,e,!n,this._replace_img):void 0},e.set_bg=function(t,e,n){return this._show_hi_res()?this._replace(t,e,!n,this._replace_background):void 0},e._show_hi_res=function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1},e._replace=function(e,n,o,r){var i;if(n)return i=new Image,i.src=n,t(i).on("load",function(){return r(e,n,o,i.width,i.height)})},e._replace_img=function(t,e,n,o,r){return t.attr("src",e),n?(t.width(o/2),t.height(r/2)):void 0},e._replace_background=function(t,e,n,o,r){var i;return i="url('%(src)s')".format({src:e}),t.css("backgroundImage",i),n?t.css("backgroundSize",""+o/2+"px "+r/2+"px"):void 0},e}()}),define("modules/clean/history",["external/modernizr","modules/core/browser","modules/core/exception","modules/core/uri"],function(t,e,n,o){var r,i;return i=n.assert,r=function(){var t,n,r,s,a,_,u,c,l,d,h,p,f;return t=new RegExp("#|;|\\?|:|@|&|=|\\+|\\$"),h=function(){var n,r,i;return i=void 0,Modernizr.history||-1===e.get_href().indexOf("#!")?(n=window.location.pathname,r=window.location.search,-1!==n.search(t)&&(n=String(o({path:n}))),i=n+r):i=e.get_href().split("#!").pop(),i},a=function(t,e){return String(o.parse(t).setQuery(e))},_=function(t){var e;return null==t&&(t=h()),e=t.split("?"),{url:t,path:e[0],qargs:o.parse(t).getQuery()}},n={},u={},p=h(),f=null,d=function(t){return"/"+t.split("/")[1]},c=function(){var t,e,o;return o=p,e=_(o),t=d(e.path),t in n?(n[t](e.path.substr(t.length+1),e.qargs),!0):!1},l=function(){var t,e,n;return n=p,e=_(n),t=d(e.path),t in u?u[t](e.path.substr(t.length+1),e.qargs):void 0},r=function(t,e){var n,o;return o=d(t),n=d(e),o!==n?l():void 0},s=function(){var t;return t=h(),t!==p?(r(p,t),p=t,c()):void 0},{init:function(){return f?void 0:(p=h(),f=setInterval(s,50))},add_callback:function(t,e,o){return this.init(),i("string"==typeof t,"DBHistory prefix is not a string"),i(0===t.indexOf("/"),"DBHistory prefix must be absolute"),i(1===t.count("/"),"multi-component prefixes arent supported"),n[t]=e,o?void 0:c()},add_exit_callback:function(t,e){return this.init(),i("string"==typeof t,"DBHistory prefix is not a string"),i(0===t.indexOf("/"),"DBHistory prefix must be absolute"),i(1===t.count("/"),"multi-component prefixes arent supported"),u[t]=e},fire_callbacks:function(){return c()},_build_url_for_state_change:function(t,e){var n;return i("string"==typeof t,"DBHistory path is not a string"),i(0===t.indexOf("/"),"DBHistory path must be absolute"),i(-1===t.indexOf("//"),"DBHistory path contains //"),n=a(t,e)},_pre_state_change:function(t){return t===p?!1:(r(p,t),!0)},_post_state_change:function(){return p=h(),c()},replace_state:function(t,e){var n;return n=this._build_url_for_state_change(t,e),this._pre_state_change(n)?(i(Modernizr.history,"replace_state is only available on modern browsers"),window.history.replaceState(null,null,n),this._post_state_change()):void 0},push_state:function(t,e){var n;return i(-1===t.indexOf("?"),"DBHistory path contains ?"),i(-1===t.indexOf("#"),"DBHistory path contains #"),n=this._build_url_for_state_change(t,e),this._pre_state_change(n)?(Modernizr.history?window.history.pushState(null,null,n):window.location.href="#!"+n,this._post_state_change()):void 0},remove_query_param:function(t){var e;if(Modernizr.history)return e=this.deconstruct_url(),delete e.qargs[t],this.replace_state(e.path,e.qargs)},get_url:h,construct_url:a,deconstruct_url:_,URL_ESCAPE_REGEX:t}}()}),define("modules/clean/image_size",[],function(){var t;return t=function(t,e){var n,o,r,i,s,a,_;for(r=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]],a=0,_=r.length;_>a;a++)if(i=r[a],o=i[0],s=i[1],n=i[2],s>=t||n>=e)return o;return r[r.length-1][0]},{image_best_fit_size:t}}),define("modules/clean/job_progress",["jquery"],function(t){var e,n,o;return o={make:function(e,n){var o,r,i,s,a,_,u;return null==n&&(n=300),u=n.toString()+"px",i=t("<div />",{"class":"outer-progress-bar"}).css({width:u}),o=t("<div />",{"class":"inner-progress-bar",id:"pb_"+e}).css({width:u}),a=t("<div />",{"class":"under-pb progress-bar"}).css({width:u}),s=t("<div />",{"class":"over-pb progress-bar",id:"pb_"+e+"_over"}).css({display:"none"}),_=t("<div />",{"class":"pb-percentage",id:"pb_"+e+"_upct"}).css({width:u}),r=t("<div />",{"class":"pb-percentage",id:"pb_"+e+"_opct"}).css({width:u}),a.append(_),s.append(r),o.append(a),o.append(s),i.append(o),s.data("progress-width",n),i},set:function(e,n){var o,r,i;return(o=t("#pb_"+e+"_over"))?(n=Math.min(n,1),r=o.data("progress-width"),i=String(r*n)+"px",o.show(),o.css({backgroundColor:"#348DD3",overflow:"hidden",width:i})):void 0}},e={complete:{},handled:function(t){var n;return t?(n=!!e.complete[t],e.complete[t]=!0,n):!1},peek:function(t){return t?!!e.complete[t]:!1}},n={show:function(e){var n,r,i,s,a,_,u,c;if(e&&(null!=(u=__CONDITIONAL_JS__.DBModalStack)&&null!=(c=u.top())&&c.hide(),n=t("body"),r=t("<div />",{id:"modal-progress-overlay"}),r.hide(),r.appendTo(n),t("#browse-box").length?r.clonePosition(t("#browse-box")):t("#gallery-view-media").length?r.clonePosition(t("#gallery-view-media")):r.css({position:"fixed",width:"100%",height:"100%"}),r.width()))return a=t("<div />",{id:"modal-progress-content"}),s=t("<div />",{id:"modal-progress-container"}),i=t("<div />",{id:"modal-progress-bar",opacity:1,html:o.make("modal-progress",150,"")}),_=t("<div />",{id:"modal-progress-text",text:e}),a.hide(),s.append(i,_),a.append(s),n.append(a),r.fadeTo(250,.7),a.fadeIn(250)},update:function(t){var e;if(!(t.indexOf("/")>0&&(e=t.split("/"),t=Number(e[0])/Number(e[1]),isNaN(t))))return o.set("modal-progress",t)},hide:function(){return t("#modal-progress-overlay").fadeOut(250,function(){return t("#modal-progress-overlay").remove()}),t("#modal-progress-content").fadeOut(250,function(){return t("#modal-progress-content").remove()})}},{ModalProgress:n,Job:e}}),define("modules/clean/keycode",[],function(){var t;return t=function(){function t(){}return t.BACKSPACE=8,t.TAB=9,t.ENTER=13,t.SHIFT=16,t.CONTROL=17,t.ALT=18,t.ESC=27,t.SPACE=32,t.PAGE_UP=33,t.PAGE_DOWN=34,t.END=35,t.HOME=36,t.LEFT=37,t.UP=38,t.RIGHT=39,t.DOWN=40,t.INSERT=45,t.DELETE=46,t.TWO_KEY=50,t.COMMAND=91,t.FORWORD_SLASH=191,t.AT_SIGN=64,t.PROCESSING=229,t}()}),define("modules/clean/mailcheck",["jquery","modules/core/html","modules/core/i18n"],function(t,e,n){var o,r;return r=n._,o=function(){function t(t,e){this.$input=t,this.$suggestion_container=e,this.watch()}return t.DOMAINS=["gmail.com","hotmail.com","yahoo.com","aol.com","web.de","gmx.de","googlemail.com","me.com","live.com","msn.com","mail.ru","comcast.net","google.com","mac.com"],t.WHITELIST_REGEXS=[/ymail.com/,/yahoo\.co\./,/yahoo\.com\./,/hotmail\.co\./,/hotmail\.com\./,/gmx\.net/,/gmx\.at/,/gmx\.ch/,/gmx\.com/,/mail\.com/,/web\.com/],t.THRESHOLD=2,t.prototype.watch=function(){return this.$input.on("blur",function(t){return function(){var e;return e=t.suggest(t.$input.val()),e?t.populate(e):t.clear()}}(this))},t.prototype.populate=function(t){var n,o,i;return n=e.escape(t.address).toHTML(),o=e.escape(t.domain).toHTML(),i=""+n+"@<span class='email_warning_area'>"+o+"</span>",this.$suggestion_container.html(new e(r("Did you mean <a>%(suggested_email)s</a>?").format({suggested_email:i})).toHTML()),this.$suggestion_container.show(),this.$suggestion_container.on("click",function(e){return function(){return e.$input.val(t.full),e.clear()}}(this))},t.prototype.clear=function(){return this.$suggestion_container.empty(),this.$suggestion_container.hide()},t.prototype.suggest=function(t){var e,n,o,r;return t=t.toLowerCase(),(r=this.splitEmail(t))?(o=r.domain,e=r.address,this.whitelistedDomain(o)?!1:(n=this.findClosestDomain(o),n?{address:e,domain:n,full:""+e+"@"+n}:!1)):!1},t.prototype.whitelistedDomain=function(e){var n,o,r,i;for(i=t.WHITELIST_REGEXS,o=0,r=i.length;r>o;o++)if(n=i[o],n.match(e))return!0;return!1},t.prototype.splitEmail=function(t){var e;return e=t.split("@"),e.length<2?void 0:{domain:e.pop(),address:e.join("@")}},t.prototype.findClosestDomain=function(e){var n,o,r,i,s,a,_;for(i=99,o=null,_=t.DOMAINS,s=0,a=_.length;a>s;s++)n=_[s],r=this.stringDistance(e,n),i>r&&(i=r,o=n);return o&&o!==e&&i<=t.THRESHOLD?o:!1},t.prototype.stringDistance=function(t,e){var n,o,r,i,s,a;if(null==t||0===t.length)return null==e||0===e.length?0:e.length;if(null==e||0===e.length)return t.length;for(n=0,s=0,a=0,r=0,i=5;n+s<t.length&&n+a<e.length;){if(t.charAt(n+s)===e.charAt(n+a))r++;else for(s=0,a=0,o=0;i>o;){if(n+o<t.length&&t.charAt(n+o)===e.charAt(n)){s=o;break}if(n+o<e.length&&t.charAt(n)===e.charAt(n+o)){a=o;break}o++}n++}return(t.length+e.length)/2-r},t}()}),define("modules/clean/multiaccount_login",["jquery","modules/core/browser","modules/core/dom","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/viewer","modules/clean/components/login_form","modules/clean/dbmodal"],function(t,e,n,o,r,i,s,a,_){var u,c,l,d;return l=o.assert,d=r._,u=_.DBModal,c=function(){function o(){}return o.$element=function(){return t("#db-modal-multiaccount-login-modal")},o.set_during_login_callback=function(t){return l(!this._during_login_callback,"already have a during_login_callback"),this._during_login_callback=t},o.show_modal=function(o){var r,_,c,h,p;return null==o&&(o={}),this.$element=t.isFunction(this.$element)?this.$element():this.$element,l(null!=(p=this.$element)?p.length:void 0,"MultiaccountLogin needs its @$element to be set"),l(!(null!=o.on_success&&null!=o.success_href),"on_success and success_href are mutually exclusive"),null!=o.user?h=s.get_viewer().get_user_by_id(String(o.user),!0):null!=o.user_id?h=s.get_viewer().get_user_by_id(o.user_id,!0):null!=o.role&&(h=s.get_viewer().get_user_by_role(o.role,!0)),l(null!=h,"invalid user"),_=h.role,l(!s.get_viewer().is_user_signed_in(h),"called MultiaccountLogin for a user that's already signed in"),c="personal"===_?d("Sign in to your personal Dropbox"):d("Sign in to your %(team_name)s Dropbox").format({team_name:s.get_viewer().team_name}),r=this.$element.find("form"),n.controller(r).reset(),n.controller(r).set_input_value("login_email",h.email),this.auth_success_callback=function(t){return function(){var n;return s.get_viewer()._sign_in_all_users(),t.set_logged_out_role(null),n=function(n){return null!=n?(i.error(n),s.get_viewer()._sign_out_user_by_id(h.id),t.set_logged_out_role(h.role),void t.modal.hide()):null!=o.success_href?e.get_uri().toString()!==o.success_href?e.redirect(o.success_href):e.reload():(t.modal.hide(),"function"==typeof o.on_success?o.on_success():void 0)},null!=t._during_login_callback&&null==o.success_href?t._during_login_callback(h,n):n(),!1}}(this),t(document).off(a.MULTI_LOGIN_SUCCESS),t(document).on(a.MULTI_LOGIN_SUCCESS,this.auth_success_callback),this.modal=new u({element_id:"multiaccount-login-modal"}),this.modal.show(),this.modal.set_title(c),this.$element.find('input[name="login_password"]').focus()},o.set_logged_out_role=function(t){return this.logged_out_role=t},o.set_team_name=function(t){return this.team_name=t},o.show_page_login_modal=function(t){var e;if(this.logged_out_role)return e={role:this.logged_out_role},"string"==typeof t?e.success_href=t:"function"==typeof t&&(e.on_success=t),this.show_modal(e),!1},o}(),INLINE_JS.MultiaccountLogin=c,c}),define("modules/clean/payments/cash",[],function(){var t,e,n,o;return o=function(){function t(){}return t._groupSymbol=",",t._decimalSymbol=".",t._minusSignSymbol="-",t._currencyFormatMap={USD:"$%v"},t.set_locale_number_format=function(e,n,o){t._groupSymbol=null!=e?e:",",t._decimalSymbol=null!=n?n:".",t._minusSignSymbol=null!=o?o:"-"},t.set_currency_format_map=function(e){t._currencyFormatMap=e},t._formatAmountThousandsHelper=function(e){var n;return n=Math.abs(parseInt(e)).toFixed(0)+"",n.length<=3?n:t._formatAmountThousandsHelper(n.substr(0,n.length-3))+t._groupSymbol+n.substr(n.length-3)},t.roundCurrency=function(t,e,n){return null==e&&(e="USD"),null==n&&(n=2),t%1===0&&(n=0),this.formatCurrency(t,e,n)},t.formatCurrency=function(e,n,o,r){var i,s,a,_;return null==n&&(n="USD"),null==o&&(o=2),null==r&&(r=!1),"JPY"===n&&(o=0),s=t.formatNumber(e,o),a=(null!=(_=t._currencyFormatMap[n])?_.replace("%v",s):void 0)||s+" "+n,r?(i=a.indexOf(t._decimalSymbol),-1===i?[a,""]:[a.slice(0,i+1),a.slice(i+1)]):a},t.formatNumber=function(e,n){return null==n&&(n=2),(0>e?t._minusSignSymbol:"")+t._formatAmountThousandsHelper(e)+(n>0?t._decimalSymbol+e.toFixed(n).split(".")[1]:"")},t}(),e=function(){function t(t,e){this.cash1=t,this.cash2=e}return t}(),n=function(){function t(){}return t}(),t=function(){function t(t,e){if(this.currency=e,!t&&0!==t||!this.currency)throw new n;this.amount=parseFloat(t)}return t.prototype.add=function(n){if(this.currency!==n.currency)throw new e(self,n);return new t(this.amount+n.amount,this.currency)},t.prototype.subtract=function(e){return this.add(new t(-e.amount,e.currency))},t.prototype.multiply=function(e){return new t(this.amount*e,this.currency)},t.prototype.divide=function(e){return new t(this.amount/e,this.currency)},t.prototype.round=function(e){var n;return null==e&&(e=2),n=Math.pow(10,e),new t(Math.round(this.amount*n)/n,this.currency)},t.prototype.toString=function(t){return null==t&&(t=2),"JPY"===this.currency&&(t=0),o.roundCurrency(this.amount,this.currency,t)},t.fromObject=function(e){return new t(e.amount,e.currency)},t}(),{CashUtil:o,CashCurrenciesDoNotMatch:e,CashNeedsAmountAndCurrency:n,Cash:t}});var __indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};define("modules/clean/payments/credit_card_util",[],function(){var t;return t={_credit_card_info_map:null,setCreditCardInfoMap:function(t){this._credit_card_info_map=t},getAllTypes:function(){var t,e;return function(){var n,o;n=this._credit_card_info_map,o=[];for(e in n)t=n[e],o.push(e);return o}.call(this)},getValidCardTypesForCountryCode:function(t){var e,n,o,r;o=[],r=this._credit_card_info_map;for(n in r)e=r[n],(__indexOf.call(e.accepted_countries,"all")>=0||__indexOf.call(e.accepted_countries,t)>=0)&&o.push(n);return o},isValidCardTypeForCountryCode:function(t,e){return __indexOf.call(this.getValidCardTypesForCountryCode(e),t)>=0},getNameForType:function(t){return this._credit_card_info_map[t].name}}});var __indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},__bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/payments/dfb_util",["jquery","external/underscore","modules/clean/payments/cash","modules/clean/payments/validation","modules/core/exception"],function(t,e,n,o,r){var i,s,a,_,u;return i=n.Cash,u=r.assert,_=function(){function t(t,e,n,o,r,i){this.plan_ids=t,this.schedule_ids=e,this.license_ids_and_counts=n,this.currencies=o,this.country_code=r,this.vat_id=i}return t.prototype.set_only_license_count=function(t){var e;return e=Object.keys(this.license_ids_and_counts)[0],this.license_ids_and_counts[e]=t},t.prototype.get_only_license_count=function(){var t;return t=Object.keys(this.license_ids_and_counts)[0],this.license_ids_and_counts[t]},t.prototype.set_country_code=function(t){this.country_code=t},t.prototype.set_vat_id=function(t){return this.vat_id=""!==t&&o.validate_vat(this.country_code,t)?t:""},t.prototype.cache_key=function(){return[this.plan_ids.join(","),this.schedule_ids.join(","),this.get_only_license_count(),this.currencies.join(","),this.country_code,this.vat_id].join(":")},t.prototype.to_json=function(){return{plan_ids:JSON.stringify(this.plan_ids),schedule_ids:JSON.stringify(this.schedule_ids),license_ids_and_counts:JSON.stringify(this.license_ids_and_counts),currencies:JSON.stringify(this.currencies),country_code:this.country_code,vat_id:this.vat_id}},t.from_transition_view_models=function(n){var o,r,i,s,a,_,c,l,d,h,p,f,m,g,v,b,y,w,E,x,S;for(a=[],_=[],i=[],s=!1,r=!1,l=!1,d=0,f=n.length;f>d;d++)if(c=n[d],a.push(c.state.plan.id),_.push(c.state.schedule.id),i.push(c.state.currency),s===!1){for(s={},v=c.state.allocated_licenses,h=0,m=v.length;m>h;h++)o=v[h],s[o.license_id]=o.license_count;r=null!=(b=c.read_only_invoice)?b.tax_country_code:void 0,l=null!=(y=c.read_only_invoice)?y.tax_exclusion_id:void 0}else{for(u(c.state.allocated_licenses.length===Object.keys(s).length,"License sets differ"),w=c.state.allocated_licenses,p=0,g=w.length;g>p;p++)o=w[p],u((E=o.license_id,__indexOf.call(s,E)>=0),"License sets differ"),u(s[o.license_id]===o.license_count,"License count must match");u(r===(null!=(x=c.read_only_invoice)?x.tax_country_code:void 0),"country codes must match"),u(l===(null!=(S=c.read_only_invoice)?S.tax_exclusion_id:void 0),"VAT IDs must match")}return new t(e.uniq(a),e.uniq(_),s,e.uniq(i),r,l);

},t}(),s=function(){function t(t){this.transition_view_model=t,this.current_total=this.transition_view_model.read_only_invoice?i.fromObject(this.transition_view_model.read_only_invoice.total):new i(0,this.transition_view_model.state.currency),this.per_license_price=this.transition_view_model.state.per_license_prices.length?i.fromObject(this.transition_view_model.state.per_license_prices[0].price):new i(0,this.transition_view_model.state.currency),this.recurring_total=i.fromObject(this.transition_view_model.state.total_recurring_price)}return t}(),a=function(){function e(t){this.default_transition_view_models=t,this._get_transition_info_for=__bind(this._get_transition_info_for,this),this._add_to_cache=__bind(this._add_to_cache,this),this.has_inflight_request=__bind(this.has_inflight_request,this),this.transition_view_model_requests={},this.transition_info_cache={},this._add_to_cache(this.default_transition_view_models)}return e.prototype.get=function(e,n){var o,r,i;return i=_.from_transition_view_models(this.default_transition_view_models),n.total_users&&i.set_only_license_count(n.total_users),n.country_code&&i.set_country_code(n.country_code),n.vat_id&&i.set_vat_id(n.vat_id),o=i.cache_key(),(r=this._get_transition_info_for(o))?void e(r):this.transition_view_model_requests[o]?void 0:(this.transition_view_model_requests[o]=!0,t.ajax({url:"/business/transition-model",type:"GET",dataType:"json",data:i.to_json(),success:function(t){return function(n){var r;return delete t.transition_view_model_requests[o],r=t._add_to_cache(n),e(r)}}(this),error:function(t){return function(){return delete t.transition_view_model_requests[o]}}(this)}))},e.prototype.has_inflight_request=function(){return Object.keys(this.transition_view_model_requests).length},e.prototype._add_to_cache=function(t){var e,n,o;return e=_.from_transition_view_models(t).cache_key(),n=function(){var e,n,r;for(r=[],e=0,n=t.length;n>e;e++)o=t[e],r.push(new s(o));return r}(),this.transition_info_cache[e]=n,n},e.prototype._get_transition_info_for=function(t){return t in this.transition_info_cache?this.transition_info_cache[t]:null},e}(),{DfBTransitionInfo:s,DfBTransitionInfoFetcher:a}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("modules/clean/payments/pro_trial_onboarding_tour",["jquery","modules/clean/ajax","modules/clean/dbmodal","modules/clean/dbmodal_loading"],function(t,e,n){var o,r,i,s;return o=n.DBModal,r=n.DBModalStack,i=function(n){function o(t){this.options=t,this._log=__bind(this._log,this),this._redraw=__bind(this._redraw,this),this._log_and_show_current_step=__bind(this._log_and_show_current_step,this),this._finish_tour=__bind(this._finish_tour,this),this._advance_tour=__bind(this._advance_tour,this),this._go_back_tour=__bind(this._go_back_tour,this),this._hide=__bind(this._hide,this),this._show=__bind(this._show,this),o.__super__.constructor.call(this,this.options),this.vertical_offset=200}return __extends(o,n),o.show=function(t){var e;return e=new this({element_id:"pro-trial-onboarding-tour",click_out_to_close:!1,vars:{trigger:t}}),e.show()},o.prototype._show=function(){return o.__super__._show.apply(this,arguments),this._listen(),this._current_step=0,this._log_and_show_current_step(this.vars.trigger)},o.prototype._hide=function(){return o.__super__._hide.apply(this,arguments),this._unlisten(),t("#pro-trial-tour-header-bubble").removeClass("force-hidden")},o.prototype._listen=function(){return t(document).on("click",".prev-step",this._go_back_tour),t(document).on("click","button.next-step",this._advance_tour),t(document).on("click","button.finish-tour",this._finish_tour)},o.prototype._unlisten=function(){return t(document).off("click",".prev-step",this._go_back_tour),t(document).off("click","button.next-step",this._advance_tour),t(document).on("click","button.finish-tour",this._finish_tour)},o.prototype._go_back_tour=function(t){return t.preventDefault(),this._current_step-=1,this._log_and_show_current_step()},o.prototype._advance_tour=function(t){return t.preventDefault(),this._current_step+=1,this._log_and_show_current_step()},o.prototype._finish_tour=function(){return this._log("finish_trial_onboarding"),this.hide()},o.prototype._log_and_show_current_step=function(t){var e;return e=t?{trigger:t}:{},this._log("view_trial_onboarding_"+this._current_step,e),this._redraw()},o.prototype._redraw=function(){var t,e;return this.$modal_window.find(".welcome, .tour-feature").hide(),e=this.$modal_window.find(".db-modal-x"),0===this._current_step?(this.$modal_window.find(".welcome").show(),e.hide()):(t=this._current_step,this.$modal_window.find('.tour-feature[data-step-num="'+t+'"]').show(),e.show())},o.prototype._log=function(t,n){return e.WebRequest({url:"/pro/trial_onboarding_tour_log",data:{evt:t,extra_data:JSON.stringify(n)}})},o}(o),s=function(){function t(t){this.$container=t,this._listen()}return t.prototype._listen=function(){return this.$container.find(".start-tour").on("click",function(){return function(t){return t.preventDefault(),i.show("restart_tour")}}(this))},t}(),{ProTrialOnboardingTour:i,ProTrialOnboardingTourHeaderLink:s}}),define("modules/clean/payments/validation",[],function(){var t,e;return t={AT:/^ATU[0-9]{8}$/,BE:/^BE(0?|1)[0-9]{9}$/,BG:/^BG[0-9]{9,10}$/,CH:/^CHE[0-9]{9}(TVA|MWST|IVA)$/,CY:/^CY[0-9]{8}[A-Z]$/,CZ:/^CZ[0-9]{8,10}$/,DE:/^DE[0-9]{9}$/,DK:/^DK[0-9]{8}$/,EE:/^EE[0-9]{9}$/,GR:/^EL[0-9]{9}$/,ES:/^ES([A-Z][0-9]{7}[0-9A-Z]|[0-9A-Z][0-9]{7}[A-Z])$/,FI:/^FI[0-9]{8}$/,FR:/^FR[0-9A-Z]{2}[0-9]{9}$/,GB:/^GB([0-9]{9}|[0-9]{12}|GD[0-9]{3}|HA[0-9]{3})$/,HR:/^HR[0-9]{11}$/,HU:/^HU[0-9]{8}$/,IE:/^IE([0-9][0-9A-Z+*][0-9]{5}[A-Z]|[0-9]{7}WI)$/,IT:/^IT[0-9]{11}$/,LT:/^LT([0-9]{9}|[0-9]{12})$/,LU:/^LU[0-9]{8}$/,LV:/^LV[0-9]{11}$/,MT:/^MT[0-9]{8}$/,NL:/^NL[0-9]{9}B[0-9]{2}$/,NO:/^NO[0-9]{9}(MVA)?$/,PL:/^PL[0-9]{10}$/,PT:/^PT[0-9]{9}$/,RO:/^RO[0-9]{2,10}$/,SE:/^SE[0-9]{12}$/,SI:/^SI[0-9]{8}$/,SK:/^SK[0-9]{10}$/},e=function(e,n){var o;return o=t[e],o&&o.test(n)},{validate_vat:e}}),define("modules/clean/photos/batch_thumb_loader",["jquery","modules/clean/ajax","modules/core/uri"],function(t,e,n){var o;return o=function(){function o(t){var e,n;e=t.batch_size,n=t.max_parallel_requests,this.on_batch=t.on_batch,this.batch_logger=t.batch_logger,this.on_batch_success=t.on_batch_success,this.batch_size=e||this.DEFAULT_BATCH_SIZE,this.max_parallel_requests=n||this.DEFAULT_MAX_PARALLEL_REQUESTS,this.thumb_url_queue=[],this.batch_queue=[],this.callback_by_id={},this.request_ids_by_url={},this.num_requests_in_flight=0,this.flushing=!1,this.next_thumb_request_id=0,this.next_batch_id=0,this.cancelled_urls={},this.outstanding_batches={}}return o.prototype.DEFAULT_BATCH_SIZE=16,o.prototype.DEFAULT_MAX_PARALLEL_REQUESTS=6,o.prototype.MAX_URL_LENGTH=6e3,o.prototype.queue_thumb=function(e,n,o){var r,i,s;return null==o&&(o={}),null==o.start_flushing&&(o.start_flushing=!0),null==o.prioritize_batch&&(o.prioritize_batch=!1),e?t.support.cors&&Constants.BATCH_THUMB_ENDPOINTS.length?(i=this.next_thumb_request_id,this.next_thumb_request_id++,(null!=(s=this.request_ids_by_url[e])?s.length:void 0)>0||(this.thumb_url_queue.push(e),this.request_ids_by_url[e]=[]),this.request_ids_by_url[e].push(i),this.callback_by_id[i]={url:e,callback:n},this.thumb_url_queue.length>=this.batch_size&&(o.prioritize_batch?this.batch_queue.unshift(this.thumb_url_queue.splice(0,this.batch_size)):this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size)),o.start_flushing&&this._send_batch_requests()),i):(r=!0,"function"==typeof n&&n(e,r),null):null},o.prototype.cancel_thumb=function(t){var e,n,o,r,i,s,a,_,u,c,l,d,h,p,f,m,g,v,b,y,w,E,x,S,A;if(null!=this.callback_by_id[t]){for(u=this.callback_by_id[t].url,delete this.callback_by_id[t],w=this.request_ids_by_url[u],r=l=0,f=w.length;f>l;r=++l)if(i=w[r],i===t){this.request_ids_by_url[u].splice(r,1);break}if(0===this.request_ids_by_url[u].length){for(delete this.request_ids_by_url[u],E=this.thumb_url_queue,r=d=0,m=E.length;m>d;r=++d)if(_=E[r],_===u)return void this.thumb_url_queue.splice(r,1);for(x=this.batch_queue,r=h=0,g=x.length;g>h;r=++h)for(n=x[r],s=p=0,v=n.length;v>p;s=++p)if(_=n[s],_===u)return n.splice(s,1),void(0===n.length&&this.batch_queue.splice(r,1));this.cancelled_urls[u]=1,A=[];for(o in this.outstanding_batches){for(S=this.outstanding_batches[o],c=S.urls,a=S.request,e=!0,y=0,b=c.length;b>y;y++)u=c[y],e=null!=this.cancelled_urls[u]&&e;if(e){a.abort();break}A.push(void 0)}return A}}},o.prototype.prioritize_thumb=function(){},o.prototype.flush=function(){for(;this.thumb_url_queue.length;)this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size));return this._send_batch_requests()},o.prototype.reset=function(t){var e;return e=t.batch_size,this.batch_logger=t.batch_logger,this.batch_size=e||this.DEFAULT_BATCH_SIZE},o.prototype.clear=function(){return this.thumb_url_queue=[]},o.prototype.pause=function(){return this.flushing=!1},o.prototype._send_batch_requests=function(){var t,n,o,r,i,s,a;if(!(0===this.batch_queue.length||this.num_requests_in_flight>=this.max_parallel_requests))return this.flushing=!0,s=this.batch_queue.shift(),a=this._generate_request_params(s),o=a[0],r=a[1],n=a[2],"function"==typeof this.on_batch&&this.on_batch(s),t=this.next_batch_id,this.next_batch_id++,this.num_requests_in_flight++,i=e.AuthenticatedRequest({xhrFields:{withCredentials:!0},url:o,type:r,data:n,success:this._success.bind(this,s),error:this._error.bind(this,s),complete:this._complete.bind(this,t)}),this.outstanding_batches[t]={urls:s,request:i},this._send_batch_requests()},o.prototype._success=function(t,e){var n,o,r,i,s,a,_,u,c,l,d,h,p,f,m,g,v;for(s=e.split("\n"),a={},l=0,p=t.length;p>l;l++)c=t[l],a[c]=!1;for(i=d=0,f=s.length;f>d;i=++d)r=s[i],_=r.indexOf(":"),-1!==_&&(u=r.substring(0,_).split("-"),o=parseInt(u[0],10),n=r.substring(_+1),c=t[o],a[c]=!0,this._call_callback(c,n),"function"==typeof this.batch_logger&&this.batch_logger(i,t.length));for("function"==typeof this.on_batch_success&&this.on_batch_success(t),g=t.filter(function(t){return!a[t]}),v=[],h=0,m=g.length;m>h;h++)c=g[h],v.push(null==this.cancelled_urls[c]?this._call_callback(c,c):void 0);return v},o.prototype._error=function(t){var e,n,o,r;for(r=[],n=0,o=t.length;o>n;n++)e=t[n],r.push(this._call_callback(e,e));return r},o.prototype._complete=function(t){var e,n,o,r,i,s;for(this.num_requests_in_flight--,s=this.outstanding_batches[t],o=s.urls,e=s.request,r=0,i=o.length;i>r;r++)n=o[r],delete this.cancelled_urls[n];return delete this.outstanding_batches[t],this.flushing?this._send_batch_requests():void 0},o.prototype._call_callback=function(t,e){var n,o,r,i,s;if(n=0===e.indexOf("data:image")?e:t,null!=this.request_ids_by_url[t])for(s=this.request_ids_by_url[t],r=0,i=s.length;i>r;r++)o=s[r],this.callback_by_id[o].callback(n,!1),delete this.callback_by_id[o];return delete this.request_ids_by_url[t]},o.prototype._generate_request_params=function(e){var o,r,i,s,a,_,u,c;return u=t.map(e,function(t){return n.parse(t).setScheme().setAuthority().toString()}),c=JSON.stringify(u),s=Math.abs(this._hash_string_to_int(c)),r=s%Constants.BATCH_THUMB_ENDPOINTS.length,o=Constants.BATCH_THUMB_ENDPOINTS[r],_={image_urls:c,parallel:!0},i=n.parse(o).setQuery(_).toString(),a=i.length>this.MAX_URL_LENGTH?"POST":"GET",[o,a,_]},o.prototype._hash_string_to_int=function(t){var e,n,o,r,i;if(n=0,0===t.length)return n;for(o=r=0,i=t.length;i>=0?i>r:r>i;o=i>=0?++r:--r)e=t.charCodeAt(o),n=(n<<5)-n+e;return n},o}()}),define("modules/clean/photos/legacy_thumb_loader",["jquery","modules/clean/photos/batch_thumb_loader","modules/clean/sprite"],function(t,e,n){var o;return o={MAX_THUMB_BATCH_REQUESTS:24,batch_load_thumbs:function(o,r,i,s){var a,_,u,c,l,d,h,p,f,m,g;for(d=t.grep(o,function(e){return t(e).data("src")}),this.img_map={},p=0,m=d.length;m>p;p++)_=d[p],c=String(t(_).data("src")),null==(h=this.img_map)[c]&&(h[c]=[]),this.img_map[c].push(_);for(this.instance?this.instance.reset({batch_size:r,batch_logger:s}):this.instance=new e({batch_size:r,max_parallel_requests:this.MAX_THUMB_BATCH_REQUESTS,on_batch:function(e){return function(n){var o,r,i,s,a;for(a=[],i=0,s=n.length;s>i;i++)r=n[i],o=t(e.img_map[r]),o.data("src",null),a.push(o.data("loading-src",r));return a}}(this),batch_logger:s}),u=[],f=0,g=d.length;g>f;f++)_=d[f],a=t(_),l=a.data("src"),this.instance.queue_thumb(l,function(t,e,o,r){return r||e.data("loading-src")?(e.data("loading-src",null),0===o.indexOf("data:image")?(e.attr("src",o),"function"==typeof i?i(e[0]):void 0):(e.error(function(){return e.attr("src",e.data("fail-src")||n.SPACER)}),e.load(function(){return"function"==typeof i?i(e[0]):void 0}),e.attr("src",o))):void 0}.bind(this,l,a));return this.instance.flush()},clear_all_pending_batches:function(){var t;return null!=(t=this.instance)?t.clear():void 0}}}),define("modules/clean/photos/photos_engagement_logger",["jquery","modules/clean/ajax"],function(t,e){var n;return n=function(){function t(){}return t.Platform={WEB:"web",WEB_CAROUSEL:"web_carousel"},t.PROMO_BANNER_CLICKED="promo_banner_clicked",t.PROMO_BANNER_BUTTON_CLICKED="promo_banner_button_clicked",t.PROMO_BANNER_SURVEY_RESPONSE="promo_banner_survey_response",t.CAROUSEL_WEB_PROMO_OPT_IN_MODAL_CONFIRM="carousel_web_promo_opt_in_modal_confirm",t.CAROUSEL_NAV_LINK_CLICK="carousel_nav_link_click",t.PHOTOS_NAV_LINK_CLICK="photos_nav_link_click",t.WEBAPP_LOGO_CLICKED="webapp_logo_clicked",t.WEBAPP_BACK_TO_DROPBOX_CLICKED="webapp_back_to_dropbox_clicked",t.WEBAPP_VIEW_GALLERY="webapp_view_gallery",t.WEBAPP_VIEW_CONVERSATIONS="webapp_view_conversations",t.WEBAPP_VIEW_ALBUMS="webapp_view_albums",t.WEBAPP_VIEW_FLASHBACK="webapp_view_flashback",t.WEBAPP_VIEW_SETTINGS="webapp_view_settings",t.WEBAPP_VIEW_USER_SETTINGS="webapp_view_user_settings",t.WEBAPP_USER_SETTINGS_IOS="webapp_user_settings_ios",t.WEBAPP_USER_SETTINGS_ANDROID="webapp_user_settings_android",t.WEBAPP_USER_SETTINGS_HELP="webapp_user_settings_help",t.WEBAPP_USER_SETTINGS_LEGAL="webapp_user_settings_legal",t.WEBAPP_USER_SETTINGS_FEEDBACK="webapp_user_settings_feedback",t.WEBAPP_USER_SETTINGS_LOGOUT="webapp_user_settings_logout",t.WEBAPP_USER_SETTINGS_OPT_IN="webapp_user_settings_opt_in",t.WEBAPP_USER_SETTINGS_OPT_OUT="webapp_user_settings_opt_out",t.WEBAPP_ACTION_ADD_TO_ALBUM="webapp_action_add_to_album",t.WEBAPP_ACTION_REMOVE_FROM_ALBUM="webapp_action_remove_from_album",t.WEBAPP_ACTION_DOWNLOAD="webapp_action_download",t.WEBAPP_ACTION_SHOW_IN_FOLDER="webapp_action_show_in_folder",t.WEBAPP_ACTION_DELETE="webapp_action_delete",t.WEBAPP_ACTION_EXCLUDE_FOLDERS="webapp_action_exclude_folders",t.WEBAPP_SHOW_EXCLUDE_MODAL="webapp_show_exclude_modal",t.WEBAPP_GALLERY_SELECT_EVENT="webapp_gallery_select_event",t.WEBAPP_GALLERY_DESELECT_EVENT="webapp_gallery_deselect_event",t.WEBAPP_GALLERY_SELECT_ITEM="webapp_gallery_select_item",t.WEBAPP_GALLERY_DESELECT_ITEM="webapp_gallery_deselect_item",t.WEBAPP_GALLERY_TIME_FIRST_ITEM="webapp_gallery_time_first_item",t.WEBAPP_GALLERY_TIME_EVENTS_OUTLINE="webapp_gallery_time_events_outline",t.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_EVENTS="webapp_gallery_time_first_visible_events",t.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_THUMBS_BATCH="webapp_gallery_time_first_visible_thumbs_batch",t.WEBAPP_GALLERY_EMPTY="webapp_gallery_empty",t.WEBAPP_GALLERY_CONTEXT_MENU_SHOWN="webapp_gallery_context_menu_shown",t.WEBAPP_LIGHTBOX_OPEN="webapp_lightbox_open",t.WEBAPP_LIGHTBOX_DOWNLOAD="webapp_lightbox_download",t.WEBAPP_LIGHTBOX_SELECT_ITEM="webapp_lightbox_select_item",t.WEBAPP_LIGHTBOX_DESELECT_ITEM="webapp_lightbox_deselect_item",t.WEBAPP_LIGHTBOX_FORWARD="webapp_lightbox_forward",t.WEBAPP_LIGHTBOX_BACK="webapp_lightbox_back",t.WEBAPP_LIGHTBOX_SHARE="webapp_lightbox_share",t.WEBAPP_LIGHTBOX_CLOSE_ICON="webapp_lightbox_close_icon",t.WEBAPP_LIGHTBOX_CLOSE_KEY="webapp_lightbox_close_key",t.WEBAPP_TIMELINE_NAVIGATION_SHOWN="webapp_timeline_navigation_shown",t.WEBAPP_TIMELINE_NAVIGATION_TRACK_CLICKED="webapp_timeline_navigation_track_clicked",t.WEBAPP_TIMELINE_NAVIGATION_SCRUBBER_DRAGGED="webapp_timeline_navigation_scrubber_dragged",t.WEBAPP_SHARE_CART_CANCEL="webapp_share_cart_cancel",t.WEBAPP_SHARE_CART_SHARE="webapp_share_cart_share",t.WEBAPP_SHARE_CART_ITEM_CLICKED="webapp_share_cart_item_clicked",t.WEBAPP_GALLERY_DELETE_MODAL_CONFIRMED="webapp_gallery_delete_modal_confirmed",t.WEBAPP_GALLERY_DELETE_MODAL_CANCELED="webapp_gallery_delete_modal_canceled",t.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CONFIRMED="webapp_gallery_remove_from_album_modal_confirmed",t.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CANCELED="webapp_gallery_remove_from_album_modal_canceled",t.WEBAPP_SHARE_COMPOSER_RECIPIENT="webapp_share_composer_recipient",t.WEBAPP_SHARE_COMPOSER_MESSAGE="webapp_share_composer_message",t.WEBAPP_SHARE_COMPOSER_SHARE="webapp_share_composer_share",t.WEBAPP_SHARE_COMPOSER_TWITTER="webapp_share_composer_twitter",t.WEBAPP_SHARE_COMPOSER_FACEBOOK="webapp_share_composer_facebook",t.WEBAPP_SHARE_COMPOSER_LINK="webapp_share_composer_link",t.WEBAPP_SHARE_WITH_SELF_ATTEMPT="webapp_share_with_self_attempt",t.WEBAPP_CONVERSATIONS_ROOM_CLICKED="webapp_conversations_room_clicked",t.WEBAPP_CONVERSATIONS_VIEW_SETTINGS="webapp_conversations_view_settings",t.WEBAPP_CONVERSATIONS_CLOSE_SETTINGS="webapp_conversations_close_settings",t.WEBAPP_CONVERSATIONS_TIME_FIRST_POST="webapp_conversations_time_first_post",t.WEBAPP_CONVERSATIONS_EMPTY="webapp_conversations_empty",t.WEBAPP_CONVERSATIONS_CHAT_VIEW_CLICKED="webapp_conversations_chat_view_clicked",t.WEBAPP_CONVERSATIONS_GALLERY_VIEW_CLICKED="webapp_conversations_gallery_view_clicked",t.WEBAPP_CONVERSATIONS_CHAT_VIEW_LOAD_MORE="webapp_conversations_chat_view_load_more",t.WEBAPP_CONVERSATIONS_GALLERY_VIEW_LOAD_MORE="webapp_conversations_gallery_view_load_more",t.WEBAPP_FLASHBACK_SELECT_EVENT="webapp_flashback_select_event",t.WEBAPP_FLASHBACK_SELECT_ITEM="webapp_flashback_select_item",t.WEBAPP_FLASHBACK_SURVEY_RESPONSE="webapp_flashback_survey_response",t.WEBAPP_FLASHBACK_SURVEY_FREE_RESPONSE="webapp_flashback_survey_free_response",t.WEBAPP_REPLY_COMPOSER_CLICKED="webapp_reply_composer_clicked",t.WEBAPP_REPLY_COMPOSER_ADD_PHOTOS="webapp_reply_composer_add_photos",t.WEBAPP_REPLY_COMPOSER_SEND="webapp_reply_composer_send",t.WEBAPP_OPT_IN_BANNER_SHOWN="webapp_opt_in_banner_shown",t.WEBAPP_OPT_IN_BANNER_CONFIRM="webapp_opt_in_banner_confirm",t.WEBAPP_OPT_OUT_BANNER_SHOWN="webapp_opt_out_banner_shown",t.WEBAPP_OPT_OUT_BANNER_CONFIRM="webapp_opt_out_banner_confirm",t.WEBAPP_OPT_OUT_MODAL_CONFIRM="webapp_opt_out_modal_confirm",t.DROPBOX_FLASHBACK_TRY_CAROUSEL="dropbox_flashback_try_carousel",t.DROPBOX_FLASHBACK_LEARN_MORE="dropbox_flashback_learn_more",t.first_log_sent=!1,t.logs_queued=[],t.HACK_prefix_to_replace=null,t.HACK_prefix_replace_with=null,t.HACK_new_platform=null,t.hack_all_log_prefixes_and_platform=function(e){var n,o,r;return r=e.prefix_to_replace,o=e.prefix_replace_with,n=e.new_platform,t.HACK_prefix_to_replace=r,t.HACK_prefix_replace_with=o,t.HACK_new_platform=n},t.apply_hacky_log_overrides=function(e,n){var o;return t.HACK_prefix_to_replace?(o=0===e.indexOf(t.HACK_prefix_to_replace)?e.replace(t.HACK_prefix_to_replace,t.HACK_prefix_replace_with):0!==e.indexOf(t.HACK_prefix_replace_with)?t.HACK_prefix_replace_with+e:e,[o,t.HACK_new_platform]):[e,n]},t.log_and_send=function(n,o,r){var i;return null==o&&(o={}),null==r&&(r=t.Platform.WEB),i=t.apply_hacky_log_overrides(n,r),n=i[0],r=i[1],e.WebRequest({url:"/photos/photos_engagement_log",data:{event:n,extra:JSON.stringify(o),platform:r}})},t.log=function(e,n,o){var r,i;return t.first_log_sent?(null==n&&(n={}),null==o&&(o=t.Platform.WEB),i=t.apply_hacky_log_overrides(e,o),e=i[0],o=i[1],r={event:e,extra:n,platform:o},t.logs_queued.push(r)):(t.log_and_send(e,n,o),void(t.first_log_sent=!0))},t.log_carousel=function(e,n){return t.log(e,n,t.Platform.WEB_CAROUSEL)},t._send_log_batch=function(){return t.logs_queued.length?(e.WebRequest({url:"/photos/photos_engagement_batch_log",data:{events:JSON.stringify(t.logs_queued)}}),t.logs_queued=[]):void 0},t}(),setInterval(n._send_log_batch,1e4),t(window).unload(n._send_log_batch),n}),define("modules/clean/react/button",["external/react"],function(t){var e,n;return n=t.DOM,e=function(e){return t.createClass({render:function(){var t,o,r,i;return r="",i=this.props.importance||"primary",r+=" button-"+i,this.props.variant&&"standard"!==this.props.variant&&(r+=" button-"+this.props.variant),this.props.className&&(r+=" "+this.props.className),o={className:r},this.props.disabled&&(o.disabled=!0),t=this.transferPropsTo(n[e](o,this.props.children))}})},{button:e("button"),link_button:e("a")}}),define("modules/clean/react/form_error_mixin",["external/react"],function(t){var e,n;return n=t.DOM,e={propTypes:{errorWrapperClassName:t.PropTypes.string,"disable-errors":t.PropTypes.bool,"error-after":t.PropTypes.bool,error:t.PropTypes.shape({message_text:t.PropTypes.string,message_html:t.PropTypes.string})},renderErrorIfEnabled:function(){return this.props["disable-errors"]?void 0:this.renderError()},renderError:function(){var t,e;return null!=(null!=(t=this.props.error)?t.message_html:void 0)?n.div({className:this.props.errorWrapperClassName,dangerouslySetInnerHTML:{__html:this.props.error.message_html}}):n.div({className:this.props.errorWrapperClassName},null!=(e=this.props.error)?e.message_text:void 0)}}}),define("modules/clean/react/help/sprite_div",["external/react"],function(t){var e;return e=t.DOM,t.createClass({render:function(){var t,n,o;return t=this.props.group,n=this.props.name,o=this.props.text,e.div({className:"sprite-div"},e.div({className:"sprite-frame small icon-left"},e.img({className:"sprite sprite_"+t+" s_"+t+"_"+n,src:"/static/images/icons/icon_spacer.gif"})),e.div({className:"sprite-text"},o))}})}),define("modules/clean/react/input",["external/react","external/underscore","jquery","modules/clean/react/form_error_mixin"],function(t,e,n,o){var r,i,s;return r=t.addons.classSet,i=t.DOM,s=function(s,a){return t.createClass({mixins:[o],getDefaultProps:function(){return{errorWrapperClassName:"text-input-error-wrapper"}},render:function(){var t,n,o,_,u,c,l,d,h,p,f;if(o={"text-input-input":!0,autofocus:this.props.autofocus,"password-input":"password"===a},_={"text-input":!0,"text-input-inline":this.props.inline,"textarea-input":"textarea"===s},_[this.props.variant||"standard"]=!0,null!=this.props.className)for(h=this.props.className.split(/\s/),l=0,d=h.length;d>l;l++)n=h[l],_[n]=!0;return t=e.omit(this.props,"className","onChange","value","valueLink","ref"),c=i[s](e.extend({className:r(o),type:a,value:this.props.value||(null!=(p=this.props.valueLink)?p.value:void 0)||this.state.value,onChange:this.onChangeInternal,ref:"inputComponent"},t)),u=this.renderErrorIfEnabled(),i.div({className:r(_)},this.props["error-after"]?void 0:u,i.div({className:"text-input-wrapper"},c,this.props.value||(null!=(f=this.props.valueLink)?f.value:void 0)||this.state.value?void 0:i.label({htmlFor:this.props.id},this.props.label)),this.props["error-after"]?u:void 0)},getValue:function(){return this.refs.inputComponent.getDOMNode().value},setValue:function(t){return this.refs.inputComponent.getDOMNode().value=t,this.setState({value:t})},resizeComponent:function(){var t,e;return e=this.refs.inputComponent.getDOMNode(),t=n(e),t.css("height","1px"),t.css("height",e.scrollHeight+"px")},_renderFinished:function(){var t;return this.props.autoresize&&this.resizeComponent(),"function"==typeof(t=this.props).afterRender?t.afterRender():void 0},componentDidMount:function(){return this._renderFinished()},componentDidUpdate:function(){return this._renderFinished()},getInitialState:function(){return{value:this.props.value}},onChangeInternal:function(t){var e;return"function"==typeof(e=this.props).onChange&&e.onChange(t),this.props.value?void 0:this.props.valueLink?this.props.valueLink.requestChange(t.target.value):this.setState({value:t.target.value})}})},{password:s("input","password"),text:s("input","text"),textarea:s("textarea","text")}}),define("modules/clean/react/modal",["external/react","jquery","modules/core/i18n","modules/core/dom","modules/clean/react/button","modules/clean/keycode"],function(t,e,n,o,r,i){var s,a,_,u,c,l;return c=n._,u=t.DOM,s="react-modal-root",l=function(t){var n,o;return null==t&&(t=!0),n=s,o=e("#"+n),!o.length&&t&&(o=e("<div />").attr({id:n}).prependTo("body")),o[0]},a=t.createClass({statics:{showInstance:function(e){var n;return n=l(),t.unmountComponentAtNode(n),t.renderComponent(e,n)},close:function(){var e;return e=l(),e?t.unmountComponentAtNode(e):void 0}},close:function(){return a.close()},_invokeCallbackAndClose:function(t,e,n){return null!=t&&"function"==typeof t.call&&t.call(this,e),e.defaultPrevented?void 0:this.props.autoClose||n?this.close():void 0},_dismiss:function(t){return this._invokeCallbackAndClose(this.props.onDismiss,t,!0)},_accept:function(t){return this._invokeCallbackAndClose(this.props.onAccept,t,!1)},propTypes:{acceptButtonText:t.PropTypes.string,dismissButtonText:t.PropTypes.string,altAction:t.PropTypes.renderable,onAccept:t.PropTypes.func,onDismiss:t.PropTypes.func,onShow:t.PropTypes.func,buttonComponent:t.PropTypes.component,style:t.PropTypes.oneOf(["default","clean"])},getDefaultProps:function(){return{acceptButtonText:c("OK"),dismissButtonText:null,buttonComponent:null,onAccept:function(){},onDismiss:function(){},onShow:function(){},autoClose:!0,style:"default"}},_fitInViewport:function(){var t,n,o,r,i,s,a;return t=90,a=e(window).height(),n=e(this.getDOMNode()),r=n.find(".db-modal"),o=n.find(".db-modal-content"),i=r.height(),r.css(this.props.width?{width:this.props.width,marginLeft:-this.props.width/2}:{marginLeft:-r.width()/2}),i>a?(s=i-a,o.css({maxHeight:Math.max(50,o.height()-s),overflowY:"auto"}),r.css({top:0})):r.css(2*t>a-i?{top:"50%",marginTop:-(.5*i)}:{top:t}),r.css({position:"fixed"})},_focus:function(){var t,n;return t=e(this.refs.modal.getDOMNode()),n=t.find("input[type=text], input[type=email]").first(),n.length?t=n:this.refs.primaryButton?t=e(this.refs.primaryButton.getDOMNode()):this.refs.tertiaryButton&&(t=e(this.refs.tertiaryButton.getDOMNode())),t.focus()},_keyDown:function(t){return t.stopPropagation(),t.which===i.ESC&&this._dismiss(t),t.which!==i.BACKSPACE||o.focus_in_input()?void 0:(t.preventDefault(),this._dismiss(t))},_renderButtons:function(){var t;return this.props.buttonComponent?this.props.buttonComponent:(t=[],this.props.submitting&&t.push(u.span({className:"dbmodal-loading"},u.img({src:"/static/images/icons/ajax-loading-small.gif"}))),this.props.acceptButtonText&&t.push(r.button({ref:"primaryButton",className:"dbmodal-button",importance:"primary",onClick:this._accept},this.props.acceptButtonText)),this.props.dismissButtonText&&t.push(r.button({ref:"tertiaryButton",className:"dbmodal-button",importance:"tertiary",onClick:this._dismiss},this.props.dismissButtonText)),t.length?u.div({className:"db-modal-buttons"},t):void 0)},_renderAltAction:function(){return this.props.altAction?u.div({className:"db-modal__alt-action"},this.props.altAction):void 0},componentDidMount:function(){var t;return e(document).trigger("modalOpened",this),o.scroll_lock_document(),e(this.getDOMNode()).find("img").on("load",this._fitInViewport),this._fitInViewport(),e(this.refs.modal.getDOMNode()).on("keydown",this._keyDown),this._focus(),"function"==typeof(t=this.props).onShow?t.onShow():void 0},componentWillUnmount:function(){return e(document).trigger("modalClosed",this),o.scroll_unlock_document(),e(this.refs.modal.getDOMNode()).off("keydown",this._keyDown)},render:function(){var t;return t=this.props.className,"clean"===this.props.style&&(t+=" db-modal--clean-style"),u.div({className:t},u.div({className:"db-modal-overlay",onClick:this._dismiss}),u.div({ref:"modal",className:"db-modal",tabIndex:0},u.div({className:"db-modal-box"},u.span({className:"db-modal-x",onClick:this._dismiss}),u.h2({className:"db-modal-title"},u.div({className:"db-modal-title-text"},this.props.title)),u.div({className:"db-modal-content"},this.props.children,this._renderButtons(),this._renderAltAction()))))}}),_={show:function(e){var n;return n={acceptButtonText:e.confirm_text,onAccept:e.confirm_callback,dismissButtonText:e.cancel_text,onDismiss:e.cancel_callback,title:e.title_text,width:e.width,className:"simple-modal"},a.showInstance(new a(n,t.DOM.div({className:"simple-modal-content",dangerouslySetInnerHTML:{__html:e.body_html}})))}},{Modal:a,SimpleModal:_}});var __slice=[].slice;define("modules/clean/react/react_i18n",["external/react","external/underscore","modules/core/i18n","modules/clean/react/util"],function(t,e,n,o){var r,i,s,a;return s=t.DOM,a=n._,i=t.createClass({render:function(){var t,n,o;if(n=this.props.children,"string"!=typeof n)throw new Error("R_ can only take a single string child");return o=a(n),t=e.isEmpty(e.omit(this.props,"children"))?o:o.format(e.omit(this.props,"children")),s.span({dangerouslySetInnerHTML:{__html:t}})}}),r=t.createClass({render:function(){var r,i,a;if(i=[],"number"!=typeof this.props.n)throw new Error("RP_ requires a number prop for @props.n, got "+this.props.n);return t.Children.forEach(this.props.children,function(t){return i.push(o.getText(t))}),a=n.ungettext.apply(n,__slice.call(i).concat([this.props.n])),r=e.isEmpty(e.omit(this.props,"children","n"))?a:a.format(e.omit(this.props,"children","n")),s.span({dangerouslySetInnerHTML:{__html:r}})}}),{R_:i,RP_:r}}),define("modules/clean/react/util",["external/react","external/underscore"],function(t){var e,n;return e=function(n){var o;return"string"==typeof n?n:n.props.text?n.props.text:(o=[],t.Children.forEach(n.props.children,function(t){return o.push(e(t))}),o.join(""))},n=function(e,o,r){var i,s;return o(e)?r(e):(i=!1,s=[],t.Children.forEach(e.props.children,function(){return function(t){var e;return e=n(t,o,r),s.push(e),e!==t?i=!0:void 0}}(this)),i?t.addons.cloneWithProps(e,{children:s}):e)},{getText:e,replaceSubtree:n}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/recaptcha_challenge",["jquery"],function(t){var e;return e=function(){function e(){this._help_link_onclick=__bind(this._help_link_onclick,this),this._switch_type_to_image_link_onclick=__bind(this._switch_type_to_image_link_onclick,this),this._switch_type_to_audio_link_onclick=__bind(this._switch_type_to_audio_link_onclick,this),this._reload_link_onclick=__bind(this._reload_link_onclick,this);var e,n,o,r,i;n=t("#recaptcha_widget"),o=n.find(".recaptcha-reload"),r=n.find(".recaptcha_only_if_image"),i=n.find(".recaptcha_only_if_audio"),e=n.find(".recaptcha-show-help"),o.click(this._reload_link_onclick),r.click(this._switch_type_to_audio_link_onclick),i.click(this._switch_type_to_image_link_onclick),e.click(this._help_link_onclick)}return e.prototype._reload_link_onclick=function(){return Recaptcha.reload(),!1},e.prototype._switch_type_to_audio_link_onclick=function(){return Recaptcha.switch_type("audio"),!1},e.prototype._switch_type_to_image_link_onclick=function(){return Recaptcha.switch_type("image"),!1},e.prototype._help_link_onclick=function(){return Recaptcha.showhelp(),!1},e}()}),define("modules/clean/shared_link_error",["jquery","modules/clean/ajax"],function(t,e){var n;return n=function(){function n(){t("#broken-share-article").on("click",function(){return e.WebRequest({url:"/shared_link_error_log",data:{evt:o}})})}var o;return o="click-sharing-article",n}()}),define("modules/clean/sharing/shared_link_for_sf",["external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/filepath","modules/clean/react/help/sprite_div","modules/clean/sharing/shmodel_link","modules/core/i18n","modules/core/uri"],function(t,e,n,o,r,i,s,a){var _,u,c;return c=s._,u=t.DOM,_=t.createClass({statics:{showInstance:function(e,n){return t.renderComponent(e,n)}},propTypes:{
fq_path:t.PropTypes.string.isRequired,user_id:t.PropTypes.number.isRequired,editable:t.PropTypes.number.isRequired,link:t.PropTypes.string,show_link_settings_modal:t.PropTypes.func,get_link_success_callback:t.PropTypes.func},render:function(){return this.state.link?u.div({},u.label({}),c(this.props.editable?"Anyone with the link can edit. ":"Anyone with the link can view. "),u.a({className:"change-permissions-link",onClick:function(t){return function(){var e;return"function"==typeof(e=t.props).show_link_settings_modal&&e.show_link_settings_modal(),!1}}(this)},c("Set visibility / expiration")),i({link:this.state.link})):u.a({href:"#",className:"get-link-button freshbutton",onClick:function(t){return function(){return n.ShmodelUILogger.log("simple-sharing-get-link"),e.WebRequest({url:a({path:"/sm/create_for_sf"+o.normalize(t.props.fq_path)}).updateQuery(Constants.UID_PARAM_NAME,t.props.user_id),type:"POST",success:function(e){var n;return e=JSON.parse(e),t.props.editable=e.editable,t.setState({link:e.link}),"function"==typeof(n=t.props).get_link_success_callback?n.get_link_success_callback():void 0},error:function(){return t.setState({link:null})}}),!1}}(this)},r({group:"web",name:"s_link",text:c("Get link")}))},getInitialState:function(){return{link:this.props.link}}})}),define("modules/clean/sharing/shmodel_link",["external/react","jquery","modules/clean/analytics"],function(t,e,n){var o,r;return r=t.DOM,o=t.createClass({propTypes:{link:t.PropTypes.string.isRequired},render:function(){return r.div({className:"copy-link-input-container"},r.div({className:"text-input text-input-inline small"},r.div({className:"text-input-wrapper"},r.input({readOnly:!0,type:"text",value:this.props.link,className:"text-input-input",onClick:function(t){return function(e){return t._select_all_text(e.currentTarget)}}(this)}))))},_select_all_text:function(t){return e(t)[0].select(),n.ShmodelUILogger.log("simple-sharing-link-selected")}})}),define("modules/clean/sprite",["jquery","modules/core/html"],function(t,e){var n;return n={SPACER:"/static/images/icons/icon_spacer.gif",CLASS_PREFIX:"s_",_make_class:function(t,e){return this.CLASS_PREFIX+t+"_"+e},src:function(e,n,o){return this.clear(e),t(e).addClass(this._make_class(n,o))},replace:function(e,n,o,r){return t(e).removeClass(this._make_class(n,o)).addClass(this._make_class(n,r))},clear:function(e){var n;return n=e.className.split(" "),n=t.grep(n,function(t){return function(e){return e&&0!==e.indexOf(t.CLASS_PREFIX)}}(this)),e.className=n.join(" ")},make:function(e,n,o){var r;return o=this._prep_attrs(e,n,o),r=t("<img />",o),r[0]},html:function(t,n,o){var r,i;o=this._prep_attrs(t,n,o),r=["<img "];for(i in o)r.push(i,'="',e._raw_escape(o[i]),'" ');return r.push("/>"),new e(r.join(""))},_prep_attrs:function(t,e,n){var o;return null==n&&(n={}),n.src=n.src||this.SPACER,o=["sprite","sprite_"+t,this._make_class(t,e)],n["class"]&&o.push(n["class"]),n["class"]=o.join(" "),n},_get:function(t){return t.className},_set:function(t,e){return t.className=e,t.src=this.SPACER}}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/sso_login_checks",["modules/clean/ajax"],function(t){var e;return e=function(){function e(t,e,n){this.$email_input=t,this.show_sso_fn=e,this.hide_sso_fn=n,this._check_sso_state=__bind(this._check_sso_state,this),t.on("input keyup change",this._check_sso_state)}return e._sso_check_in_flight={},e._sso_check_cache={},e.prototype._check_sso_state=function(){var n,o,r;return r=this.$email_input.val(),o=r.trim(),o.match(/^[^@\s]+@[^@\s]+\.[A-Za-z]{2,}$/)?(n=o.toLowerCase(),n in e._sso_check_cache?this._handle_sso_state(e._sso_check_cache[n]):e._sso_check_in_flight[n]?void 0:(e._sso_check_in_flight[n]=!0,t.WebRequest({url:"/sso_state",data:{email:o},success:function(t){return function(o){return o=JSON.parse(o),delete e._sso_check_in_flight[n],e._sso_check_cache[n]=o.user_sso_state,t.$email_input.val()!==r?t._check_sso_state():t._handle_sso_state(o.user_sso_state)}}(this),error:function(t){return function(){return delete e._sso_check_in_flight[n],t.hide_sso_fn()}}(this)}))):this.hide_sso_fn()},e.prototype._handle_sso_state=function(t){return"required"===t?this.show_sso_fn(!1):"optional"===t?this.show_sso_fn(!0):this.hide_sso_fn()},e}()}),define("modules/clean/static_resource_loader",["jquery"],function(t){var e,n,o,r,i;return i=function(){var t,e,n;return t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift(),function(){return e.apply(n,t.concat(Array.prototype.slice.call(arguments)))}},e=function(e,n){return t.ajax({url:e,type:"get",success:function(e){return t("head").append("<style>"+e+"</style>"),"function"==typeof n?n():void 0}})},n=function(e,n){return t.ajax({dataType:"script",cache:!0,url:e,success:function(){return"function"==typeof n?n():void 0}})},r=function(t,e,n){var o,r,s,a,_,u,c,l;if(r={},!t)return void("function"==typeof n&&n());for(a=0,u=t.length;u>a;a++)s=t[a],r[s]=!1;for(o=function(t){var e,o,i;r[t]=!0,o=!0;for(e in r)if(i=r[e],!i){o=!1;break}return o&&"function"==typeof n?n():void 0},l=[],_=0,c=t.length;c>_;_++)s=t[_],l.push(e(s,i(o,this,s)));return l},o=function(t,o,i){var s,a;return a={css:!t,js:!o},s=function(t){var e,n,o;a[t]=!0,n=!0;for(e in a)if(o=a[e],!o){n=!1;break}return n&&"function"==typeof i?i():void 0},r(t,e,function(){return s("css")}),r(o,n,function(){return s("js")})},{async_multiload:o}});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("modules/clean/storage",[],function(){var t,e,n;return t=function(){function t(){}return t.storage=void 0,t.get=function(t){return this.storage&&window.JSON?JSON.parse(this.storage.getItem(t)):void 0},t.set=function(t,e){return this.storage&&window.JSON?this.storage.setItem(t,JSON.stringify(e)):void 0},t}(),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.storage=function(){try{return window.sessionStorage}catch(t){}}(),e}(t),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.storage=function(){try{return window.localStorage}catch(t){}}(),e}(t),{SessionStorage:n,LocalStorage:e}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("modules/clean/teams/team_folder_modal",["modules/core/browser","modules/clean/components/ajax_form","modules/clean/dbmodal"],function(t,e,n){var o,r;return o=n.DBModal,r=function(n){function o(){return this.on_confirm_button_click=__bind(this.on_confirm_button_click,this),this._$form=__bind(this._$form,this),o.__super__.constructor.apply(this,arguments)}return __extends(o,n),o.prototype._$form=function(){return this.$modal_window.find(".new_team_folder_form")},o.prototype.on_confirm_button_click=function(t){return t.preventDefault(),this._$form().submit()},o.prototype.on_show=function(){var n;return n=this._$form(),new e(n),n.on(e.SUCCESS_EVENT,function(e){return function(n,o){return e.options.open_created_folder?t.redirect(o.sf_info.href):t.reload()}}(this)),this.options.back_fn?this.$modal_window.find("a.back").on("click",function(t){return function(e){return t.options.back_fn(e,t)}}(this)):void 0},o}(o)}),define("modules/clean/teams/trial_buy_now",["jquery","modules/clean/ajax","modules/clean/react/modal","modules/core/browser","modules/core/i18n"],function(t,e,n,o,r){var i,s,a;return a=r._,s=r.ungettext,i={showModal:function(t){var e,o;return o=a("Buy Dropbox for Business now"),e=s("You have <strong>%(days)s</strong> day remaining in your Dropbox for Business trial. Buy now to ensure that your team continues to work efficiently!","You have <strong>%(days)s</strong> days remaining in your Dropbox for Business trial. Buy now to ensure that your team continues to work efficiently!",t).format({days:t}),n.SimpleModal.show({title_text:o,body_html:e,confirm_text:a("Buy now"),confirm_callback:i._confirm,cancel_callback:i._cancel})},_confirm:function(){return t.ajax({type:"POST",url:"/team/setup/trial_buy_now/dismiss",success:function(){return function(){return o.redirect("/team/renew")}}(this)})},_cancel:function(){return t.post("/team/setup/trial_buy_now/dismiss")}}}),define("modules/clean/third_party/third_party_constants",["modules/core/exception","modules/core/i18n"],function(t,e){var n,o,r;return o=t.assert,r=e._,n={GOOGLE:"1",YAHOO:"2",FACEBOOK:"3",TWITTER:"4",VARIOUS:"-1",NONE:"-2",services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK,this.TWITTER]},contact_services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK]},to_img:function(t){switch(t){case this.GOOGLE:return"/static/images/icons/gmail_logo28.png";case this.YAHOO:return"/static/images/icons/yahoo_mail_logo28.png";case this.FACEBOOK:return"/static/images/icons/facebook_logo28.png";default:return o(!1,"Should never get ThirdParty.to_img with service: "+t)}},to_name:function(t){switch(t){case this.GOOGLE:return r("Gmail");case this.YAHOO:return r("Yahoo! Mail");case this.FACEBOOK:return r("Facebook");case this.VARIOUS:return r("Email");default:return o(!1,"Should never get ThirdParty.to_name with service: "+t)}},logging_identifiers:function(t){switch(t){case this.GOOGLE:return"google";case this.YAHOO:return"yahoo";case this.FACEBOOK:return"facebook";case this.VARIOUS:return"email";default:return o(!1,"Should never get ThirdParty.logging_identifiers with service: "+t)}}}}),define("modules/clean/top_notif",["jquery"],function(t){var e,n,o,r,i,s;return s={HIDE_EVENT:"db:topnotificationbar:hide",hide:function(){return t("#top-notification-bar-container").hide(),t("body").removeClass("top-notification-bar"),t(document).trigger(this.HIDE_EVENT)}},o={init:function(){return t(".eu-bar-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.ajax({url:"/dismiss_eu_cookie_notification",type:"POST"})})}},r={init:function(){return t(".expired-ios-bar-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.ajax({url:"/dismiss_expired_ios_notification",type:"POST"})})}},n={init:function(){return t("#early-admin-access-fts-and-link-controls-banner-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.ajax({url:"/team/dismiss_sharing_controls_banner",type:"POST"})})}},e={init:function(){return t("#early-admin-access-fts-banner-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.ajax({url:"/team/dismiss_fts_banner",type:"POST"})})}},i={init:function(){return t("#locale-switch-banner-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.ajax({url:"/dismiss_locale_switch_banner",type:"POST"})})}},{TopNotificationBar:s,EUCookieNotificationBar:o,ExpiredIOSNotificationBar:r,DfBAdminEarlyAccessSharingControlsBar:n,DfBAdminEarlyAccessFtsBar:e,LocaleSwitchBar:i}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/uirequest",["jquery","modules/core/html","modules/core/notify","modules/clean/ajax","modules/clean/components/ajax_form","modules/clean/react/modal","modules/clean/static_resource_loader"],function(t,e,n,o,r,i,s){var a;return a=function(){function t(t,e,n){return this.$node=t,this.url=e,this.options=null!=n?n:{},this.complete=__bind(this.complete,this),this.handle_errors=__bind(this.handle_errors,this),this.error=__bind(this.error,this),this.perform_actions=__bind(this.perform_actions,this),this.success=__bind(this.success,this),this.shouldDelayComplete=!1,this.$node.hasClass("ajax-loading")?!1:(this.$node.addClass("ajax-loading"),void new o.WebRequest({url:this.url,data:this.options.data||{},success:this.success,error:this.error,complete:this.complete,subject_user:this.options.subject_user}))}return t.prototype.success=function(t,e,n){var o,i,a;return(o=r.extract_errors(n.responseText))?(this.handle_errors(o),void("function"==typeof(i=this.options).error&&i.error(n,e))):(t=JSON.parse(n.responseText),t.redirect?void(window.location.href=t.redirect):t.reload?void window.location.reload():(this.shouldDelayComplete=t.js||t.css,this.shouldDelayComplete?s.async_multiload(t.css,t.js,function(o){return function(){var r,i;return o.perform_actions(t.actions||[]),"function"==typeof(r=o.options).success&&r.success(t,e,n),o.$node.removeClass("ajax-loading"),"function"==typeof(i=o.options).complete?i.complete(n,e):void 0}}(this)):(this.perform_actions(t.actions||[]),void("function"==typeof(a=this.options).success&&a.success(t,e,n)))))},t.prototype.perform_actions=function(t){var o,r,s,a,_,u,c,l,d,h,p;for(p=[],d=0,h=t.length;h>d;d++)switch(r=t[d],a=r[0],s=r[1],c=r[2],o=this.$node,c&&"modal"!==a&&("^"===c.charAt(0)&&(u=c.split(" "),o=o.closest(u[0].substr(1)),c=u.slice(1).join(" ")),c&&(o=o.find(c).filter(":first"))),a){case"modal":_=new e(s).toHTML(),c&&(l=c),p.push(i.SimpleModal.show({title_text:l,body_html:_}));break;case"html":p.push(o.html(s));break;case"replaceWith":p.push(o.replaceWith(s));break;case"after":p.push(o.after(s));break;case"before":p.push(o.before(s));break;case"toggleClass":p.push(o.toggleClass(s));break;case"addClass":p.push(o.addClass(s));break;case"removeClass":p.push(o.removeClass(s));break;case"notify":p.push(n.success(s));break;case"notifyError":p.push(n.error(new e(s)));break;default:p.push(void 0)}return p},t.prototype.error=function(t,e){var n,o;return n=r.extract_errors(t.responseText),this.handle_errors(n),"function"==typeof(o=this.options).error?o.error(t,e):void 0},t.prototype.handle_errors=function(t){var o;return t===!1?n.error():"string"==typeof t?(o=this.options.html_in_error_msg?new e(t):t,n.error(o)):r.fill_errors(this.$node,t)},t.prototype.complete=function(t,e){var n;if(!this.shouldDelayComplete)return this.$node.removeClass("ajax-loading"),"function"==typeof(n=this.options).complete?n.complete(t,e):void 0},t}()}),define("modules/clean/undo",["jquery","modules/core/html","modules/core/i18n","modules/core/notify"],function(t,e,n,o){var r,i;return i=n._,r=function(){function e(){}return e.perform_undo=function(){return null!=this.undo_handler?(this.undo_handler(this.undo_info),this.undo_handler=this.undo_info=null):void 0},e.notifyWithUndo=function(n,r,s){var a,_;return r?(this.undo_info=r,this.undo_handler=s,a=t("<span />"),null!=n.toHTML?a.html(n.toHTML()):a.text(n),_=t("<a/>",{href:"#"}).text(i("Undo")),_.on("click",function(){return e.perform_undo(),!1}),a.append("&nbsp;").append(_),this.undo_notification=o.success(a,30)):o.success(n)},e}()}),define("modules/clean/unity_check_file_cache",["modules/clean/unity_features"],function(t){var e;if(null!=t)return e=function(){function e(){}return e._cache={},e.get=function(e,n){return this._cache[t.server_path(e,n)]},e.set=function(t,e){return this._cache[t]=e},e.set_batch=function(t){var e,n,o;o=[];for(n in t)e=t[n],o.push(this._cache[n]=e);return o},e.clear=function(){return this._cache={}},e}(),__CONDITIONAL_JS__.UnityCheckFileCache=e,e});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/unity_connection",["jquery","modules/core/exception","modules/core/uri","modules/clean/ajax","modules/clean/viewer"],function(t,e,n,o){var r,i;if("function"==typeof window.hasOwnProperty?window.hasOwnProperty("WebSocket"):void 0)return r=function(){function r(){this._on_response_timeout=__bind(this._on_response_timeout,this),this._on_message=__bind(this._on_message,this);var t,o,s,a,_,u,c;this.client_version=null,this._pending_callbacks=[],this._is_client_dev=null,this._ws=null,this._response_callbacks={},this._current_message_id=1,this.logger=new i,this.logger.update({web_unity_version:r._LATEST_UNITY_VERSION}),this._routes={check_unity_version:this._check_unity_version.bind(this),fetch_unity_nonce:this._fetch_unity_nonce.bind(this),complete_handshake:this._complete_handshake.bind(this)};try{for(o=_=u=r._MIN_PORT,c=r._MAX_PORT;c>=u?c>=_:_>=c;o=c>=u?++_:--_)s={scheme:"wss",authority:"www.dropboxlocalhost.com:"+o.toString(),path:"/ws"},a=new window.WebSocket(n(s).toString()),a.onmessage=this._on_message({ws:a,port:o,state:r._CONNECTION_OPENED_STATE,client_version:null,is_dev:null})}catch(l){return t=l,void this.logger.report_event("unity_failure",{message:"WebSocket creation failed. Message: "+t.message,error_name:t.name,port:o,stack:e.stackTrace()})}this.logger.report_event("handshake_started")}return r._CONNECTION_OPENED_STATE=0,r._VERSION_CHECK_STATE=1,r._FETCHING_NONCE_STATE=2,r._NONCE_RETURNED_TO_CLIENT_STATE=3,r._HANDSHAKE_COMPLETED_STATE=4,r._LATEST_UNITY_VERSION=2,r._RESPONSE_TIMEOUT=5e3,r._MIN_PORT=17600,r._MAX_PORT=17602,r.prototype._on_message=function(t){return function(e){return function(n){var o,r,i,s,a,_;return r=JSON.parse(n.data),null==r.func||null==(null!=(s=r.header)?s.message_id:void 0)||null==(null!=(a=r.header)?a.should_respond:void 0)?void e._terminate_handshake(t.ws,"Malformed message from client: "+n.data):(null!=(null!=(_=r.header)?_.log_data:void 0)&&e.logger.update(r.header.log_data),e.logger.update({port:t.port}),"response"===r.func?e._on_response(r.header.message_id,r.data):(o=e._routes[r.func],null==o?void e._terminate_handshake(t.ws,"Unknown function "+r.func):(i=e.is_ready()?o(r.data):o(t,r.data),r.header.should_respond?e.send("response",i,null,null,r.header.message_id):void 0)))}}(this)},r.prototype.send=function(t,e,n,o,r){return null==e&&(e=null),null==n&&(n=null),null==o&&(o=null),null==r&&(r=null),this._send_with_ws(this._ws,t,e,n,o,r)},r.prototype._send_with_ws=function(t,n,o,i,s,a){var _,u;return null==o&&(o=null),null==i&&(i=null),null==s&&(s=null),null==a&&(a=null),null==a&&(a=this._current_message_id,e.assert(this._current_message_id%2===1,"Web-initiated message_ids should remain odd"),this._current_message_id+=2),null!==i&&(u=window.setTimeout(this._on_response_timeout(a,s),r._RESPONSE_TIMEOUT),this._response_callbacks[a]=[i,s,u]),_={func:n,header:{message_id:a,should_respond:null!==i,log_data:this.logger.get_log_data_for_client()}},null!=o&&(_.data=o),t.send(JSON.stringify(_))},r.prototype._on_response=function(t,e){var n,o,r,i;return t in this._response_callbacks?(i=this._response_callbacks[t],n=i[0],r=i[1],o=i[2],delete this._response_callbacks[t],window.clearTimeout(o),n(e)):void 0},r.prototype._on_response_timeout=function(t,e){return function(n){return function(){var o,r;return r=n._response_callbacks[t],o=r[0],e=r[1],o=r[2],delete n._response_callbacks[t],"function"==typeof e?e():void 0}}(this)},r.prototype._check_unity_version=function(t,e){return t.state===r._CONNECTION_OPENED_STATE?(t.state=r._VERSION_CHECK_STATE,t.client_version=e.client_version,t.is_dev=e.is_dev,e.client_version>=2?(this.logger.report_event("handshake_version_check"),this._send_with_ws(t.ws,"initiate_handshake")):t.state.close()):t.state.close()},r.prototype._fetch_unity_nonce=function(t,e){return t.state===r._VERSION_CHECK_STATE?(t.state=r._FETCHING_NONCE_STATE,this.logger.report_event("handshake_fetch_nonce"),this._retrieve_unity_nonce(t,e.nonce_key)):t.state.close()},r.prototype._retrieve_unity_nonce=function(t,e){return o.WebRequest({url:n({path:"/retrieve_unity_nonce"}),dataType:"json",data:{nonce_key:e},success:function(e){return function(n){switch(n.status){case"OK":return t.state=r._NONCE_RETURNED_TO_CLIENT_STATE,e.logger.report_event("handshake_nonce_sent_to_unity_server"),e._send_with_ws(t.ws,"verify_unity_nonce",{nonce:n.message});case"MISMATCHED_USER_IDS":return e._terminate_handshake(t.ws,"Mismatched user_ids. Client: "+n.message.client_user_ids+", Web: "+n.message.web_user_ids);case"INVALID":return e._terminate_handshake(t.ws,"Could not find nonce with given nonce_key.")}}}(this),error:function(e){return function(n,o,r){return e._terminate_handshake(t.ws,"Unable to retrieve nonce from server",{status:o,error_string:r})}}(this)})},r.prototype._complete_handshake=function(t,n){var o,i,s;if(t.state!==r._NONCE_RETURNED_TO_CLIENT_STATE||!n.is_success)return this._terminate_handshake(t.ws,"Unable to complete handshake.");if(t.state=r._HANDSHAKE_COMPLETED_STATE,null!=this._ws&&this._is_client_dev===t.is_dev)return o="Only one Unity handshake can succeed! Something's very wrong...",this._terminate_handshake(t.ws,o),e.assert(!1,o);if(null==this._ws||t.is_dev){if(this.logger.report_event("handshake_complete"),this.client_version=t.client_version,this._is_client_dev=t.is_dev,this._ws=t.ws,this.is_ready()){for(s=[];this._pending_callbacks.length;)i=this._pending_callbacks.pop(),s.push(i());return s}return this._pending_callbacks=[]}},r.prototype._terminate_handshake=function(e,n,o){var r;return null==o&&(o=null),r={message:n},null!=o&&t.extend(r,o),this.logger.report_event("unity_failure",r),e.close()},r.prototype.call_when_ready=function(t){return this.is_ready()?t():this._pending_callbacks.push(t)},r.prototype.is_ready=function(){var t;return 1===(null!=(t=this._ws)?t.readyState:void 0)},r}(),i=function(){function e(){this._data={logging_source:"web"}}return e.prototype.update=function(e){return t.extend(this._data,e)},e.prototype.report_event=function(t,e){return null==e&&(e=null),this._data.event_name=t,this._data.local_ts=(new Date).getTime()/1e3,this._data.extra=JSON.stringify(e||{}),o.WebRequest({url:n({path:"/unity_connection_log"}),dataType:"json",data:this._data})},e.prototype.get_log_data_for_client=function(){return{web_unity_version:this._data.web_unity_version,user_agent:window.navigator.userAgent}},e.prototype.unity_session_id=function(){return this._data.unity_session_id},e}(),r}),define("modules/clean/unity_features",["modules/clean/filepath","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/unity_connection"],function(t,e,n,o,r,i){var s,a;if(null!=i)return a=new i,s=function(){function i(){}return i.open_file=function(e,n,i,s,_){var u;return null==_&&(_=null),u=this.server_path(e,n),a.call_when_ready(function(){return a.client_version>=2?(a.logger.report_event("open_file",{user_id:i,path_id:u,file_extension:t.file_extension_for_logging(u)}),r.WebRequest({url:o({path:"/unity_open_log"}),dataType:"json",data:{user_id:i,server_path:u,file_extension:t.file_extension_for_logging(u),unity_session_id:a.logger.unity_session_id()}}),a.send("open_file",{server_path:u,user_id:i},s,_)):void 0})},i.standard_open_file_handler=function(t){return t?void 0:n.error(e._("Error opening file"))},i.check_file=function(e,n,o,r,i){var s;return null==i&&(i=null),s=this.server_path(e,n),a.call_when_ready(function(){return a.client_version>=2?(a.logger.report_event("check_file",{user_id:o,path_id:s,file_extension:t.file_extension_for_logging(s)}),a.send("check_file",{server_path:s,user_id:o},r,i)):void 0})},i.check_file_batch=function(e,n,o,r){var i,s;return null==r&&(r=null),s=function(){var t,n,o;for(o=[],t=0,n=e.length;n>t;t++)i=e[t],o.push(this.server_path(i.ns_id,i.ns_path));return o}.call(this),a.call_when_ready(function(){var e;return a.client_version>=2?(a.logger.report_event("check_file_batch",{user_id:n,path_ids:s,file_extensions:function(){var n,o,r;for(r=[],n=0,o=s.length;o>n;n++)e=s[n],r.push(t.file_extension_for_logging(e));return r}()}),a.send("check_file_batch",{server_paths:s,user_id:n},o,r)):void 0})},i.server_path=function(t,e){return""+t+":"+e},i}(),__CONDITIONAL_JS__.UnityFeatures=INLINE_JS.UnityFeatures=s,s}),define("modules/clean/upsell/ha_loader",["jquery","modules/clean/ajax"],function(t,e){var n;return n={init:function(n,o,r){return o?e.WebRequest({url:"/promo",data:{campaign_id:r,ha_location:n},subject_user:o,success:function(){return function(e){return e&&"no_ad"!==e?t("#ha-container").html(e):void 0}}(this)}):void 0}}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/upsell/upsell_controller",["jquery","modules/core/dom","modules/core/uri"],function(t,e,n){var o;return o=function(){function o(e,n,o){this.options=o,this.post_confirm=__bind(this.post_confirm,this),this.post_dismiss=__bind(this.post_dismiss,this),this.confirm=__bind(this.confirm,this),this.dismiss=__bind(this.dismiss,this),this._dismissUrl=__bind(this._dismissUrl,this),this._confirmUrl=__bind(this._confirmUrl,this),this._keydown=__bind(this._keydown,this),e.one("click",this.confirm),n.one("click",this.dismiss),this.options.dismissWithKeys&&t(document).on("keydown",this._keydown)}return o.prototype._keydown=function(n){return 27===n.keyCode||8===n.keyCode&&!e.focus_in_input()?(n.preventDefault(),t(document).off("keydown",this._keydown),this.dismiss(n)):void 0},o.prototype._campaignUrl=function(t){var e;return this.options&&this.options.campaignId?(e=n({path:t}).updateQuery({campaign_id:this.options.campaignId}),e.toString()):void 0},o.prototype._confirmUrl=function(){return this._campaignUrl("/upsell/confirm")},o.prototype._dismissUrl=function(){return this._campaignUrl("/upsell/dismiss")},o.prototype._confirmOrDismiss=function(e,n,o){return"keydown"===e.type||o||(e.stopImmediatePropagation(),e.preventDefault()),t.ajax({type:"POST",url:n,success:function(){return function(){return"keydown"===e.type||o?void 0:e.target.click()}}(this)})},o.prototype.dismiss=function(t){var e;return e=this._dismissUrl(),e?this._confirmOrDismiss(t,e,!1):void 0},o.prototype.confirm=function(t){var e;return e=this._confirmUrl(),e?this._confirmOrDismiss(t,e,this.options.confirmInNewTab):void 0},o.prototype.log_impression=function(){var e;return e=this._campaignUrl("/upsell/log_impression"),e?t.post(e):void 0},o.prototype.log_event=function(e){var o;return this.options&&this.options.campaignId?(o=n({path:"/upsell/log_event"}).updateQuery({event_name:e,campaign_id:this.options.campaignId}),t.post(o.toString())):void 0},o.prototype.post_dismiss=function(){var e;return e=this._dismissUrl(),e?t.post(e):void 0},o.prototype.post_confirm=function(){var e;return e=this._confirmUrl(),e?t.post(e):void 0},o}()});var __hasProp={}.hasOwnProperty;define("modules/clean/user",[],function(){var t;return t=function(){function t(t){var e;for(e in t)__hasProp.call(t,e)&&"string"==typeof e&&"_"!==e[0]&&(this[e]=t[e])}return t.prototype.toString=function(){return String(this.id)},t}()});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},__slice=[].slice;define("modules/clean/validators/validators",["jquery","external/underscore","modules/core/i18n","modules/core/instantiate"],function(t,e,n,o){var r,i,s,a,_,u,c,l,d,h,p,f,m;return f=n._,m={},h=function(t,e){return m[t]=e},d=function(t){var e,n;if(n=t[0],e=t.slice(1),!m[n])throw new Error("Cannot find validator of type "+n);return o.construct(m[n],e)},c=function(){function t(t){this.messages=e.extend({},this.constructor.messages,null!=t?t.messages:void 0)}return t}(),i=function(t){function n(){var t,o,r;r=1<=arguments.length?__slice.call(arguments,0):[],o=null,e.isArray(e.last(r))||(o=e.last(r),r=e.initial(r)),this.validators=function(){var e,n,o;for(o=[],e=0,n=r.length;n>e;e++)t=r[e],null!==t&&o.push(d(t));return o}(),n.__super__.constructor.call(this,o)}return __extends(n,t),n.prototype.validate=function(t,e){var n,o,r,i,s;for(i=this.validators,s=[],o=0,r=i.length;r>o;o++)n=i[o],s.push(n.validate(t,e));return s},n}(c),h("AllValidator",i),r=/^[\x00-\x7f]*$/,s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.messages={asciiOnly:f("Only basic ASCII characters allowed")},e.prototype.validate=function(t){if(!r.test(t))throw new Error(this.messages.asciiOnly)},e}(c),h("AsciiOnlyValidator",s),u=function(e){function n(t){n.__super__.constructor.call(this,t),this.not_empty=t.not_empty,this.strip=t.strip}return __extends(n,e),n.messages={empty:f("Please enter a value for %(field)s")},n.prototype.validate=function(e,n){if(this.strip&&(e=t.trim(e)),this.not_empty&&!e)throw new Error(this.messages.empty.format({field:null!=n?n.field:void 0}))},n}(c),h("StringValidator",u),_=function(t){function e(t){e.__super__.constructor.call(this,t),this.lastname_goes_first=null!=t?t.lastname_goes_first:void 0}return __extends(e,t),e.messages={empty:f("Please enter your name")},e.prototype.validate=function(t,e){var n;if(!e.data.lname&&!e.data.fname)if(this.lastname_goes_first){if("lname"===e.field)throw new Error(this.messages.empty)}else if("fname"===e.field)throw new Error(this.messages.empty);return"fname"===e.field?(n=d(["StringValidator",{not_empty:!0,strip:!0,messages:{empty:f("Please enter your first name")}}]),n.validate(t,e)):void 0},e}(c),h("NameValidator",_),a=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.messages={empty:f("Please enter an email address"),noAt:f("An email address must contain a single @"),badUsername:f("The username portion of the email address is invalid (the portion before the @: %(username)s)"),badDomain:f("The domain portion of the email address is invalid (the portion after the @: %(domain)s)")},n.username_re=/^[\w!#$%&'*+\-\/=?^`{|}~.]+$/,n.domain_re=new RegExp("^([a-z0-9][a-z0-9\\-]*\\.)+([a-z]+|xn--[a-z0-9\\-]+)$","i"),n.prototype.validate=function(e){var o,i,s;if(e=t.trim(e),!e)throw new Error(this.messages.empty);if(i=e.split("@"),2!==i.length)throw new Error(this.messages.noAt);if(s=i[0],o=i[1],!n.username_re.test(s))throw new Error(this.messages.badUsername.format({username:s}));if(r.test(o)&&!n.domain_re.test(o))throw new Error(this.messages.badDomain.format({domain:o}))},n}(c),h("EmailValidator",a),l=function(t){return function(e,n){var o;o=!0;try{t.validate(e,n)}catch(r){o=!1}return o}},p={create:d,register:h,check:l}}),define("modules/clean/video_util",["jquery","modules/core/browser","modules/core/i18n","external/flash_detect","external/videojs/video","external/videojs/videojs_hls","modules/clean/ajax"],function(t,e,n,o,r,i,s){var a,_,u;return _=n._,a={_video_counter:0,embed:function(n,o){var r,i,a,c,l,d,h,p,f,m,g,v;if(null==o&&(o={}),!this.can_embed_type(o.type))return null!=o.onError&&setTimeout(function(){return o.onError("needflash")},0),document.createElement("div");for(o.preload="undefined"!=typeof o.preload?o.preload:!0,o.preload&&(o.preload="auto"),i="video-"+this._video_counter,this._video_counter+=1,p=t("<video/>",{"class":"video-js vjs-default-skin vjs-big-play-centered",id:i,controls:o.controls}),p=p[0],g=-1,v=["width","height","preload","poster","autoplay"],f=0,m=v.length;m>f;f++)c=v[f],o[c]&&p.setAttribute(c,o[c]);return l=t("<source/>",{src:o.src,type:o.type}),l=l[0],p.appendChild(l),n=t(n),n.empty(),n=n[0],n.appendChild(p),a=function(){var n,r,i,a;return i=this,o.onError&&i.on("error",o.onError),"function"==typeof o.onReady&&o.onReady(),a=function(){return null!=i.hls?i.hls.fillBuffer():void 0},e&&(e.ipad&&(n=0,t(document).on("dropdownOpened modalOpened",function(e,o){return n+=o,t(i.el_).children("video").removeAttr("controls")}),t(document).on("dropdownClosed modalClosed",function(e,o){return n-=o,0===n?t(i.el_).children("video").attr("controls","controls"):void 0})),e.msie&&"9.0"===e.version&&i.on("playing",function(){return i.removeClass("vjs-seeking")})),"Hls"===i.techName&&i.on("seeked",function(){return i.controlBar.currentTimeDisplay.updateContent()}),i.on("pause",function(){return g=setInterval(a,500),i.ended()?i.removeClass("vjs-has-started"):void 0}),i.on("play",function(){return clearInterval(g),g=-1}),i.on("dispose",function(){return clearInterval(g)}),i.on("ended",function(){return i.src({type:o.type,src:o.src})}),"application/vnd.apple.mpegurl"===o.type&&u(i),r=function(){return i.addClass("show-truncated-bar")},!o.metadata&&o.metadata_link?s.AuthenticatedRequest({url:o.metadata_link,type:"GET",data:{},xhrFields:{withCredentials:!0},success:function(t){return"function"==typeof o.metadata_cb&&o.metadata_cb(t),
t=JSON.parse(t),t.is_truncated?r.defer():void 0}}):o.metadata&&o.metadata.is_truncated?r.defer():void 0},h=_("The clip displayed here is a preview. To view the entire video, download or add it to your Dropbox."),Constants.transcoder_hls4web&&(videojs.Hls.GOAL_BUFFER_LENGTH=120),videojs.TruncatedBar=videojs.Component.extend(),videojs.TruncatedBar.prototype.options_={loadEvent:"play",components:{}},videojs.TruncatedBar.prototype.createEl=function(){var t;return t=videojs.createEl("div",{className:"truncated-bar",id:"truncated-video-message-bar"}),t.textContent=h,t},videojs.options.children.TruncatedBar={},r={swf:Constants.static_url_video_js_swf,flashVars:{contentType:o.type,hlsDebugLevel:Constants.hls_debug_level}},d=Constants.transcoder_hls4web?["html5","hls","flash"]:["flash"],videojs(p,{flash:r,techOrder:d},a)},can_embed_type:function(t){var e;return""!==("function"==typeof(e=document.createElement("video")).canPlayType?e.canPlayType(t):void 0)?!0:FlashDetect.installed&&FlashDetect.majorAtLeast(10)?"application/vnd.apple.mpegurl"===t||"video/flv"===t||"video/mp4"===t:!1}},u=function(t){var e,n,o,r,i,a,_,u,c,l,d,h,p,f,m,g,v,b,y,w,E,x,S,A,k,C,O,T,L,R,N,P,I;for(c=[250,500,1500],r=null,u=null,_=null,g=0,i=-1,o=!1,a=null,n=-1,h=[],v=!0,y=0,e={},E=0,x=c.length;x>E;E++)p=c[E],e[p.toString()]=0;return b=null,w=[],d=100,f=function(){var n,o,r,_,u;for(n={},_=0,u=c.length;u>_;_++)p=c[_],r=e[p.toString()],n[p.toString()]=Math.round(r/y*100)||0;return o={duration:Math.round(1e3*t.duration()),initial_bitrate:c[i]||0,initial_play_wait:a||0,bitrate_percentages:JSON.stringify(n),stalls:g,quality_events:JSON.stringify(h),xhr_errors:JSON.stringify(w),percentage_watched:d},m(),s.AuthenticatedRequest({url:"/video_web_play_log",type:"POST",data:o})},m=function(){var t,s;for(r=null,u=null,_=null,g=0,i=-1,o=!1,a=null,n=-1,h=[],v=!0,y=0,e={},t=0,s=c.length;s>t;t++)p=c[t],e[p.toString()]=0;return b=null,w=[],d=100},A=function(){return P(),f()},R=function(){return P(),d=Math.round(t.currentTime()/t.duration()*100),isFinite(d)||(d=0),f()},I=function(){return v?(b=Date.now(),v=!1):void 0},P=function(){var t;if(!v)return t=Date.now()-b,y+=t,e[c[n].toString()]+=t,v=!0},C=function(){return null===r&&(_=r=Date.now()),u=Date.now()},S=function(){var e;return e=t.hls.selectPlaylist().attributes.BANDWIDTH/1e3,n=c.indexOf(e),i=n,I(),o?void 0:(a=Date.now()-r,o=!0)},k=function(){return P()},L=function(){return u=Date.now()},N=function(){return P(),Date.now()-u>5e3?g+=1:void 0},T=function(e){var o;if(!t.paused())return P(),o=n,n=e.data.level,Date.now()-r<1e3?i=n:h.push([c[o],c[n],Date.now()-_]),_=Date.now(),I()},O=function(){var e,o;if(!(t.ended()||t.error()||t.paused()))return P(),e=t.hls.selectPlaylist().attributes.BANDWIDTH/1e3,n=c.indexOf(e),o=n,Date.now()-r<1e3?i=n:h.push([c[o],c[n],Date.now()-_]),_=Date.now(),I()},t.on("play",C),t.on("pause",k),t.on("canplay",S),t.on("waiting",N),t.on("seeking",L),t.on("ended",A),t.on("shutdown",R),t.on("mediachange",O),"Hls"===t.techName?(l=videojs.Hls.xhr,videojs.Hls.xhr=function(t,e){var n;return n=function(t,n){var o;return t&&(o="",(""===this.responseType||"text"===this.responseType)&&(o=this.responseText),w.push([this.status.toString(),o,n])),e.call(this,t,n)},l.call(this,t,n)}):void 0},a});var __hasProp={}.hasOwnProperty;define("modules/clean/viewer",["modules/core/exception","modules/core/i18n","modules/clean/user"],function(t,e,n){var o,r,i;return r=t.assert,i=e._,o=function(){function t(t){var e,o,r,i,s,a;for(null==t&&(t={}),this._authed_users={},this._all_users={},r=t._user_data||[],s=0,a=r.length;a>s;s++)i=r[s],o=new n(i),this._all_users[o.id]=o,i._authed&&(this._authed_users[o.id]=o);for(e in t)__hasProp.call(t,e)&&"string"==typeof e&&"_"!==e[0]&&(this[e]=t[e]);this.is_signed_in=r.length>0,this.is_paired=r.length>1,this.deprecated_first_user_in_the_cookie_id&&(this.deprecated_first_user_in_the_cookie=this.get_user_by_id(this.deprecated_first_user_in_the_cookie_id),delete this.deprecated_first_user_in_the_cookie_id),this._load_cached_users()}return t._cached_viewer=null,t.get_viewer=function(){var e;return this._cached_viewer||(e=null,"undefined"!=typeof Constants&&null!==Constants&&(e=Constants._viewer_properties),this._cached_viewer=new t(e)),this._cached_viewer},t.get_role_title=function(t){var e;return e=this.get_viewer(),e.is_paired?t.role===("undefined"!=typeof Constants&&null!==Constants?Constants.ROLE_PERSONAL:void 0)?i("Personal"):e.team_name:""},t.get_root_name=function(t){return this.get_role_title(t)||i("Dropbox")},t.prototype.get_user_by_role=function(t,e){var n;return n=this.get_uid_by_role(t),void 0===n?void 0:this.get_user_by_id(n,e)},t.prototype.role_exists=function(t){return void 0!==this.get_uid_by_role(t)},t.prototype.get_user_by_id=function(t,e){var n,o;return r(this.is_uid_associated(t),"User "+t+" is not associated with this viewer"),o=e?this._all_users:this._authed_users,n=o[t],r(n,"User "+t+" is not signed in"),n},t.prototype.is_role_signed_in=function(t){return this.get_uid_by_role(t)in this._authed_users},t.prototype.is_uid_signed_in=function(t){return t in this._authed_users},t.prototype.is_user_signed_in=function(t){return!(!t||!this.is_uid_signed_in(t.id))},t.prototype.is_uid_associated=function(t){return t in this._all_users},t.prototype.get_users=function(t){var e,n,o,r;return o=t?this._all_users:this._authed_users,r=function(){var t;t=[];for(e in o)n=o[e],t.push(n);return t}(),r.sort(function(t){return t.role===Constants.ROLE_PERSONAL?-1:1}),r},t.prototype.get_user_ids=function(t){var e;return function(){var n,o,r,i;for(r=this.get_users(t),i=[],n=0,o=r.length;o>n;n++)e=r[n],i.push(e.id);return i}.call(this)},t.prototype.get_email_by_role=function(t){var e;return e=this.get_user_by_role(t,!0),e&&e.email},t.prototype.get_uid_by_role=function(t){var e,n,o;t===Constants.ROLE_PHOTOS&&(t=this._get_photos_role()),o=this._all_users;for(e in o)if(n=o[e],n.role===t)return e;return void 0},t.prototype._get_photos_role=function(){return this.is_paired||!this.is_signed_in?Constants.ROLE_PERSONAL:this._values(this._all_users)[0].role},t.prototype._sign_in_all_users=function(){return this._authed_users=this._shallow_clone(this._all_users),this._load_cached_users()},t.prototype._sign_out_user_by_id=function(t){return delete this._authed_users[t],this._load_cached_users()},t.prototype.sign_in_user_by_id=function(t){return r(this.is_uid_associated(t),"User "+t+" is not associated with this viewer"),this._authed_users[t]=this._all_users[t],this._load_cached_users()},t.prototype._values=function(t){var e,n;n=[];for(e in t)n.push(t[e]);return n},t.prototype._shallow_clone=function(t){var e,n;n={};for(e in t)n[e]=t[e];return n},t.prototype._load_cached_users=function(){return this.personal_user=this._authed_users[this.get_uid_by_role(Constants.ROLE_PERSONAL)],this.photos_user=this._authed_users[this.get_uid_by_role(Constants.ROLE_PHOTOS)],this.work_user=this._authed_users[this.get_uid_by_role(Constants.ROLE_WORK)],this.personal_email=this.get_email_by_role(Constants.ROLE_PERSONAL),this.work_email=this.get_email_by_role(Constants.ROLE_WORK),this.is_personal_user_signed_in=this.is_role_signed_in(Constants.ROLE_PERSONAL),this.is_photos_user_signed_in=this.is_role_signed_in(Constants.ROLE_PHOTOS),this.is_work_user_signed_in=this.is_role_signed_in(Constants.ROLE_WORK)},t}()}),define("modules/clean/web_timing_logger",["modules/clean/ajax","modules/clean/event_load"],function(t,e){var n;return n={init:function(t){return this.source_type=null!=t?t:"web",window.performance?e.window_load(function(){return setTimeout(n._log_navigation,0)}):void 0},_log_navigation:function(){var t,e,o;return o=window.performance&&window.performance.timing,o&&(e=o.navigationStart||o.fetchStart)?(t={},Constants.GSLB_ENABLED&&(t.gslb_enabled=!0),Constants.IS_SPDY&&(t.is_spdy=!0),n._log({navigation_type:n._get_navigation_type(),server_request_start_time:Constants.REQUEST_START_TIME,redirect_time:o.fetchStart-e,dns_time:o.domainLookupEnd-e,tcp_connect_time:(o.secureConnectionStart||o.requestStart)-e,ssl_connect_time:o.requestStart-e,time_to_first_byte:o.responseStart-e,dom_load_time:o.domContentLoadedEventEnd-e,page_load_time:(o.loadEventEnd||o.domContentLoadedEventEnd)-e,extra_columns:JSON.stringify(t)})):void 0},log_ajax_transition:function(t,e,o,r,i,s){var a;return a={navigation_type:"ajax",page_load_time:t,url:s},null!=i&&(a.server_response_time=i),Constants.GSLB_ENABLED&&(o=o||{},o.gslb_enabled=!0),null!=o&&(a.extra_columns=JSON.stringify(o)),null!=r&&(a.stopwatch_suffix=r),n._log(a,e)},_log:function(e,n,o){return null==o&&(o="/web_timing_log"),e.url=e.url||window.location.href,e.request_id=Constants.REQUEST_ID,e.source_type=this.source_type,e.request_tracing_enabled=Constants.REQUEST_TRACING_ENABLED,n&&(e.url_info=n),t.AuthenticatedRequest({url:o,type:"POST",data:e})},_get_navigation_type:function(){switch(window.performance.navigation.type){case 0:return"navigate";case 1:return"reload";case 2:return"back_forward"}}}});var __indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};define("modules/core/browser",["modules/core/exception","modules/core/uri"],function(t,e){var n,o,r,i,s;return o=t.assert,s=function(t){var e;return t=t.toLowerCase(),e=/(ipad)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||/(trident).*? rv:([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],{browser:e[1]||"",version:e[2]||"0"}},r=s(navigator.userAgent),"trident"===r.browser&&(r.browser="msie"),i="undefined"!=typeof Constants&&null!==Constants?[Constants.WEBSERVER,Constants.BLOCK_CLUSTER,Constants.CAROUSEL_WEBSERVER]:[],n={version:r.version,msie_version_at_most:function(t){return n.msie&&parseInt(n.version,10)<=t},get_uri:function(t){return null==t&&(t=window),e.parse(this.get_href(t))},get_href:function(t){return null==t&&(t=window),t.location.href},_parse_target:function(t,n){var r,s,a,_,u,c;return null==n&&(n=window),a=n.document.createElement("a"),a.href=t,u=":"===a.protocol?n.location.protocol:a.protocol||n.location.protocol,r=a.hostname||n.location.hostname,_=0===a.pathname.indexOf("/")?a.pathname:"/"+a.pathname,t=u+"//"+r+_+a.search+a.hash,s=e.parse(String(t)),o((c=s.authority,__indexOf.call(i,c)>=0&&"https"===s.scheme),"Target URI must be secure and in domain whitelist"),s},redirect:function(t,e){var n;return null==e&&(e=window),n=this._parse_target(t,e),e.location.href=n.toString()},replace_location:function(t){var e;return e=this._parse_target(t),window.location.replace(e.toString())},reload:function(){return window.location.reload()},unsafeRedirect:function(t){return window.location.href=t}},n[r.browser]=!0,n.ipad?(n.webkit=!0,n.safari=!0):n.chrome?n.webkit=!0:n.webkit&&(n.safari=!0),n}),define("modules/core/controller_registry",["jquery","modules/core/exception","modules/core/instantiate"],function(t,e,n){var o,r,i,s;return r=e.assert,s=n.construct,i=function(e,n,o){var r,i,a,_;for(r=[e].concat(o),a=0,_=e.length;_>a;a++)i=e[a],t(i).data("jscontroller",s(n,r));return e},o=function(){function e(){}return e.controllers={},e.register_controller=function(t,e,n){return this.controllers[t]={constructor:e,args:n},this.find_and_bind_controller(t)},e.bind_controller=function(t){var e,n;return e=t.data("js-component-id"),r(this.controllers[e],"No controller for "+e),n=this.controllers[e],i(t,n.constructor,n.args)},e.find_and_bind_controller=function(e){var n,o;return r(this.controllers[e],"No controller for "+e),o=this.controllers[e],n=t("[data-js-component-id='"+e+"']"),i(n,o.constructor,o.args)},e}()}),define("modules/core/cookies",[],function(){var t;return t={create:function(t,e,n){var o,r;return r="",n&&(o=new Date,o.setTime(o.getTime()+24*n*60*60*1e3),r="; expires="+o.toGMTString()),document.cookie=""+t+"="+e+r+"; path=/"},read:function(t){var e,n,o,r,i;for(n=""+t+"=",i=document.cookie.split(";"),o=0,r=i.length;r>o;o++){for(e=i[o];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(n))return e.substring(n.length,e.length)}return null},"delete":function(t){return this.create(t,"",-1)},are_enabled:function(){return null!=navigator.cookieEnabled?navigator.cookieEnabled:(document.cookie="this_is_a_test_cookie",-1!==document.cookie.indexOf("this_is_a_test_cookie"))}}}),define("modules/core/dom",["jquery","modules/core/controller_registry","modules/core/exception"],function(t,e,n){var o,r,i,s,a,_,u,c,l,d,h,p,f,m,g,v,b,y,w,E,x,S,A;return o=n.assert,r=function(n){var o,i,s,_;for(_=n.children(),i=0,s=_.length;s>i;i++)o=_[i],r(t(o));return!a(n)&&n.data("js-component-id")?e.bind_controller(n):void 0},i=function(t){var e;return o(t,"Trying to clone nonexistent element"),e=t.clone(),r(e),e},a=function(t){return t.data("jscontroller")},v=function(t,e){return t.data("jscontroller",e)},l=function(t){return t?1===t.nodeType?!0:t.length>=1&&1===t[0].nodeType?!0:!1:!1},c=function(){var t,e,n,o,r;return("INPUT"===(t=null!=(e=document.activeElement)?e.tagName:void 0)||"TEXTAREA"===t||"SELECT"===t)&&"submit"!==(n=null!=(o=document.activeElement)?o.type:void 0)&&"button"!==n||(null!=(r=document.activeElement)?r.getAttribute("contentEditable"):void 0)},y=function(e){var n,o,r;return n=t(e),r=n.offset(),o=t(window),{left:r.left-o.scrollLeft(),top:r.top-o.scrollTop()}},E=null,S=null,b=function(){return E||(E={height:t(window).height(),width:t(window).width()}),S||(S=t(window).on("resize",function(){return E=null})),E},_=function(){return Math.max(t(document).height(),t(window).height(),document.documentElement.clientHeight)},A=null,w=null,f=function(){var e,n,o;return A||(A=t(window).scroll(function(){return w=null})),x()?w||(o=t(window).scrollTop(),n=t(window).scrollLeft(),w={0:n,1:o,left:n,top:o}):(e=t(document.documentElement),o=-1*parseInt(e.css("top"),10),n=-1*parseInt(e.css("left"),10),w={0:n,1:o,left:n,top:o}),w},d=function(){return w=null},x=function(){return!t(document.documentElement).hasClass("no-scroll")},p=0,h=function(){var e,n,o,r;return p++,e=t(document.documentElement),e.hasClass("no-scroll")?void 0:(r=f(),o=-1*r.top+"px",n=-1*r.left+"px",e.css({top:o,left:n}),e.addClass("no-scroll"))},g=function(){var e,n,o;return p>0&&p--,e=t(document.documentElement),0===p&&e.hasClass("no-scroll")?(o=-1*parseInt(e.css("top"),10),n=-1*parseInt(e.css("left"),10),e.css({top:"",left:""}),e.removeClass("no-scroll"),m(n,o+1),m(n,o-1),m(n,o)):void 0},m=function(t,e){return t=Math.max(t,0),e=Math.max(e,0),e>f().top&&(e=Math.min(e,_()-u.viewport_dimensions().height)),window.scrollTo(t,e),w={0:t,1:e,left:t,top:e}},s=function(e,n,o){var r,i,s,a,_,u,c,l;return i=t(n),s=t(e),u={setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},o=t.extend({},u,o),l=y(i),c={top:0,left:0},r=null,"absolute"===s.css("position")&&(r=s.offsetParent(),c=y(r)),r&&r[0]===document.body&&(c.left-=document.body.offsetLeft,c.top-=document.body.offsetTop),o.setLeft&&(a=l.left-c.left+o.offsetLeft+"px",s.css("left",a)),o.setTop&&(_=l.top-c.top+o.offsetTop+"px",s.css("top",_)),o.setWidth&&s.width(i[0].offsetWidth),o.setHeight&&s.height(i[0].offsetHeight),s},y=function(e){var n,o,r;return n=t(e),r=n.offset(),o=t(window),{left:r.left-o.scrollLeft(),top:r.top-o.scrollTop()}},u={bind_controllers:r,clone:i,clone_position:s,controller:a,focus_in_input:c,scroll_clear_cache:d,scroll_lock_document:h,scroll_offsets:f,scroll_to:m,scroll_unlock_document:g,set_controller:v,is_element:l,viewport_offset:y,viewport_dimensions:b}}),define("modules/core/exception",[],function(){var t;return t=function(){function t(){}return t.strip_comments=function(t){return t.replace(/\/\/.*/g,"").replace(/\/\*[\s\S]*?\*\//g,"")},t.fn_body=function(e){var n;return n=t.strip_comments(e.toString()),n=n.replace(/[\s]+/g," "),"("===n[0]&&(n=n.substr(1)),")"===n[n.length-1]&&(n=n.substr(0,n.length-1)),n=n.replace("function (","function(")},t.stackTrace=function(){var e,n,o,r,i;for(r=[],i={},e=arguments.callee.caller;e;){if(e.__tb_ajax_info__){r.unshift("Ajax.DBRequest: "+e.__tb_ajax_info__);break}if(e.__tb__){r=e.__tb__.concat(r);break}if(o=t.fn_body(e),o in i)break;i[o]=!0,r.unshift(o);try{e=e.caller}catch(s){n=s,e=null;break}}return r},t.__callbacks=[],t.registerOnFailedAssert=function(t){return this.__callbacks.push(t)},t.reportException=function(e,n,o,r,i,s){var a,_,u,c;if(__CIRCULAR_DEPENDENCY__.active_user_loaded?__CIRCULAR_DEPENDENCY__.an_error_happened_after_loading=!0:__CIRCULAR_DEPENDENCY__.an_error_happened_before_loading=!0,!this.reported_exception||i){if(u="",!r)try{_=t.stackTrace(),_.pop(),_.pop(),r=_.join("\\n")}catch(l){}if(s||(s=[]),a={e:e,f:n||window.location.href,l:o||"",loc:window.location.href,ref:"undefined"!=typeof Constants&&null!==Constants?Constants.referrer:void 0,tb:r,trace:null!=(c=__CONDITIONAL_JS__.Trace)?c.get():void 0,tags:JSON.stringify(s)},"undefined"!=typeof jQuery&&null!==jQuery&&"function"==typeof jQuery.ajax&&jQuery.ajax({url:"/jse",type:"POST",data:a}),this.reported_exception=e,!("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)&&window.sessionStorage)return a.source="exception.coffee",window.sessionStorage.setItem("reported_exception",JSON.stringify(a))}},t.alert=function(e){return"undefined"!=typeof jQuery&&null!==jQuery&&"function"==typeof jQuery.ajax&&jQuery.ajax({url:"/tormod",type:"POST",data:{tor:""+e,mod:window.location.href,ssk:t.stackTrace().join("\n\n"),oog:document.documentElement.innerHTML}}),window.alertd(e)},t.alertd=function(t){return window.alertd(t)},t.assert=function(e,n,o,r,i,s){var a,_,u,c,l;if(null==o&&(o=!0),null==r&&(r=[]),null==i&&(i=!0),null==s&&(s=!("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)),!e){for(n="Assertion Error: "+n,s&&"undefined"!=typeof console&&null!==console&&"function"==typeof console.trace&&console.trace(),("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)||alertd(n),_=t.stackTrace(),_.pop(),t.reportException(n,window.location.href,"",_.join("\n"),o,r),l=t.__callbacks,u=0,c=l.length;c>u;u++)(a=l[u])(n,_);if(i)throw n}},t}(),window.alertd=window.alert,window.alert=t.alert,__CONDITIONAL_JS__.JSException=t,t}),define("modules/core/html",["jquery","external/underscore"],function(t,e){var n;return n=function(){function t(t){this._str_DONT_TOUCH=t}return t.prototype.toHTML=function(){return this._str_DONT_TOUCH},t.prototype.toString=function(){return"[object HTML]"},t}(),function(){var o,r,i,s;return n.tmpl=function(o,r){var i,s,a;return/[^\w:.-]/.test(o)||(o=document.getElementById(o).innerHTML),s=o.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/<%=(.*?)%>/g,"',__no_conflict_HTML__._raw_escape($1),'").split("<%").join("');").split("%>").join("p.push('"),a=new Function("__no_conflict_HTML__","__no_conflict_jQuery__","TEMPLATE_DATA","var p=[],print=function(){p.push.apply(p,arguments);}; window.MONKEY_CHECK_OFF = true; p.push('"+s+"'); window.MONKEY_CHECK_OFF = false; return new __no_conflict_HTML__(__no_conflict_jQuery__.trim(p.join('')));"),i=e.partial(a,n,t),r?i(r):i},o=/[^\w@\.\ \-\(\)\,\$~%#\[\]\{\}\!\^]/g,i=function(t){return"&#"+t.charCodeAt(0)+";"},r=function(t){return(""+t).replace(o,i)},n.escape=function(t){return t instanceof n?t:new n(r(t))},n._raw_escape=s=function(t){return t instanceof n?t.toHTML():"number"==typeof t?t:r(t)}}(),n});var __slice=[].slice;define("modules/core/i18n",["modules/core/kwargs","modules/core/exception","external/sha1"],function(t,e){var n,o,r,i,s,a,_,u,c,l,d,h,p;for(d=e.assert,i="abcdefghijklmnopqrstuvwxyz",s="âḃćḋèḟĝḫíĵǩĺṁńŏṗɋŕśṭůṿẘẋẏẓ",c="ABCDEFGHIJKLMNOPQRSTUVWXYZ",l="ḀḂḈḊḔḞḠḢḬĴḴĻḾŊÕṔɊŔṠṮŨṼẄẌŸƵ",n={},h=p=0;26>p;h=++p)n[i.charAt(h)]=s.charAt(h),n[c.charAt(h)]=l.charAt(h);return o=function(){function e(){}return e.messages={},e.emessages={},e.RAND=0,e.NUM_MISSED=0,e.add_i18n_message=function(t,e,n,o){return e=e.strip_tags().friendly_format(),n=n.strip_tags(),this.messages[e]=t,this.emessages[e]=n,o?(delete this.messages[o],delete this.emessages[o]):void 0},e.PLURAL_RULES={SINGULAR_1:function(t){return 1===t?0:1},SINGULAR_01:function(t){return 1>=t?0:1},SINGULAR_ALL:function(){return 0},RUSSIA_UKRAINE:function(t){return t%10===1&&t%100!==11?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2},POLAND:function(t){return 1===t?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2}},e.PLURAL_RULES_BY_LOCALE={en:e.PLURAL_RULES.SINGULAR_1,en_GB:e.PLURAL_RULES.SINGULAR_1,da_DK:e.PLURAL_RULES.SINGULAR_1,de:e.PLURAL_RULES.SINGULAR_1,es_ES:e.PLURAL_RULES.SINGULAR_1,es:e.PLURAL_RULES.SINGULAR_1,fr:e.PLURAL_RULES.SINGULAR_01,id:e.PLURAL_RULES.SINGULAR_ALL,it:e.PLURAL_RULES.SINGULAR_1,ja:e.PLURAL_RULES.SINGULAR_ALL,ko:e.PLURAL_RULES.SINGULAR_ALL,ms:e.PLURAL_RULES.SINGULAR_ALL,nb_NO:e.PLURAL_RULES.SINGULAR_1,nl_NL:e.PLURAL_RULES.SINGULAR_1,pl:e.PLURAL_RULES.POLAND,pt_BR:e.PLURAL_RULES.SINGULAR_01,ru:e.PLURAL_RULES.RUSSIA_UKRAINE,sv_SE:e.PLURAL_RULES.SINGULAR_1,th_TH:e.PLURAL_RULES.SINGULAR_ALL,tr:e.PLURAL_RULES.SINGULAR_ALL,uk_UA:e.PLURAL_RULES.RUSSIA_UKRAINE,xx_AC:e.PLURAL_RULES.SINGULAR_1,xx_LS:e.PLURAL_RULES.SINGULAR_1,xx_HA:e.PLURAL_RULES.SINGULAR_1,xx_RL:e.PLURAL_RULES.SINGULAR_1,xx_AE:e.PLURAL_RULES.SINGULAR_1,zh_CN:e.PLURAL_RULES.SINGULAR_ALL,zh_TW:e.PLURAL_RULES.SINGULAR_ALL},e.get_langpack=function(){return window.LANGPACK||(window.LANGPACK={}),window.LANGPACK},e._=function(){var n,o,i,s,a,_,u,c,l;return u=arguments[0],n=2<=arguments.length?__slice.call(arguments,1):[],l=t.apply(null,[[["project","web"],"comment"]].concat(__slice.call(n))),a=l.project,o=l.comment,("undefined"!=typeof Constants&&null!==Constants?Constants.USER_LOCALE:void 0)&&e.locale_is_fake(Constants.USER_LOCALE)?_=e.fake_translate(u,"undefined"!=typeof Constants&&null!==Constants?Constants.USER_LOCALE:void 0):(c=r.get_string_key(u,a,o),i=e.get_langpack(),s=i[c]||i[u],s?_=s instanceof String||"string"==typeof s?s:s[0]||u:(0===e.RAND&&"undefined"!=typeof Constants&&null!==Constants&&"en"!==Constants.USER_LOCALE&&(e.RAND=Math.floor(20*Math.random()+1)),1===e.RAND&&e.NUM_MISSED<4&&(e.NUM_MISSED+=1,"undefined"!=typeof jQuery&&null!==jQuery&&jQuery.ajax({url:"/missed_translation_log",type:"POST",data:{message:u,comment:o,project:a}})),_=u)),e.add_i18n_message(u,_,u),_},e.fake_translate=function(t,e){var o,r,i,s,a,_,u;if("xx_LS"===e&&(t+="SSSSSSSSSSSSSSSSSSSSSSSSS"),"xx_AC"!==e||/</.test(t)||(t=t.toUpperCase()),"xx_HA"===e&&(t="[javascript]"+t),"xx_RL"===e&&!/</.test(t)&&!/%/.test(t)){for(s=97,i=1488,a="",t=t.toLowerCase(),h=_=0,u=t.length;u>=0?u>_:_>u;h=u>=0?++_:--_)o=t.charCodeAt(h)-s,a+=o>=0&&26>o?String.fromCharCode(i+o):t[h];t=a}return"xx_AE"!==e||/</.test(t)||/%/.test(t)||(t=function(){var e,o,i,s;for(s=[],h=e=0,o=t.length;o>=0?o>e:e>o;h=o>=0?++e:--e)r=t.charAt(h),s.push(null!=(i=n[r])?i:r);return s}().join("")),t},e.locale_is_fake=function(t){return-1!==t.indexOf("xx_")},e.ungettext=function(){var n,o,i,s,a,_,u,c,l,h,p,f,m,g;if(f=arguments[0],c=arguments[1],u=arguments[2],n=4<=arguments.length?__slice.call(arguments,3):[],g=t.apply(null,[[["project","web"],"comment"]].concat(__slice.call(n))),h=g.project,o=g.comment,d(null!=u,"missing number parameter for ungettext"),a="undefined"!=typeof Constants&&null!==Constants?Constants.USER_LOCALE:void 0)if(e.locale_is_fake(a))f=e.fake_translate(f,a),c=e.fake_translate(c,a);else if(m=r.get_string_key(f,h,o),s=e.get_langpack(),_=s[m]||s[f]){if(_ instanceof String||"string"==typeof _)return _;l=e.PLURAL_RULES_BY_LOCALE[a](u),l in _&&(p=_[l])}return i=1===u?f:c,null==p&&(p=i),e.add_i18n_message(f,p,i),p},e.N_=function(){var e,n,o,r,i;return r=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],i=t.apply(null,[[["project","web"],"comment"]].concat(__slice.call(e))),o=i.project,n=i.comment,new a(r,o,n)},e.E_=function(t){return e._(t.msg,t.project,t.comment)},e.render_sentences=function(t){var n,o,r,i,s,a;if(n=t.length,1===n)return t[0];if(2===n)return e._("%s %s",{comment:"Two sentences"}).format(t);if(3===n)return e._("%s %s %s",{comment:"Three sentences"}).format(t);if(4===n)return e._("%s %s %s %s",{comment:"Four sentences"}).format(t);for(o="",i=0,s=0,a=t.length;a>s;s++)r=t[s],o+=r,i!==n-1&&(o+=e._(" ",{comment:"Sentence separator character"})),i+=1;return o},e.i18n_default_project=function(n){return{_:function(){var o,r,i,s;return i=arguments[0],o=2<=arguments.length?__slice.call(arguments,1):[],s=t.apply(null,[[["project",n],"comment"]].concat(__slice.call(o))),n=s.project,r=s.comment,e._(i,n,r)},ungettext:function(){var o,r,i,s,a,_;return a=arguments[0],s=arguments[1],i=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],_=t.apply(null,[[["project",n],"comment"]].concat(__slice.call(o))),n=_.project,r=_.comment,e.ungettext(a,s,i,n,r)},N_:function(){var o,r,i,s;return i=arguments[0],o=2<=arguments.length?__slice.call(arguments,1):[],s=t.apply(null,[[["project",n],"comment"]].concat(__slice.call(o))),n=s.project,r=s.comment,e.N_(i,n,r)},E_:e.E_}},e}(),a=function(){function t(t,e,n){this.msg=t,this.project=e,this.comment=n}return t}(),r=function(){function t(){}return t.get_message_context=function(t,e){var n,o,r;return o=void 0,"web"!==t&&(o="project:"+t),null!=e&&(r=new jsSHA(e,"TEXT"),n=r.getHash("SHA-1","HEX"),null!=o?o+=" "+n:o=n),o},t.CONTEXT_DELIMITER="",t.get_string_key=function(e,n,o){var r;return r=t.get_message_context(n,o),null!=r?r+t.CONTEXT_DELIMITER+e:e},t}(),u=function(t){return"undefined"==typeof Array.isArray?"[object Array]"===Object.prototype.toString.call(t):Array.isArray(t)},_=function(){var t,e,n;return t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift(),function(){return e.apply(n,t.concat(Array.prototype.slice.call(arguments)))}},String.prototype.format_sub=function(t){return this.replace(/%(\([a-zA-Z0-9_\-]+\))?(.\d+)?(.)/g,_(t,this))},String.prototype.format=function(){var t,e,n,r,i,s;return 0===arguments.length?this.toString():(e=void 0,t=0,e=1===arguments.length&&arguments[0]instanceof Object?arguments[0]:Array.prototype.slice.call(arguments,0),i=function(n,o,r,i){var s,a,_,c;if(o?(o=o.slice(1,-1),d(0>=t,"Cannot mix named and positional indices in string formatting for string '"+this+"'."),t=-1,s="xx_AC"===("undefined"!=typeof Constants&&null!==Constants?Constants.USER_LOCALE:void 0),d(o in e||s&&o.toLowerCase()in e,"Key '"+o+"' not present during string substitution for string '"+this+"'"),c=e[o],s&&(c=e[o.toLowerCase()])):(u(e)||(e=[e]),d(t>-1,"Cannot mix named and positional indices in string formatting for string '"+this+"'."),d(t<e.length,"Insufficient number of items in format for string '"+this+"'"),c=e[t],t++),d("undefined"!=typeof c,"value for key '"+(o||"")+"' is undefined"),_=void 0,"s"===i||"S"===i)_=c.toString();else if("d"===i||"D"===i)_=parseInt(c,10).toString();else if("f"===i||"F"===i)_=Number(c).toString();else{if("%"===i)return"%";d(!1,"Unexpected format character '"+i+"' for string '"+this+"'.")}return r?(r=parseInt(r.slice(1),10),"f"===i||"F"===i?(_.indexOf(!1)&&(_+=".0"),a=_.split("."),a[0]+"."+a[1].slice(0,r)):_.slice(0,r)):_},s=this.format_sub(i),o.messages&&this in o.messages&&(t=0,r=o.emessages[this],n=String.prototype.format_sub.call(r,i),o.add_i18n_message(r,s,n,this)),s)},String.prototype.friendly_format=function(){var t,e,n;return e=function(e,o,r,i){return o?"["+o.slice(1,1).replace("-","_")+"]":"s"===i||"S"===i?"[word"+n++ +"]":"[number"+t++ +"]"},t=1,n=1,this.format_sub(e)},String.prototype.blank_format=function(){var t;return t=function(){return""},this.format_sub(t)},String.prototype.strip_tags=function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},o}),define("modules/core/instantiate",["modules/core/exception"],function(t){var e,n,o;return e=t.assert,n=function(t,n){var o;return e(t),o=function(){return t.apply(this,n)},o.prototype=t.prototype,new o},o={construct:n}});var __slice=[].slice;define("modules/core/kwargs",[],function(){var t;return t=function(){var t,e,n,o,r,i,s,a,_,u,c;if(i=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],r={},i=function(){var t,e,n;for(n=[],t=0,e=i.length;e>t;t++)s=i[t],n.push("string"==typeof s?{name:s,"default":void 0}:{name:s[0],"default":s[1]});return n}(),(e=function(){var e,n,o,r,s,a,_,u;if(null==t||"object"!=typeof t[t.length-1])return!1;for(o={},e=s=a=t.length-1,_=i.length-1;_>=s;e=s+=1)o[i[e].name]=!0;u=t[t.length-1];for(n in u)if(r=u[n],!(n in o))return!1;return!0})()){u=t[t.length-1];for(o in u)a=u[o],r[o]=a;t.pop()}for(n=_=0,c=i.length-1;c>=_;n=_+=1)n<t.length?r[i[n].name]=t[n]:i[n].name in r||(r[i[n].name]=i[n]["default"]);return r}}),define("modules/core/notify",["jquery","modules/core/i18n"],function(t,e){var n,o;return o=e._,n=function(){function e(){}return e.DEFAULT_ERROR=o("There was a problem completing this request."),e.DEFAULT_SUCCESS=o("Your request completed successfully."),e.success=function(t,e){return null==e&&(e=10),t=t||this.DEFAULT_SUCCESS,this._show(t,e,"server-success"),this.current()},e.error=function(t,e){return null==e&&(e=10),t=t||this.DEFAULT_ERROR,this._show(t,e,"server-error"),this.current()},e.warning=function(t,e){return null==e&&(e=10),this._show(t,e,"server-warning"),this.current()},e.info=function(t,e){return null==e&&(e=10),this._show(t,e,"server-info"),this.current()},e.clear=function(){return this._last_timeout&&clearTimeout(this._last_timeout),this._last_animation&&this._last_animation.stop(),this._last_timeout=null,this._last_animation=null,t("#notify").removeClass("server-error server-info server-success server-warning").hide()},e.isShown=function(){return t("#notify").is(":visible")},e.current=function(){return this._last_timeout},e._show=function(t,e,n){return this._buildElement(),this.clear(),this._setMessage(t),this._showElement(n),this._scheduleHide(e),this.current()},e._buildElement=function(){var e;if(!t("#notify").length)return e='<div id="notify-wrapper"> <span id="notify"> <span id="notify-msg" /> </span> </div>',t("body").append(e)},e._setMessage=function(e){var n;return n=t("#notify-msg"),null!=e.toHTML?n.html(e.toHTML()):e instanceof t?n.html(e):n.text(e)},e._showElement=function(e){var n;return n=t("#notify"),n.addClass(e),this._last_animation=n.fadeIn(500)},e._scheduleHide=function(t){return this._last_timeout=setTimeout(this._hide,1e3*t)},e._hide=function(){var n;return n=t("#notify"),e._last_animation=n.fadeOut(1e3),e._last_timeout=null},e}(),INLINE_JS.Notify=n,n}),define("modules/core/ordered_dictionary",[],function(){var t;return t=function(){function t(t,e){this.list=t,this.dict=e}return t.list=[],t.dict={},t.prototype.push=function(t,e){this.list.push(t),this.dict[t]=e},t.prototype.remove=function(t){this.list.removeItem(t),delete this.dict[t]},t.prototype.indexOfKey=function(t){return this.list.indexOf(t)},t.prototype.keyAtIndex=function(t){return this.list[t]},t.prototype.valueFromKey=function(t){return this.dict[t]},t.prototype.valueAtIndex=function(t){return this.dict[this.list[t]]},t.prototype.getValues=function(){var t;return function(){var e,n,o,r;for(o=this.list,r=[],e=0,n=o.length;n>e;e++)t=o[e],r.push(this.dict[t]);return r}.call(this)},t.prototype.length=function(){return this.list.length},t.prototype.insertAtIndex=function(t,e,n){return this.list.splice(t,0,e),this.dict[e]=n},t}()}),define("modules/core/uri",["modules/core/exception"],function(t){var e,n,o;return o=t.assert,n=function(){function t(n,o){var r,i,s,a;if(!(this instanceof t))return new t(n,o);if(this._query=new e,s={},"string"==typeof n||n instanceof t){if(!("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0))throw new Error("URI/uri string passed into URI constructor.  Use URI.parse instead.");s=t.parse(n).toObject()}else"object"==typeof n&&(s=n);if(o&&!("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0))throw new Error("Multiple arguments passed into URI constructor.");i=o||{};for(r in i)a=i[r],s[r]=a;this.initFromObject(s)}return t.prototype.initFromObject=function(t){var e,n,o;return o=null!=t?t:{},
n=o.scheme,this.authority=o.authority,this.path=o.path,e=o.query,this.fragment=o.fragment,this.setScheme(n),this.setQuery(e)},t.parse=function(n){var r,i,s,a,_,u,c,l;return o(null!=n,"must pass in a valid url-encoded string"),r=String(n).match(t.REGEXP)||[],l=r[0],c=r[1],s=r[2],_=r[3],u=r[4],a=r[5],i=new t,i.setScheme(c),i.setAuthority(t.decode(s)),i.setPath(t.decode(_)),i.setQuery(e.parse_string(u)),i.setFragment(t.decode(a)),i},t.prototype.getScheme=function(){return this.scheme||""},t.prototype.setScheme=function(e){return o(!e||e.match(t.SCHEME_REGEXP,"Invalid scheme")),this.scheme=e,this},t.prototype.getAuthority=function(){return this.authority||""},t.prototype.setAuthority=function(t){return this.authority=t,this},t.prototype.getPath=function(){return this.path||""},t.prototype.setPath=function(t){return this.path=t,this},t.prototype.getFragment=function(){return this.fragment||""},t.prototype.setFragment=function(t){return this.fragment=t,this},t.prototype.getQuery=function(){return this._query.dict},t.prototype.setQuery=function(t){return null==t&&(t={}),this._query=new e(t),this},t.prototype.updateQuery=function(t,e){return null==e&&(e=null),this._query.add(t,e),this},t.prototype.removeQuery=function(t){return this._query.remove(t),this},t.prototype.clone=function(){return t(this.toObject())},t.prototype.toObject=function(){return{scheme:this.getScheme(),authority:this.getAuthority(),path:this.getPath(),query:this.getQuery(),fragment:this.getFragment()}},t.prototype.toString=function(){var e,n;return n="",this.scheme&&(n+=this.scheme+":"),this.authority&&(n+="//"+t.encode(this.authority,":@[]")),this.path&&(o(!this.authority||!this.path.length||"/"===this.path[0],'Path must start with a "/" if URI is not relative'),n+=t.encode(this.path,"/")),e=this._query.toString(),e&&(n+="?"+e),this.fragment&&(n+="#"+t.encode(this.fragment,":@[]/&=+?#!")),n},t.REGEXP=/^(?:([^:/\\?#]+):)?(?:[/\\]{2}([^/\\?#]*))?([^?#]*)(?:\?([^#]*))?(?:[#](.*))?$/,t.SCHEME_REGEXP=/^[a-zA-Z][a-zA-Z0-9+.\-]*$/,t.decode=function(t){return t?decodeURIComponent(t):""},t.encode=function(t,e){var n,o,r,i;if(null==e&&(e=""),!t)return"";for(t=encodeURIComponent(t),e+="~",r=0,i=e.length;i>r;r++)o=e[r],n=encodeURIComponent(o),t=t.replace(new RegExp(n,"g"),o);return t},t.encode_parts=function(e,n){var o;return null==n&&(n="/"),function(){var r,i,s,a;for(s=e.split(n),a=[],r=0,i=s.length;i>r;r++)o=s[r],a.push(t.encode(o));return a}().join(n)},t}(),e=function(){function t(t){this.dict={},this.add(t)}return t.parse_string=function(e){var n,o,r,i,s,a,_,u;if(!e)return null;for(r={},i=e.split("&"),_=0,u=i.length;u>_;_++)o=i[_],""!==o&&(s=o.split("="),n=t.decode(s[0]),a=t.decode(s.slice(1).join("=")),n in r?(Array.isArray(r[n])||(r[n]=[r[n]]),r[n].push(a)):r[n]=a);return r},t.prototype.add=function(t,e){var n,o,r,i;if(null==e&&(e=null),"string"==typeof t)null!=e&&(this.dict[t]=Array.isArray(e)?function(){var t,o,r;for(r=[],t=0,o=e.length;o>t;t++)n=e[t],r.push(String(n));return r}():String(e));else{r=t||{};for(o in r)i=r[o],null!=i&&(this.dict[o]=Array.isArray(i)?function(){var t,e,o;for(o=[],t=0,e=i.length;e>t;t++)n=i[t],o.push(String(n));return o}():String(i))}return this},t.prototype.remove=function(t){return delete this.dict[t]},t.prototype.replace=function(t){return this.dict=t||{},this},t.prototype.toString=function(){var e,n,o,r;n=[],r=this.dict;for(e in r)o=r[e],Array.isArray(o)?o.forEach(function(o){return n.push(t.encode(e)+"="+t.encode(o))}):n.push(t.encode(e)+"="+t.encode(o));return n.length?n.join("&"):""},t.decode=function(t){return null===t?"":n.decode(t.replace(/\+/g,"%20"))},t.encode=function(t){return null===t?"":n.encode(t).replace(/%20/g,"+")},t}(),INLINE_JS.URI=n,n}),define("modules/dirty/groups/api",["jquery","dropbox","modules/clean/ajax","modules/clean/contacts/cache","modules/clean/viewer"],function(t,e,n,o,r){var i,s,a;return i=o.DefaultContactsCache,a={},s="/groups_ajax",a.ready=function(){},a.get_groups_for_user=function(t,e){return null==t&&(t={}),null==e&&(e=function(){return{}}),a.metaserver_ajax({method:"get_groups_for_user",data:t,success:e})},a.get_group_info=function(t,e){return null==t&&(t={}),null==e&&(e=function(){return{}}),a.metaserver_ajax({method:"get_group_info",data:t,success:e})},a.get_groups_for_team=function(t,e){return null==t&&(t={}),null==e&&(e=function(){return{}}),a.metaserver_ajax({method:"get_groups_for_team",data:{},success:e})},a.get_users_for_group=function(t,e){return null==e&&(e=function(){return{}}),a.metaserver_ajax({method:"get_users_in_group",data:t,success:e})},a.create_group=function(t,e){return null==e&&(e=function(){return{}}),a.metaserver_ajax({method:"make_new_group",data:t,success:e,reload_contacts:!0})},a.create_group_with_users=function(t,e){return null==e&&(e=function(){return{}}),a.metaserver_ajax({method:"make_new_group_with_users",data:t,success:e,reload_contacts:!0})},a.remove_group=function(t,e){return null==e&&(e=function(){return{}}),a.metaserver_ajax({method:"remove_group",data:t,success:e,reload_contacts:!0})},a.rename_group=function(t,e,n){return null==n&&(n=function(){return{}}),a.metaserver_ajax({method:"rename_group",data:t,success:e,error:n,reload_contacts:!0})},a.add_users_to_group=function(t,e){return null==e&&(e=function(){return{}}),a.metaserver_ajax({method:"add_users_to_group",data:t,success:e,reload_contacts:!0})},a.remove_user_from_group=function(t,e){return null==e&&(e=function(){return{}}),a.metaserver_ajax({method:"remove_user_from_group",data:t,success:e,reload_contacts:!0})},a.change_group_member_type=function(t,e){return null==e&&(e=function(){return{}}),a.metaserver_ajax({method:"change_group_member_type",data:t,success:e})},a.remove_namespace_from_group=function(t,e){return a.metaserver_ajax({method:"remove_namespace_from_group",data:t,success:e})},a.change_group_access_type=function(t,e){var o;return o=function(t,n,o){return e(o)},n.WebRequest({url:s+"/change_group_access_type",type:"post",data:t,subject_user:r.get_viewer().work_user,success:o})},a.refresh_account_photos=function(){var t,e;t=JSON.stringify(i.cached_contacts.contacts.map(function(t){return t.email})),e=function(t){var e,n,o,r;for(r=i.cached_contacts.contacts,n=0,o=r.length;o>n;n++)e=r[n],e.photo_url=t[e.email]},a.metaserver_ajax({method:"get_account_photo_urls_for_emails",data:{emails:t},success:e})},a.metaserver_ajax=function(e){var o,a,_,u;return u=s+"/"+e.method,a=e.reload_contacts||!1,_=function(n){var o,r;o=JSON.parse(n),o.ok&&(e.success(o.data),t(".error_msg").hide()),a&&i.load_contacts(r=!0)},o=function(n){var o;o=n.responseText,e.error&&(e.error(o.slice(4)),t(".error_msg").hide())},n.WebRequest({url:u,type:"post",data:e.data,subject_user:r.get_viewer().work_user,success:_,error:o})},__CIRCULAR_DEPENDENCY__.GroupsApi=a,a});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/dirty/growth/shared_link_signup_modals",["dropbox","jquery","modules/clean/ajax","modules/core/browser","modules/core/i18n","modules/core/notify","modules/dirty/register_form","modules/clean/components/login_form","modules/clean/dbmodal"],function(t,e,n,o,r,i,s,a,_){var u,c,l,d;return l=t.SharingModel,d=r._,u=_.DBModal,c=function(){function t(t){this.show_default_modal=t,this.toggle_form=__bind(this.toggle_form,this),this.save_to_dropbox=__bind(this.save_to_dropbox,this),this.reload_and_direct_download=__bind(this.reload_and_direct_download,this),this.reload=__bind(this.reload,this),this.direct_download=__bind(this.direct_download,this),this.show_welcome_modal=__bind(this.show_welcome_modal,this),this.before_welcome_modal=__bind(this.before_welcome_modal,this),this.before_download_signup_modal=__bind(this.before_download_signup_modal,this),this.before_default_signup_modal=__bind(this.before_default_signup_modal,this),this.before_signup_modal=__bind(this.before_signup_modal,this),this.init_modals=__bind(this.init_modals,this),this.init_modals(),this.show_default_modal&&(this.default_signup_modal.show(),this.has_seen_modal=!0),e("#download_button_link, #default_content_download_button").click(function(t){return function(){return t.has_seen_modal?t.direct_download():(t.download_type="direct_download",t.download_signup_modal.show(),t.has_seen_modal=!0)}}(this)),e("#add_to_my_dropbox_link, #default_content_a2md").click(function(t){return function(){return t.download_type="add_to_dropbox",t.download_signup_modal.show()}}(this))}return t.prototype.init_modals=function(){return this.default_signup_modal=new u({element_id:"shared-link-default-signup-modal"}),this.default_signup_modal.before_show=this.before_default_signup_modal,this.download_signup_modal=new u({element_id:"shared-link-download-signup-modal"}),this.download_signup_modal.before_show=this.before_download_signup_modal,this.welcome_modal=new u({element_id:"shared-link-welcome-modal"}),this.welcome_modal.before_show=this.before_welcome_modal},t.prototype.before_signup_modal=function(t){var e,n;return t.find(".toggle-form-link").click(function(e){return function(){return e.toggle_form(t)}}(this)),n=t.find(".register-form"),n.length&&n.on(s.REGISTER_SUCCESS,function(t){return function(e,n){return t.user=n,i.success(d("Successfully signed up for Dropbox")),t.download_type?"direct_download"===t.download_type?(t.show_welcome_modal(),t.direct_download()):"add_to_dropbox"===t.download_type?t.save_to_dropbox():void 0:t.show_welcome_modal()}}(this)),e=t.find(".login-form"),e.length?e.on(a.LOGIN_SUCCESS,function(t){return function(e,n){return t.user=n,i.success(d("Successfully signed in to Dropbox")),t.download_type?"direct_download"===t.download_type?t.reload_and_direct_download():"add_to_dropbox"===t.download_type?t.save_to_dropbox():void 0:t.reload()}}(this)):void 0},t.prototype.before_default_signup_modal=function(t){return this.before_signup_modal(t)},t.prototype.before_download_signup_modal=function(t){return this.before_signup_modal(t),"direct_download"===this.download_type?(t.find(".add-to-dropbox-component").hide(),t.find(".direct-download-component").show()):"add_to_dropbox"===this.download_type&&(t.find(".direct-download-component").hide(),t.find(".add-to-dropbox-component").show(),t.find(".login-form-component").is(":visible")||this.toggle_form(t)),t.find(".close-link").click(function(t){return function(){return t.download_signup_modal.hide()}}(this))},t.prototype.before_welcome_modal=function(t){return t.find(".welcome-modal-no-thanks a").click(function(){return function(){return o.reload()}}(this))},t.prototype.show_welcome_modal=function(){return this.default_signup_modal.hide(),this.download_signup_modal.hide(),this.welcome_modal.show()},t.prototype.direct_download=function(){var t;return t=o.get_uri().updateQuery({dl:1}),o.redirect(t)},t.prototype.reload=function(){return o.reload()},t.prototype.reload_and_direct_download=function(){var t;return t=o.get_uri().updateQuery({force_dl:1}),o.redirect(t)},t.prototype.save_to_dropbox=function(){var t;return i.success(d("Saving to your Dropbox ...")),t=l.c2d_vars,t.job=l.is_folder,n.WebRequest({url:l.c2d_url,data:t,subject_user:this.user.id,success:function(){return function(t){return i.success(d("Successfully saved to your Dropbox.")),o.redirect(t)}}(this)})},t.prototype.toggle_form=function(t){var e,n;return n=t.find(".register-form-component"),e=t.find(".login-form-component"),n.is(":visible")?n.fadeOut({complete:function(){return e.show()}}):e.fadeOut({complete:function(){return n.show()}})},t}()}),define("modules/dirty/home",["jquery","dropbox","modules/clean/account/email","modules/clean/analytics","modules/clean/payments/pro_trial_onboarding_tour","modules/clean/teams/trial_buy_now","modules/clean/upsell/ha_loader","modules/clean/viewer","modules/dirty/sharing/sharing_growth_email_experiments"],function(t,e,n,o,r,i,s,a,_){var u,c,l,d,h,p,f;return u=e.Browse,c=e.ClientDownload,d=e.FileOps,f=e.SharingModals,l=n.EmailVerification,p=o.SharedFolderActivityLogger,h={init:function(e){var n,o,m,g;return s.init("home",u.active_user,e.force_campaign_id),e.show_email_just_verified?l.getForRole(e.role).show_verified_modal():e.show_email_just_verified_and_changed?l.getForRole(e.role).show_verified_and_changed_modal():e.show_sent_verification_email?l.getForRole(e.role).show_sent_modal():e.show_upload?(m=function(){var t;return e.email_src&&(t={ns_id:u.containing_ns_id(),email_src:e.email_src},p.log("web","show_upload_modal_for_sf_from_email",u.active_user,t),_.listen_for_first_upload(u.active_user,t)),d.show_upload.bind(d)()},h._call_when_browse_ready(m)):e.show_share_existing_modal?(e.email_src&&(o={email_src:e.email_src},p.log("web","show_share_existing_folder_modal_from_email",u.active_user,o)),f.show_share_existing_modal(e.fq_path,u.active_user)):e.show_share_options&&!e.share_subfolder?(g=a.get_viewer().get_user_by_role(e.role),g||(g=a.get_viewer().get_users()[0]),f.show_shared_folder_options_modal(e.fq_path,g)):e.show_share_options&&e.share_subfolder?(g=a.get_viewer().get_user_by_role(e.role),g||(g=a.get_viewer().get_users()[0]),f.show_shared_subfolder_modal(e.fq_path,g)):e.show_download_modal?(n=new c,n.show_download_modal()):e.show_pro_trial_modal?r.ProTrialOnboardingTour.show("trial_start"):e.remaining_trial_days?i.showModal(e.remaining_trial_days):e.show_upsell_modal?t("#db-modal-upsell-home-modal").addClass("show-upsell-modal").trigger("show-upsell-modal"):void 0},_call_when_browse_ready:function(t){var e;return u.first_load?(e=function(){return document.stopObserving(u.UPDATE_EVT,e),t()},document.observe(u.UPDATE_EVT,e)):t()}}}),define("modules/dirty/print",["dropbox"],function(t){var e;return e=t.NOTCLIENTS,{print:function(){var t,n,o;for(n in e)t=e[n],t.abort();window.print(),o=[];for(n in e)t=e[n],o.push(t.reconnect());return o}}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/dirty/register_form",["jquery","dropbox","external/underscore","modules/clean/ajax","modules/clean/em_string","modules/clean/mailcheck","modules/core/browser","modules/clean/components/ajax_form","modules/core/notify"],function(t,e,n,o,r,i,s,a,_){var u;return u=function(){function e(e,n,o,s){var _,u,c;this.$register_form_container=e,this.can_redirect=o,this.show_form=s,this._animate_form=__bind(this._animate_form,this),this._on_register_success=__bind(this._on_register_success,this),this._check_if_needs_captcha=__bind(this._check_if_needs_captcha,this),this._show_captcha=__bind(this._show_captcha,this),this._hide_captcha=__bind(this._hide_captcha,this),this.$register_form=this.$register_form_container.find(".register-form"),this.cont=this.$register_form.find("input[name='cont']").val(),this.$register_form.find(".login-button").attr("disabled",!1),_=this.$register_form.find("label[for='tos_agree']"),u=parseInt(_.css("font-size")),c=200,new r(_.text()).length*u>c&&this.$register_form.find(".checkbox").removeClass("checkbox-inline"),this.$register_form.on(a.SUCCESS_EVENT,this._on_register_success),this.$register_form.on(a.ERROR_EVENT,this._check_if_needs_captcha),this.show_form?(this.$register_form_container.filter(":input").filter(":visible").first().focus(),this._check_if_needs_captcha()):this.$register_form.find(".login-button").on("click",function(t){return function(e){return t.$register_form_container.hasClass("form_shown")?void 0:(e.preventDefault(),t._animate_form())}}(this)),"small"===n?(this.$register_form.find(".bubble-dropdown-container .bubble-dropdown").css({visibility:"hidden"}),this.$register_form.find(".password-input-meter").css({cursor:"default"})):new i(t(".input-email"),t(".email-suggestion"))}return e.REGISTER_SUCCESS="db:register:success",e.prototype._hide_captcha=function(){var t;return null!=(t=this.$register_form.find(".recaptcha-v2-challenge-container"))?t.hide():void 0},e.prototype._show_captcha=function(){var t,e,n,o;return t=this.$register_form.find(".recaptcha-v2-challenge-container"),e=null!=(n=this.$register_form.find("input[name='recaptcha_v2_public_key']"))?n.val():void 0,e&&!t.is(":visible")&&grecaptcha.render("recaptcha_v2_challenge",{sitekey:e}),t.is(":visible")?void 0:null!=(o=this.$register_form.find(".recaptcha-v2-challenge-container"))?o.show():void 0},e.prototype._check_if_needs_captcha=function(t,e){return o.WebRequest({url:"/ajax_needs_signup_captcha",data:{email:this.$register_form.find("input[name='email']").val()},success:function(n){return function(o){try{return e=JSON.parse(o),e.needs_signup_captcha?n._show_captcha():n._hide_captcha()}catch(r){return t=r,_.error(_.DEFAULT_ERROR)}}}(this)})},e.prototype._on_register_success=function(t,n){if(this.$register_form.trigger(e.REGISTER_SUCCESS,n),this.can_redirect){if(this.cont)return s.redirect(this.cont);if(n.redirect_url)return s.redirect(n.redirect_url)}},e.prototype._animate_form=function(){return this.$register_form_container.hasClass("form_shown")?void 0:t.when(this.$register_form_container.animate({height:this.$register_form.height()},{easing:"easeInOutCubic",duration:500})).done(function(t){return function(){return t.$register_form_container.addClass("form_shown"),t.$register_form_container.filter(":input").filter(":visible").first().focus(),t._check_if_needs_captcha()}}(this))},e.prototype.fill=function(t){return n.each(t,function(t){return function(e,n){return t.$register_form.find("[name="+n+"]").val(e)}}(this))},e}(),__CIRCULAR_DEPENDENCY__.RegisterForm=u,u}),define("modules/dirty/sharing/sf_access_type",["dropbox","jquery","modules/core/dom","modules/core/i18n","modules/core/notify","modules/clean/analytics","modules/clean/components/bubble_picker","modules/clean/dbmodal","modules/clean/dbmodal_loading","modules/clean/viewer","modules/dirty/groups/api"],function(t,e,n,o,r,i,s,a,_,u,c){var l,d,h,p,f,m,g;return h=t.MakeOwnerModal,m=t.SharingApi,g=o._,f=i.SharedFolderActivityLogger,l=a.DBModal,d=a.DBModalStack,p=function(){function t(t,e){this.$access_type_el=t,this.ajax_data=e,this.bubble_picker=n.controller(this.$access_type_el),this.$access_type_el.on(s.CHANGED,function(t){return function(e,n){var o,r,i,s,a,_;return i=n.old_val,r=n.clicked_val,i===r?!1:(t.ajax_data&&(_=u.get_viewer().get_user_by_id(t.ajax_data.user_id),s=t.ajax_data.params,o=t.ajax_data.access_types,a=t.$access_type_el.closest(".bs-row").find(".sf-display-name").text(),"owner"===o[r]?(t.show_make_owner_modal(_,s.member_uid,s.ns_id,a,r),t.bubble_picker.set_value(i)):t.update_access_type(_,s,a,r)),!1)}}(this))}return t.prototype.show_make_owner_modal=function(t,e,n,o,r){return d.push(new h(t,{element_id:"make-owner-confirm-modal",member_uid:e,member_name:o,ns_id:n,access_type:r}))},t.prototype.update_access_type=function(t,e,n,o){var i,s,a;return i={ns_id:e.ns_id,access_type:o},a=function(o){return function(s){var a,u,c;if(c=JSON.parse(s.responseText),i.member_id=e.member_uid,"OK"===c.status){switch(i.succes=!0,c.access_type){case"viewer":u=g("%(name)s can only view now.").format({name:n});break;case"editor":u=g("%(name)s can edit now.").format({name:n});break;case"owner":u=g("%(name)s is the owner now.").format({name:n})}u&&r.success(u)}else"ERROR"===c.status&&(i.succes=!1,c.msg&&(i.message=c.msg,r.error(c.msg)),c.reload&&(a=l.get_containing_modal(o.$access_type_el),a&&a instanceof _&&a.fetch()));return f.log("web","invite_modal_change_callback",t,i)}}(this),s=new m(t),e.member_uid?(s.update_member_access_type(e.ns_id,e.member_uid,o,a),i.member_uid=e.member_uid,f.log("web","invite_modal_change_collaborator",t,i)):e.invite_id?(s.update_invite_access_type(e.invite_id,o,a),i.invite_id=e.invite_id,f.log("web","invite_modal_change_invite",t,i)):e?(c.change_group_access_type({ns_id:e.ns_id,group_id:e.group_gid,access_type:o},a),i.group_id=e.group_gid,f.log("web","invite_modal_change_group",t,i)):void 0},t}()}),define("modules/dirty/sharing/sharing_growth_email_experiments",["dropbox","modules/clean/analytics"],function(t,e){var n,o,r;return r=t.Upload,n=e.SharedFolderActivityLogger,o=function(){function t(){}return t.listen_for_first_upload=function(t,e){var o;return o=function(){return function(){return n.log("web","file_upload",t,e),document.stopObserving(r.QUEUE_EVT,o),document.stopObserving(r.CHOOSE_FILE_BASIC,o)}}(this),document.observe(r.QUEUE_EVT,o),document.observe(r.CHOOSE_FILE_BASIC,o)},t}()}),define("modules/dirty/unity_browse_interface",["dropbox","jquery","modules/clean/unity_check_file_cache","modules/clean/unity_features"],function(t,e,n,o){var r,i;return r=t.Browse,null!=n&&null!=o?i=function(){function t(){}return t.BATCH_SIZE_LIMIT=100,t.CHECK_FILES_PADDING=50,t.listen=function(){return r.add_visible_change_callback(t.browse_visible_change_callback)},t.check_file_callback=function(t){return n.set_batch(t)},t.browse_visible_change_callback=function(e,n,r,i){var s,a,_,u,c,l;if(e.length&&(u=Math.max(0,r-t.CHECK_FILES_PADDING),c=Math.min(e.length-1,i+t.CHECK_FILES_PADDING),a=e.slice(u,+c+1||9e9),_=t._get_files_to_check(a),_.length)){for(t._remove_unneeded_items_from_cache(a),l=[];_.length;)s=_.splice(0,t.BATCH_SIZE_LIMIT),l.push(o.check_file_batch(s,n,t.check_file_callback));return l}},t._get_files_to_check=function(t){var e;return function(){var o,r,i;for(i=[],o=0,r=t.length;r>o;o++)e=t[o],e.bytes>=0&&n.get(e.ns_id,e.ns_path)!==!0&&i.push(e);return i}()},t._remove_unneeded_items_from_cache=function(t){var e,r,i,s;for(e={},i=0,s=t.length;s>i;i++)r=t[i],n.get(r.ns_id,r.ns_path)===!0&&(e[o.server_path(r.ns_id,r.ns_path)]=!0);return n.clear(),n.set_batch(e)},t}():void 0}),define("modules/dirty/upsell/ha",["dropbox","modules/clean/upsell/upsell_controller"],function(t,e){var n;return n=function(){function t(t,n){var o;this.$ha=t,this.options=n,this.$ha.find(".dismiss-button").on("click",function(t){return function(){return t.$ha.hide()}}(this)),o=new e(this.$ha.find(".confirm-button"),this.$ha.find(".dismiss-button"),this.options),o.log_impression()}return t}()});